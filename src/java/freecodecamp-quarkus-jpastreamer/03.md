---
lang: ko-KR
title: 03. Integrating the database
description: Java Web App with Quarkus and JPAStreamer > 03. Integrating the database
tags: ["crashcourse", "java", "spring", "spring-boot" , "jdk", "wikidocs"]
meta:
  - name: Java Web App with Quarkus and JPAStreamer > 03. Integrating the database
    content: 03. Integrating the database
  - property: og:title
    content: 03. Integrating the database
  - property: og:description
    content: Java Web App with Quarkus and JPAStreamer > 03. Integrating the database
  - property: og:url
    content: https://chanhi2000.github.io/crashcourse/java-freecodecamp-quarkus-jpastreamer/03.html
---

# {{ $frontmatter.title }} ê´€ë ¨

> {{ $frontmatter.description }}

[[toc]]

---

## Sakila Database

[<FontIcon icon="iconfont icon-github"/>`jOOQ/sakila`](https://github.com/jOOQ/sakila) is a nicely normalised database modelling a DVD rental store (for those of you old enough to remember what that is). Its design includes a few nice features:

- Many to many relationships
- Multiple paths between entities (_e.g._ film-inventory-rental-payment vs film-inventory-store-customer-payment) to practice joins
- Consistent naming of columns
  - Primary keys are called `[tablename]_[id]`
  - Foreign keys are called like their referenced primary key, if possible. This allows for using `JOIN .. USING` syntax where supported
  - Relationship tables do not have any surrogate keys but use composite primary keys
  - Every table has a `last_update` audit column
  - A generated data set of a reasonable size is available

### ERD

![ERD](https://www.jooq.org/img/sakila.png)

> For this project, we are going to use the following entities

- `ACTOR`
- `FILM_ACTOR`
- `FILM`

<!-- 
```mermaid
---
title: Sakila Database ERD
---
erDiagram
  FILM {
    NUMBER(22) FILM_ID PK
    VARCHAR2(255) TITLE
    CLOB DESCRIPTION
    VARCHAR2(4) RELEASE_YEAR
    NUMBER(22) LANGUAGE_ID FK
    NUMBER(22) ORIGINAL_LANGUAGE_ID FK
    NUMBER(22) RENTAL_DURATION 
    NUMBER(42) RENTAL_RATE
    NUMBER(22) LENGTH
    NUMBER(52) REPLACEMENT_COST 
    VARCHAR2(10) RATING
    VARCHAR2(100) SPECIAL_FEATURES
    TIMESTAMP LAST_UPDATE
  }
  ACTOR {
    NUMBER(22) ACTOR_ID PK
    VARCHAR2(45) FIRST_NAME
    VARCHAR2(45) LAST_NAME
    TIMESTAMP LAST_UPDATE
  }
  FILM_ACTOR {
    NUMBER(22) ACTOR_ID  PK, FK
    NUMBER(22) FILM_ID PK, FK
    TIMESTAMP LAST_UPDATE
  }
  LANGUAGE {
    NUMBER(22) LANGUAGE_ID PK
    CHAR(20) NAME
    TIMESTAMP LAST_UPDATE
  }
  CATEGORY {
    NUMBER(22) CATEGORY_ID PK
    VARCHAR2(25) NAME
    TIMESTAMP LAST_UPDATE    
  }
  FILM_CATEGORY {
    NUMBER(22) FILM_ID PK, FK
    NUMBER(22) CATEGORY_ID PK, FK
    TIMESTAMP LAST_UPDATE
  }
  INVENTORY {
    NUMBER(22) INVENTORY_ID PK
    NUMBER(22) FILM_ID FK
    NUMBER(22) STORE_ID FK
    TIMESTAMP LAST_UPDATE
  }
  STORE {
    NUMBER(22) STORE_ID PK
    NUMBER(22) MANAGER_STAFF_ID FK
    NUMBER(22) ADDRESS_ID FK
    TIMESTAMP LAST_UPDATE
  }
  STAFF {
    NUMBER(22) STAFF_ID PK
    VARCHAR2(45) FIRST_NAME
    VARCHAR2(45) LAST_NAME
    NUMBER(22) ADDRESS_ID FK
    BLOB PICTURE
    VARCHAR2(50) EMAIL
    NUMBER(22) STORE_ID FK
    NUMBER(22) ACTIVE
    VARCHAR2(18) USERNAME
    VARCHAR2(40) PASSWORD
    TIMESTAMP LAST_UPDATE
  }
  PAYMENT {
    NUMBER(22) PAYMENT_ID PK
    NUMBER(22) CUSTOMER_ID FK
    NUMBER(22) STAFF_ID FK
    NUMBER(22) RENTAL_ID FK
    NUMBER(22) AMOUNT
    TIMESTAMP PAYMENT_DATE
    TIMESTAMP LAST_UPDATE
  }
  RENTAL {
    NUMBER(22) RENTAL_ID PK
    TIMESTAMP RENTAL_DATE
    NUMBER(22) INVENTORY_ID FK
    NUMBER(22) CUSTOMER_ID FK
    TIMESTAMP RETURN_DATE
    NUMBER(22) STAFF_ID FK
    TIMESTAMP LAST_UPDATE
  }
  CUSTOMER {
    NUMBER(22) CUSTOMER_ID PK
    NUMBER(22) STORE_ID FK
    VARCHAR2(45) FIRST_NAME
    VARCHAR2(45) LAST_NAME
    VARCHAR2(50) EMAIL
    NUMBER(22) ADDRESS_ID FK
    CHAR(1) ACTIVE
    DATE CREATE_DATE
    TIMESTAMP LAST_UPDATE
  }
  ADDRESS {
    NUMBER(22) ADDRESS_ID PK
    VARCHAR2(50) ADDRESS
    VARCHAR2(50) ADDRESS2
    VARCHAR2(20) DISTRICT
    NUMBER(22) CITY_ID FK
    VARCHAR2(10) POSTAL_CODE
    VARCHAR2(20) PHONE
    TIMESTAMP LAST_UPDATE
  }
  CITY {
    NUMBER(22) CITY_ID PK
    VARCHAR2(50) CITY
    NUMBER(22) COUNTRY_ID FK
    TIMESTAMP LAST_UPDATE
  }
  COUNTRY {
    NUMBER(22) COUNTRY_ID PK
    VARCHAR2(50) COUNTRY
    TIMESTAMP LAST_UPDATE
  }
  ACTOR ||--o{ FILM_ACTOR : of
  FILM ||--o{ FILM_ACTOR : has
  FILM ||--o{ FILM_CATEGORY : has
  CATEGORY ||--o{ FILM_CATEGORY : has
  STORE ||--o{ INVENTORY : has
  STORE ||--o{ STAFF : has
  LANGUAGE ||--o{ FILM : in
  LANGUAGE |o--o{ FILM : in
  COUNTRY ||--o{ CITY : has
  CITY ||--o{ ADDRESS : has
  ADDRESS ||--o{ CUSTOMER : has
  ADDRESS ||--o{ STORE : has
  ADDRESS ||--o{ STAFF : has
  CUSTOMER ||--o{ PAYMENT : has
  CUSTOMER ||--o{ RENTAL : has
  RENTAL |o--o{ PAYMENT : cost
  STAFF ||--o{ PAYMENT : has
  STAFF ||--o{ RENTAL : has
```
 -->
### Docker

Run the following script

```sh
docker run --platform linux/amd64 \
  -d -it \
  --name sakila \
  --publish 3306:3306 \
  restsql/mysql-sakila:latest
#
# Unable to find image 'restsql/mysql-sakila:latest' locally
# latest: Pulling from restsql/mysql-sakila
# d54efb8db41d: Download complete
# f8b845f45a87: Download complete 
# e8db7bf7c39f: Download complete 
# 9654c40e9079: Download complete 
# 6d9ef359eaaa: Download complete 
# 9fc85a5d43a6: Download complete 
# 095c073d31fa: Download complete 
# 3aba1b8904c8: Download complete 
# 253ef57834ca: Download complete
# b771e54105b2: Download complete
# Digest: sha256:8510e8f1957548d7acb942456f4469bbfd7680da2afdbce0be9819281cc9fd7f
# Status: Downloaded newer image for restsql/mysql-sakila:latest
# 5f73bcc57e2b9514e657a711f3a9234db3f0b44b26763d6bd4347c66c42be647   
```

Verify the container is running healthy

### Intellij Idea CE

Find and attach JDBC Connection

#### Installation

```card
title: Jetbrains Plugin - Database Navigator
desc: Database development, scripting and navigation tool
link: https://plugins.jetbrains.com/plugin/1800-database-navigator
logo: https://plugins.jetbrains.com/files/1800/424452/icon/pluginIcon.svg
color: (10, 10, 10, 0.2)
```

Install [`Database Navigator` Plugin](https://plugins.jetbrains.com/plugin/1800-database-navigator) (if not installed)

::: tabs

@tab:active mac

- <FontIcon icon="iconfont icon-select"/>`[Preferences] > [Plugins]`
- Find `Database Navigator` Plugin and Install 

:::

#### Make Connection

On <FontIcon icon="iconfont icon-select"/>`[DB Browser]` view, 
- Click `[+]` button and select <FontIcon icon="iconfont icon-select"/>`MySQL`
- Type the following information and test connection 

| title | description |
| :--- | :---- |
| `Name` | Sakila |
| `Connection Type` | Database |
| `Host` | localhost |
| `Port` | `3306` | 
| `Database` | `sakila` |
| ðŸ”‘`User`/`Password` | `root`/`sakila` |

### Connect Quarkus Application to DB

> File: <FontIcon icon="iconfont icon-folder"/>`src/main/resources/`<FontIcon icon="iconfont icon-file"/>`application.properties`

```properties
# General databse config
quarkus.datasource.jdbc.driver=com.mysql.cj.jdbc.Driver
quarkus.datasource.jdbc.url=jdbc:mysql://localhost:3306/sakila
quarkus.datasource.username=root
quarkus.datasource.password=sakila

# Hibernate config
quarkus.hibernate-orm.log.sql=true
```

---

<TagLinks />
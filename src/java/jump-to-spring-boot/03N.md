---
lang: ko-KR
title: 3-14. ê²€ìƒ‰
description: ğŸƒJump to Spring Boot > 3-14. ê²€ìƒ‰
category:
  - â˜•ï¸Java
  - ğŸƒSpring
  - ğŸ“¦AWS
tag: 
  - crashcourse
  - java
  - jdk
  - jdk8
  - stream
  - spring
  - springframework
  - springboot
  - aws
  - aws-ec2
head:
  - - meta:
    - property: og:title
      content: ğŸƒJump to Spring Boot > 3-14. ê²€ìƒ‰
    - property: og:description
      content: 3-14. ê²€ìƒ‰
    - property: og:url
      content: https://chanhi2000.github.io/crashcourse/java/jump-to-spring-boot/03N.html
---

# {{ $frontmatter.title }} ê´€ë ¨

> {{ $frontmatter.description }}

[[toc]]

---

```component VPCard
title: 3-14. ê²€ìƒ‰
desc: ì í”„ íˆ¬ ìŠ¤í”„ë§ë¶€íŠ¸ - WikiDocs
link: https://wikidocs.net/162814
logo: https://wikidocs.net/static/img/favicon.ico
color: rgba(255, 255, 255, 0.2)
```

---

> [<FontIcon icon="iconfont icon-github"/> `pahkey/sbb3` - <FontIcon icon="iconfont icon-folder"/> `3-14`](https://github.com/pahkey/sbb3/tree/3-14)

<VidStack src="youtube/-O0yhg0T_lUQ"/>

ì´ë²ˆì—ëŠ” SBBì— ê²€ìƒ‰ê¸°ëŠ¥ì„ ì¶”ê°€í•´ ë³´ì.

> ì°¸ê³ ë¡œ ê²€ìƒ‰ì€ ì´ ì±…ì—ì„œ ë‹¤ë£¨ëŠ” ê°€ì¥ ì–´ë ¤ìš´ ë¶€ë¶„ì´ë‹¤. ì°¨ë¶„í•œ ë§ˆìŒìœ¼ë¡œ ë”°ë¼ì˜¤ê¸° ë°”ë€ë‹¤.

---

## ê²€ìƒ‰ ê¸°ëŠ¥

SBBëŠ” ì§ˆë¬¸ê³¼ ë‹µë³€ì— ëŒ€í•œ ë°ì´í„°ê°€ ê³„ì† ìŒ“ì—¬ê°€ëŠ” ê²Œì‹œíŒì´ë¯€ë¡œ ê²€ìƒ‰ê¸°ëŠ¥ì€ í•„ìˆ˜ë¼ê³  í•  ìˆ˜ ìˆë‹¤. ê²€ìƒ‰ì˜ ëŒ€ìƒì€ ì§ˆë¬¸ì˜ ì œëª©, ì§ˆë¬¸ì˜ ë‚´ìš©, ì§ˆë¬¸ ì‘ì„±ì, ë‹µë³€ì˜ ë‚´ìš©, ë‹µë³€ ì‘ì„±ì ì •ë„ë¡œ í•˜ë©´ ì ë‹¹í•  ê²ƒì´ë‹¤. ì¦‰, "ìŠ¤í”„ë§"ì´ë¼ê³  ê²€ìƒ‰ì„ í•˜ë©´ "ìŠ¤í”„ë§" ì´ë¼ëŠ” ë¬¸ìì—´ì´ ì œëª©, ë‚´ìš©, ì§ˆë¬¸ ì‘ì„±ì, ë‹µë³€, ë‹µë³€ ì‘ì„±ìì— ì¡´ì¬í•˜ëŠ”ì§€ ì°¾ì•„ë³´ê³  ê·¸ ê²°ê³¼ë¥¼ í™”ë©´ì— ë³´ì—¬ì£¼ì–´ì•¼ í•œë‹¤.

ì´ëŸ° ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ SQL ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤.

```sql
SELECT
  DISTINCT q.id
  , q.author_id
  , q.content
  , q.create_date
  , q.modify_date
  , q.subject 
FROM 
  question q 
  LEFT OUTER JOIN site_user u1 ON q.author_id=u1.id 
  LEFT OUTER JOIN answer a ON q.id=a.question_id 
  LEFT OUTER JOIN site_user u2 ON a.author_id=u2.id 
WHERE 1=1
AND q.subject LIKE '%ìŠ¤í”„ë§%'
OR q.content LIKE '%ìŠ¤í”„ë§%'
OR u1.username LIKE '%ìŠ¤í”„ë§%'
OR a.content LIKE '%ìŠ¤í”„ë§%'
OR u2.username LIKE '%ìŠ¤í”„ë§%'
```

ì¿¼ë¦¬ì— ìµìˆ™í•˜ì§€ ì•Šë‹¤ë©´ ìœ„ ì¿¼ë¦¬ë¥¼ ì´í•´í•˜ê¸° í˜ë“¤ìˆ˜ë„ ìˆë‹¤. ì ì‹œ ìœ„ì˜ ì¿¼ë¦¬ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.

ìœ„ ì¿¼ë¦¬ëŠ” "ìŠ¤í”„ë§" ì´ë¼ëŠ” ë¬¸ìì—´ì´ í¬í•¨ëœ ë°ì´í„°ë¥¼ `question`, `answer`, `site_user` í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ì¿¼ë¦¬ì´ë‹¤. ê·¸ë¦¬ê³  `question` í…Œì´ë¸”ì„ ê¸°ì¤€ìœ¼ë¡œ `answer`, `site_user` í…Œì´ë¸”ì„ ì•„ìš°í„° ì¡°ì¸í•˜ì—¬ "ìŠ¤í”„ë§" ì´ë¼ëŠ” ë¬¸ìì—´ì„ ê²€ìƒ‰í•œë‹¤. ì•„ìš°í„°(`OUTER`) ì¡°ì¸ ëŒ€ì‹  ì´ë„ˆ(`INNER`) ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ í•©ì§‘í•©ì´ ì•„ë‹Œ êµì§‘í•©ìœ¼ë¡œ ê²€ìƒ‰ë˜ì–´ ê²°ê³¼ê°€ ëˆ„ë½ë  ìˆ˜ ìˆì–´ ì£¼ì˜í•´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  ì´ 3ê°œì˜ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì•„ìš°í„° ì¡°ì¸í•˜ì—¬ ê²€ìƒ‰í•˜ë©´ ì¤‘ë³µëœ ê²°ê³¼ê°€ ë‚˜ì˜¬ìˆ˜ ìˆê¸° ë•Œë¬¸ì— `SELECT` ë¬¸ì— `DISTINCT`ë¥¼ ì£¼ì–´ ì¤‘ë³µì„ ì œê±°í–ˆë‹¤.

JPAë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„ì˜ ì¿¼ë¦¬ë¥¼ ìë°”ì½”ë“œë¡œ ë§Œë“¤ìˆ˜ ìˆë‹¤. ë‹¤ìŒì„ ë”°ë¼í•´ ë³´ì.

### Specification

ìœ„ì˜ ì¿¼ë¦¬ì—ì„œ ë³¸ ê²ƒê³¼ ê°™ì´ ì—¬ëŸ¬ í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•´ì•¼ í•  ê²½ìš°ì—ëŠ” JPAê°€ ì œê³µí•˜ëŠ” Specification ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•˜ë‹¤. Specificationì„ ì–´ë–»ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì˜ˆì œë¥¼ í†µí•´ì„œ ì•Œì•„ë³´ì.

::: info Specification

Specificationì€ ë³´ë‹¤ ì •êµí•œ ì¿¼ë¦¬ì˜ ì‘ì„±ì„ ë„ì™€ì£¼ëŠ” JPAì˜ ë„êµ¬ì´ë‹¤. ë³´ë‹¤ ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì˜ ë¬¸ì„œë¥¼ ì°¸ê³ í•´ ë³´ì.

https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#specifications

:::

ë‹¤ìŒê³¼ ê°™ì´ `QuestionService`ì— `search` ë©”ì„œë“œë¥¼ ì¶”ê°€í•´ ë³´ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/question/`<FontIcon icon="iconfont icon-java"/>`QuestionService.java`

```java{2-9,15-31}
// (... ìƒëµ ...)
import com.mysite.sbb.answer.Answer;
import jakarta.persistence.criteria.CriteriaBuilder;
import jakarta.persistence.criteria.CriteriaQuery;
import jakarta.persistence.criteria.Join;
import jakarta.persistence.criteria.JoinType;
import jakarta.persistence.criteria.Predicate;
import jakarta.persistence.criteria.Root;
import org.springframework.data.jpa.domain.Specification;
// (... ìƒëµ ...)
public class QuestionService {

    private final QuestionRepository questionRepository;

    private Specification<Question> search(String kw) {
        return new Specification<>() {
            private static final long serialVersionUID = 1L;
            @Override
            public Predicate toPredicate(Root<Question> q, CriteriaQuery<?> query, CriteriaBuilder cb) {
                query.distinct(true);  // ì¤‘ë³µì„ ì œê±° 
                Join<Question, SiteUser> u1 = q.join("author", JoinType.LEFT);
                Join<Question, Answer> a = q.join("answerList", JoinType.LEFT);
                Join<Answer, SiteUser> u2 = a.join("author", JoinType.LEFT);
                return cb.or(cb.like(q.get("subject"), "%" + kw + "%"), // ì œëª© 
                        cb.like(q.get("content"), "%" + kw + "%"),      // ë‚´ìš© 
                        cb.like(u1.get("username"), "%" + kw + "%"),    // ì§ˆë¬¸ ì‘ì„±ì 
                        cb.like(a.get("content"), "%" + kw + "%"),      // ë‹µë³€ ë‚´ìš© 
                        cb.like(u2.get("username"), "%" + kw + "%"));   // ë‹µë³€ ì‘ì„±ì 
            }
        };
    }

    // (... ìƒëµ ...)
}
```

ì¶”ê°€í•œ `search` ë©”ì„œë“œëŠ” ê²€ìƒ‰ì–´(`kw`)ë¥¼ ì…ë ¥ë°›ì•„ ì¿¼ë¦¬ì˜ ì¡°ì¸ë¬¸ê³¼ `WHERE`ë¬¸ì„ ìƒì„±í•˜ì—¬ ë¦¬í„´í•˜ëŠ” ë©”ì„œë“œì´ë‹¤. ì½”ë“œë¥¼ ìì„¸íˆ ë³´ë©´ ìœ„ì—ì„œ ì•Œì•„ë³¸ ì¿¼ë¦¬ë¥¼ ìë°” ì½”ë“œë¡œ ê·¸ëŒ€ë¡œ ì¬í˜„í•œ ê²ƒì„ì„ ì•Œìˆ˜ ìˆë‹¤.

ìœ„ ì½”ë“œì—ì„œ ì‚¬ìš©í•œ ë³€ìˆ˜ë“¤ì— ëŒ€í•´ì„œ ìì„¸íˆ ì‚´í´ë³´ì.

- `q`: Root, ì¦‰ ê¸°ì¤€ì„ ì˜ë¯¸í•˜ëŠ” Question ì—”í‹°í‹°ì˜ ê°ì²´ (ì§ˆë¬¸ ì œëª©ê³¼ ë‚´ìš©ì„ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ í•„ìš”)
- `u1`: Question ì—”í‹°í‹°ì™€ `SiteUser` ì—”í‹°í‹°ë¥¼ ì•„ìš°í„° ì¡°ì¸(`JoinType.LEFT`)í•˜ì—¬ ë§Œë“  `SiteUser` ì—”í‹°í‹°ì˜ ê°ì²´. `Question` ì—”í‹°í‹°ì™€ `SiteUser` ì—”í‹°í‹°ëŠ” author ì†ì„±ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— `q.join("author")`ì™€ ê°™ì´ ì¡°ì¸í•´ì•¼ í•œë‹¤. (ì§ˆë¬¸ ì‘ì„±ìë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ í•„ìš”)
- `a` - Question ì—”í‹°í‹°ì™€ Answer ì—”í‹°í‹°ë¥¼ ì•„ìš°í„° ì¡°ì¸í•˜ì—¬ ë§Œë“  Answer ì—”í‹°í‹°ì˜ ê°ì²´. Question ì—”í‹°í‹°ì™€ Answer ì—”í‹°í‹°ëŠ” `answerList` ì†ì„±ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— `q.join("answerList")`ì™€ ê°™ì´ ì¡°ì¸í•´ì•¼ í•œë‹¤. (ë‹µë³€ ë‚´ìš©ì„ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ í•„ìš”)
- `u2` - ë°”ë¡œ ìœ„ì—ì„œ ì‘ì„±í•œ `a` ê°ì²´ì™€ ë‹¤ì‹œ í•œë²ˆ `SiteUser` ì—”í‹°í‹°ì™€ ì•„ìš°í„° ì¡°ì¸í•˜ì—¬ ë§Œë“  `SiteUser` ì—”í‹°í‹°ì˜ ê°ì²´ (ë‹µë³€ ì‘ì„±ìë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ì„œ í•„ìš”)
ê·¸ë¦¬ê³  ê²€ìƒ‰ì–´(`kw`)ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ë¥¼ likeë¡œ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ ì œëª©, ë‚´ìš©, ì§ˆë¬¸ ì‘ì„±ì, ë‹µë³€ ë‚´ìš©, ë‹µë³€ ì‘ì„±ì ê°ê°ì— `cb.likeë¥¼` ì‚¬ìš©í•˜ê³  ìµœì¢…ì ìœ¼ë¡œ `cb.or`ë¡œ `OR` ê²€ìƒ‰ë˜ê²Œ í•˜ì˜€ë‹¤. ìœ„ì—ì„œ ì˜ˆì‹œë¡œ ë“  ì¿¼ë¦¬ì™€ ë¹„êµí•´ ë³´ë©´ ì½”ë“œê°€ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì—ˆëŠ”ì§€ ì‰½ê²Œ ì´í•´ë  ê²ƒì´ë‹¤.

### <FontIcon icon="iconfont icon-java"/>`QuestionRepository`

ê·¸ë¦¬ê³  ìœ„ì—ì„œ ì‘ì„±í•œ <FontIcon icon="iconfont icon-java"/>`Specification`ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ <FontIcon icon="iconfont icon-java"/>`QuestionRepository`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/question/`<FontIcon icon="iconfont icon-java"/>`QuestionRepository.java`

```java{7,15}
package com.mysite.sbb.question;

import java.util.List;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.domain.Specification;
import org.springframework.data.jpa.repository.JpaRepository;

public interface QuestionRepository extends JpaRepository<Question, Integer> {
    Question findBySubject(String subject);
    Question findBySubjectAndContent(String subject, String content);
    List<Question> findBySubjectLike(String subject);
    Page<Question> findAll(Pageable pageable);
    Page<Question> findAll(Specification<Question> spec, Pageable pageable);
}
```

Specificationê³¼ `Pageable` ê°ì²´ë¥¼ ì…ë ¥ìœ¼ë¡œ `Question` ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ëŠ” `findAll` ë©”ì„œë“œë¥¼ ì„ ì–¸í–ˆë‹¤.

### <FontIcon icon="iconfont icon-java"/>`QuestionService`

ê·¸ë¦¬ê³  <FontIcon icon="iconfont icon-java"/>`QuestionService`ì˜ `getList` ë©”ì„œë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/question/`<FontIcon icon="iconfont icon-java"/>`QuestionService.java`

```java{6,10-11}
// (... ìƒëµ ...)
public class QuestionService {

    // (... ìƒëµ ...)

    public Page<Question> getList(int page, String kw) {
        List<Sort.Order> sorts = new ArrayList<>();
        sorts.add(Sort.Order.desc("createDate"));
        Pageable pageable = PageRequest.of(page, 10, Sort.by(sorts));
        Specification<Question> spec = search(kw);
        return this.questionRepository.findAll(spec, pageable);
    }

    // (... ìƒëµ ...)
}
```

ê²€ìƒ‰ì–´ë¥¼ ì˜ë¯¸í•˜ëŠ” ë§¤ê°œë³€ìˆ˜ `kw`ë¥¼ `getList`ì— ì¶”ê°€í•˜ê³  `kw` ê°’ìœ¼ë¡œ `Specification` ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ `findAll` ë©”ì„œë“œ í˜¸ì¶œì‹œ ì „ë‹¬í•˜ì˜€ë‹¤.

## <FontIcon icon="iconfont icon-java"/>`QuestionController`

ê·¸ë¦¬ê³  `QuestionService`ì˜ `getList` ë©”ì„œë“œì˜ ì…ë ¥í•­ëª©ì´ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ `QuestionController`ë„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/question/`<FontIcon icon="iconfont icon-java"/>`QuestionController.java`

```java{8,11}
// (... ìƒëµ ...)
public class QuestionController {

    // (... ìƒëµ ...)

    @GetMapping("/list")
    public String list(Model model, @RequestParam(value = "page", defaultValue = "0") int page,
            @RequestParam(value = "kw", defaultValue = "") String kw) {
        Page<Question> paging = this.questionService.getList(page, kw);
        model.addAttribute("paging", paging);
        model.addAttribute("kw", kw);
        return "question_list";
    }

    // (... ìƒëµ ...)
}
```

ê²€ìƒ‰ì–´ì— í•´ë‹¹í•˜ëŠ” `kw` íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í–ˆê³  ë””í´íŠ¸ê°’ìœ¼ë¡œ ë¹ˆ ë¬¸ìì—´ì„ ì„¤ì •í–ˆë‹¤. ê·¸ë¦¬ê³  í™”ë©´ì—ì„œ ì…ë ¥í•œ ê²€ìƒ‰ì–´ë¥¼ í™”ë©´ì— ìœ ì§€í•˜ê¸° ìœ„í•´ `model.addAttribute("kw", kw)`ë¡œ `kw` ê°’ì„ ì €ì¥í–ˆë‹¤. ì´ì œ í™”ë©´ì—ì„œ `kw` ê°’ì´ íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ì˜¤ë©´ í•´ë‹¹ ê°’ìœ¼ë¡œ ì§ˆë¬¸ ëª©ë¡ì´ ê²€ìƒ‰ë˜ì–´ ì¡°íšŒë  ê²ƒì´ë‹¤.

---

## ê²€ìƒ‰ í™”ë©´

ì´ì œ í™”ë©´ì— ê²€ìƒ‰ê¸°ëŠ¥ì„ ì¶”ê°€í•´ ë³´ì.

### ê²€ìƒ‰ ì°½

ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆëŠ” í…ìŠ¤íŠ¸ì°½ì„ ë‹¤ìŒê³¼ ê°™ì´ ì§ˆë¬¸ ëª©ë¡ í…œí”Œë¦¿ì— ì¶”ê°€í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/resources/templates/`<FontIcon icon="iconfont icon-page"/>`question_list.html`

```html{3-13.20}
<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <div class="row my-3">
        <div class="col-6">
            <a th:href="@{/question/create}" class="btn btn-primary">ì§ˆë¬¸ ë“±ë¡í•˜ê¸°</a>
        </div>
        <div class="col-6">
            <div class="input-group">
                <input type="text" id="search_kw" class="form-control" th:value="${kw}">
                <button class="btn btn-outline-secondary" type="button" id="btn_search">ì°¾ê¸°</button>
            </div>
        </div>
    </div>
    <table class="table">
        <!-- (... ìƒëµ ...) -->
    </table>
    <!-- í˜ì´ì§•ì²˜ë¦¬ ì‹œì‘ -->
    <!-- (... ìƒëµ ...) -->
    <!-- í˜ì´ì§•ì²˜ë¦¬ ë -->
    <!-- <a th:href="@{/question/create}" class="btn btn-primary">ì§ˆë¬¸ ë“±ë¡í•˜ê¸°</a> -->
</div>
</html>
```

`<table>` íƒœê·¸ ìƒë‹¨ ìš°ì¸¡ì— ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆëŠ” í…ìŠ¤íŠ¸ì°½ì„ ìƒì„±í•˜ì˜€ë‹¤. ë§¨ ë°‘ì— ìˆë˜ <FontIcon icon="iconfont icon-select"/>`["ì§ˆë¬¸ ë“±ë¡í•˜ê¸°"]` ë²„íŠ¼ì€ ê²€ìƒ‰ ì°½ì˜ ì¢Œì¸¡ìœ¼ë¡œ ì´ë™í–ˆë‹¤. ê·¸ë¦¬ê³  ìë°” ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì´ í…ìŠ¤íŠ¸ì°½ì— ì…ë ¥ëœ ê°’ì„ ì½ê¸° ìœ„í•´ ë‹¤ìŒì²˜ëŸ¼ í…ìŠ¤íŠ¸ì°½ `id` ì†ì„±ì— `"search_kw"`ë¼ëŠ” ê°’ì„ ì¶”ê°€í•œ ì ì— ì£¼ëª©í•˜ì.

```html{1}
<input type="text" id="search_kw" class="form-control" th:value="${kw}">
```

### ê²€ìƒ‰ í¼

ê·¸ë¦¬ê³  `page`ì™€ `kw`ë¥¼ ë™ì‹œì— GETìœ¼ë¡œ ìš”ì²­í•  ìˆ˜ ìˆëŠ” `searchForm`ì„ ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/resources/templates/`<FontIcon icon="iconfont icon-page"/>`question_list.html`

```html{3-6}
<!-- (... ìƒëµ ...) -->
    <!-- í˜ì´ì§•ì²˜ë¦¬ ë -->
    <form th:action="@{/question/list}" method="get" id="searchForm">
        <input type="hidden" id="kw" name="kw" th:value="${kw}">
        <input type="hidden" id="page" name="page" th:value="${paging.number}">
    </form>
</div>
</html>
```

GET ë°©ì‹ìœ¼ë¡œ ìš”ì²­í•´ì•¼ í•˜ë¯€ë¡œ method ì†ì„±ì— "get"ì„ ì„¤ì •í–ˆë‹¤. `kw`ì™€ `page`ëŠ” ì´ì „ì— ìš”ì²­í–ˆë˜ ê°’ì„ ê¸°ì–µí•˜ê³  ìˆì–´ì•¼ í•˜ë¯€ë¡œ `value`ì— ê°’ì„ ìœ ì§€í• ìˆ˜ ìˆë„ë¡ í–ˆë‹¤.

> ì´ì „ì— ìš”ì²­í–ˆë˜ `kw`ì™€ `page`ì˜ ê°’ì€ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œë¶€í„° ë‹¤ì‹œ ì „ë‹¬ ë°›ëŠ”ë‹¤.

ê·¸ë¦¬ê³  action ì†ì„±ì€ "í¼ì´ ì „ì†¡ë˜ëŠ” URL"ì´ë¯€ë¡œ ì§ˆë¬¸ ëª©ë¡ URLì¸ `/question/list`ë¥¼ ì§€ì •í–ˆë‹¤.

::: info GET ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

`page`, `kw`ë¥¼ GETì´ ì•„ë‹Œ POST ë°©ì‹ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì€ ì¶”ì²œí•˜ê³  ì‹¶ì§€ ì•Šë‹¤. ë§Œì•½ GETì´ ì•„ë‹Œ POST ë°©ì‹ìœ¼ë¡œ ê²€ìƒ‰ê³¼ í˜ì´ì§•ì„ ì²˜ë¦¬í•œë‹¤ë©´ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ "ìƒˆë¡œê³ ì¹¨" ë˜ëŠ” "ë’¤ë¡œê°€ê¸°"ë¥¼ í–ˆì„ ë•Œ "ë§Œë£Œëœ í˜ì´ì§€ì…ë‹ˆë‹¤."ë¼ëŠ” ì˜¤ë¥˜ë¥¼ ì¢…ì¢… ë§Œë‚˜ê²Œ ë  ê²ƒì´ë‹¤. ì™œëƒí•˜ë©´ POST ë°©ì‹ì€ ë™ì¼í•œ POST ìš”ì²­ì´ ë°œìƒí•  ê²½ìš° ì¤‘ë³µ ìš”ì²­ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ "ë§Œë£Œëœ í˜ì´ì§€ì…ë‹ˆë‹¤." ë¼ëŠ” ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ê¸° ë•Œë¬¸ì´ë‹¤. 2í˜ì´ì§€ì—ì„œ 3í˜ì´ì§€ë¡œ ê°”ë‹¤ê°€ ë’¤ë¡œê°€ê¸°ë¥¼ í–ˆì„ ë•Œ 2í˜ì´ì§€ë¡œ ê°€ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´ ì—‰ë§ì´ ë  ê²ƒì´ë‹¤.

ì´ëŸ¬í•œ ì´ìœ ë¡œ ì—¬ëŸ¬ íŒŒë¼ë¯¸í„°ë¥¼ ì¡°í•©í•˜ì—¬ ê²Œì‹œë¬¼ ëª©ë¡ì„ ì¡°íšŒí•  ë•ŒëŠ” GET ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

:::

### í˜ì´ì§•

ê·¸ë¦¬ê³  ê¸°ì¡´ í˜ì´ì§•ì„ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ë„ `?page=1` ì²˜ëŸ¼ ì§ì ‘ URLì„ ë§í¬í•˜ëŠ” ë°©ì‹ì—ì„œ ê°’ì„ ì½ì–´ í¼ì— ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ ë‹¤ìŒì²˜ëŸ¼ ë³€ê²½í•´ì•¼ í•œë‹¤. ì™œëƒí•˜ë©´ ê²€ìƒ‰ì–´ê°€ ìˆì„ ê²½ìš° ê²€ìƒ‰ì–´ì™€ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ í•¨ê»˜ ì „ì†¡í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/resources/templates/`<FontIcon icon="iconfont icon-page"/>`question_list.html`

```html{6,13,16}
<!-- (... ìƒëµ ...) -->
<!-- í˜ì´ì§•ì²˜ë¦¬ ì‹œì‘ -->
<div th:if="${!paging.isEmpty()}">
  <ul class="pagination justify-content-center">
    <li class="page-item" th:classappend="${!paging.hasPrevious} ? 'disabled'">
      <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number-1}">
        <span>ì´ì „</span>
      </a>
    </li>
    <li th:each="page: ${#numbers.sequence(0, paging.totalPages-1)}"
      th:if="${page >= paging.number-5 and page <= paging.number+5}"
      th:classappend="${page == paging.number} ? 'active'" class="page-item">
      <a th:text="${page}" class="page-link" href="javascript:void(0)" th:data-page="${page}"></a>
    </li>
    <li class="page-item" th:classappend="${!paging.hasNext} ? 'disabled'">
      <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number+1}">
        <span>ë‹¤ìŒ</span>
      </a>
    </li>
  </ul>
</div>
<!-- í˜ì´ì§•ì²˜ë¦¬ ë -->
<!-- (... ìƒëµ ...) -->
```

ëª¨ë“  í˜ì´ì§€ ë§í¬ë¥¼ `href` ì†ì„±ì— ì§ì ‘ ì…ë ¥í•˜ëŠ” ëŒ€ì‹  `data-page` ì†ì„±ìœ¼ë¡œ ê°’ì„ ì½ì„ ìˆ˜ ìˆë„ë¡ ë³€ê²½í–ˆë‹¤.

ì¦‰, ë‹¤ìŒê³¼ ê°™ì€ ë§í¬ë¥¼

```html{1}
<a class="page-link" th:href="@{|?page=${paging.number-1}|}">
  <span>ì´ì „</span>
</a>
```

ë‹¤ìŒì²˜ëŸ¼ ìˆ˜ì •í–ˆë‹¤.

```html{1}
<a class="page-link" href="javascript:void(0)" th:data-page="${paging.number-1}">
  <span>ì´ì „</span>
</a>
```

### ê²€ìƒ‰ ìŠ¤í¬ë¦½íŠ¸

ê·¸ë¦¬ê³  `page`, `kw` íŒŒë¼ë¯¸í„°ë¥¼ ë™ì‹œì— ìš”ì²­í•  ìˆ˜ ìˆëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/resources/templates/`<FontIcon icon="iconfont icon-page"/>`question_list.html`

```html{8-22}
<!-- (... ìƒëµ ...) -->
    <!-- í˜ì´ì§•ì²˜ë¦¬ ë -->
    <form th:action="@{/question/list}" method="get" id="searchForm">
        <input type="hidden" id="kw" name="kw" th:value="${kw}">
        <input type="hidden" id="page" name="page" th:value="${paging.number}">
    </form>
</div>
<script layout:fragment="script" type='text/javascript'>
const page_elements = document.getElementsByClassName("page-link");
Array.from(page_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        document.getElementById('page').value = this.dataset.page;
        document.getElementById('searchForm').submit();
    });
});
const btn_search = document.getElementById("btn_search");
btn_search.addEventListener('click', function() {
    document.getElementById('kw').value = document.getElementById('search_kw').value;
    document.getElementById('page').value = 0;  // ê²€ìƒ‰ë²„íŠ¼ì„ í´ë¦­í•  ê²½ìš° 0í˜ì´ì§€ë¶€í„° ì¡°íšŒí•œë‹¤.
    document.getElementById('searchForm').submit();
});
</script>
</html>
```

ìœ„ì— ì¶”ê°€í•œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ìì„¸íˆ ì‚´í´ë³´ì. ë§Œì•½ ë‹¤ìŒê³¼ ê°™ì´ `class` ì†ì„±ê°’ìœ¼ë¡œ `"page-link"`ë¼ëŠ” ê°’ì„ ê°€ì§€ê³  ìˆëŠ” ë§í¬ë¥¼ í´ë¦­í•˜ë©´

```html{1}
<a class="page-link" href="javascript:void(0)" th:data-page="${paging.number-1}">
  <span>ì´ì „</span>
</a>
```

ì´ ë§í¬ì˜ `data-page` ì†ì„±ê°’ì„ ì½ì–´ `searchForm`ì˜ `page` í•„ë“œì— ì„¤ì •í•˜ì—¬ `searchForm`ì„ ìš”ì²­í•˜ë„ë¡ ë‹¤ìŒê³¼ ê°™ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í–ˆë‹¤.

```js
const page_elements = document.getElementsByClassName("page-link");
Array.from(page_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        document.getElementById('page').value = this.dataset.page;
        document.getElementById('searchForm').submit();
    });
});
```

ê·¸ë¦¬ê³  ê²€ìƒ‰ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê²€ìƒ‰ì–´ í…ìŠ¤íŠ¸ì°½ì— ì…ë ¥ëœ ê°’ì„ `searchForm`ì˜ `kw` í•„ë“œì— ì„¤ì •í•˜ì—¬ `searchForm`ì„ ìš”ì²­í•˜ë„ë¡ ë‹¤ìŒê³¼ ê°™ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í–ˆë‹¤.

```js
const btn_search = document.getElementById("btn_search");
btn_search.addEventListener('click', function() {
    document.getElementById('kw').value = document.getElementById('search_kw').value;
    document.getElementById('page').value = 0;  // ê²€ìƒ‰ë²„íŠ¼ì„ í´ë¦­í•  ê²½ìš° 0í˜ì´ì§€ë¶€í„° ì¡°íšŒí•œë‹¤.
    document.getElementById('searchForm').submit();
});
```

ê·¸ë¦¬ê³  ê²€ìƒ‰ë²„íŠ¼ì„ í´ë¦­í•˜ëŠ” ê²½ìš°ëŠ” ìƒˆë¡œìš´ ê²€ìƒ‰ì— í•´ë‹¹ë˜ë¯€ë¡œ `page`ì— í•­ìƒ 0ì„ ì„¤ì •í•˜ì—¬ ì²« í˜ì´ì§€ë¡œ ìš”ì²­í•˜ë„ë¡ í–ˆë‹¤.

### ê²€ìƒ‰ í™•ì¸

![ì´ì œ ê²€ìƒ‰ì°½ì— "ìŠ¤í”„ë§"ì´ë¼ëŠ” ê²€ìƒ‰ì–´ë¡œ ì¡°íšŒí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•´ë‹¹ ë¬¸ì¥ì´ ìˆëŠ” ê²Œì‹œë¬¼ë§Œ ì¡°íšŒë  ê²ƒì´ë‹¤.](https://wikidocs.net/images/page/162814/C_3-14_1.png)

---

## `@Query`

ì¿¼ë¦¬ì— ìµìˆ™í•˜ë‹¤ë©´ ë³µì¡í•œ ì¿¼ë¦¬ëŠ” ìë°”ì½”ë“œë¡œ ìƒì„±í•˜ê¸° ë³´ë‹¤ëŠ” ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ”ê²Œ í›¨ì”¬ í¸í•˜ê²Œ ì—¬ê²¨ì§ˆ ê²ƒì´ë‹¤. ì´ë²ˆì—ëŠ” <FontIcon icon="iconfont icon-java"/>`Specification` ëŒ€ì‹  ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ì—¬ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.

.<FontIcon icon="iconfont icon-java"/>`QuestionRepository`ì— ë‹¤ìŒê³¼ ê°™ì€ ë©”ì„œë“œë¥¼ ì¶”ê°€í•´ ë³´ì.

```java{2-3,8-20}
// (... ìƒëµ ...)
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

public interface QuestionRepository extends JpaRepository<Question, Integer> {
    // (... ìƒëµ ...)

    @Query("select "
            + "distinct q "
            + "from Question q " 
            + "left outer join SiteUser u1 on q.author=u1 "
            + "left outer join Answer a on a.question=q "
            + "left outer join SiteUser u2 on a.author=u2 "
            + "where "
            + "   q.subject like %:kw% "
            + "   or q.content like %:kw% "
            + "   or u1.username like %:kw% "
            + "   or a.content like %:kw% "
            + "   or u2.username like %:kw% ")
    Page<Question> findAllByKeyword(@Param("kw") String kw, Pageable pageable);
}
```

`@Query` ì• ë„ˆí…Œì´ì…˜ì´ ì ìš©ëœ `findAllByKeyword` ë©”ì„œë“œë¥¼ ì¶”ê°€í–ˆë‹¤. ìœ„ì—ì„œ ì•Œì•„ë³¸ ì¿¼ë¦¬ë¥¼ `@Query`ì— êµ¬í˜„í•œ ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  `@Query`ë¥¼ ì‘ì„±í•  ë•Œì—ëŠ” ë°˜ë“œì‹œ í…Œì´ë¸” ê¸°ì¤€ì´ ì•„ë‹Œ ì—”í‹°í‹° ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•œë‹¤. ì¦‰, `site_user`ì™€ ê°™ì€ í…Œì´ë¸”ëª… ëŒ€ì‹  `SiteUser`ì²˜ëŸ¼ ì—”í‹°í‹°ëª…ì„ ì‚¬ìš©í•´ì•¼ í•˜ê³  ì¡°ì¸ë¬¸ì—ì„œ ë³´ë“¯ì´ `q.author_id=u1.id`ì™€ ê°™ì€ ì»¬ëŸ¼ëª… ëŒ€ì‹  `q.author=u1`ì²˜ëŸ¼ ì—”í‹°í‹°ì˜ ì†ì„±ëª…ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

ê·¸ë¦¬ê³  `@Query`ì— íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•  `kw` ë¬¸ìì—´ì€ ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ì— `@Param("kw")`ì²˜ëŸ¼ `@Param` ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ê²€ìƒ‰ì–´ë¥¼ ì˜ë¯¸í•˜ëŠ” `kw` ë¬¸ìì—´ì€ `@Query` ì•ˆì—ì„œ `:kw`ë¡œ ì°¸ì¡°ëœë‹¤.

ì‘ì„±í•œ `findAllByKeyword` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ <FontIcon icon="iconfont icon-java"/>`QuestionService`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ì.

```java{10}
// (... ìƒëµ ...)
public class QuestionService {

    // (... ìƒëµ ...)

    public Page<Question> getList(int page, String kw) {
        List<Sort.Order> sorts = new ArrayList<>();
        sorts.add(Sort.Order.desc("createDate"));
        Pageable pageable = PageRequest.of(page, 10, Sort.by(sorts));
        return this.questionRepository.findAllByKeyword(kw, pageable);
    }

    // (... ìƒëµ ...)
}
```

.<FontIcon icon="iconfont icon-java"/>`Specification`ì„ ì‚¬ìš©í• ë•Œì™€ ë™ì¼í•˜ê²Œ ë™ì‘í•  ê²ƒì´ë‹¤.

---

<TagLinks />
---
lang: ko-KR
title: 3-07. ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ
description: ğŸƒJump to Spring Boot > 3-07. ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ
tags: ["crashcourse", "java", "spring", "spring-boot" , "jdk", "wikidocs"]
meta:
  - name: ğŸƒJump to Spring Boot > 3ì¥ - SBB ì„œë¹„ìŠ¤ ê°œë°œ! > 3-07. ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ
    content: 3-07. ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ
  - property: og:title
    content: 3-07. ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ
  - property: og:description
    content: ğŸƒJump to Spring Boot > 3ì¥ - SBB ì„œë¹„ìŠ¤ ê°œë°œ! > 3-07. ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ
  - property: og:url
    content: https://chanhi2000.github.io/crashcourse/java-jump-to-spring-boot/03G.html
---

# {{ $frontmatter.title }} ê´€ë ¨

> {{ $frontmatter.description }}

[[toc]]

---

```card
title: 3-07. ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ
desc: ì í”„ íˆ¬ ìŠ¤í”„ë§ë¶€íŠ¸ - WikiDocs
link: https://wikidocs.net/162255
logo: https://wikidocs.net/static/img/favicon.ico
color: rgba(255, 255, 255, 0.2)
```

---

> [<FontIcon icon="iconfont icon-github"/> `pahkey/sbb3` - <FontIcon icon="iconfont icon-folder"/> `3-07`](https://github.com/pahkey/sbb3/tree/3-07)

<YouTube id="5M2FoxAC6rY"/>

SBBëŠ” ì—¬ëŸ¬ ì‚¬ëŒì´ ì‚¬ìš©í•˜ëŠ” ê²Œì‹œíŒ ì„œë¹„ìŠ¤ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì§ˆë¬¸í•œ ì‚¬ëŒ, ë‹µë³€í•œ ì‚¬ëŒì„ êµ¬ë³„í•˜ëŠ” ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒì€ í•„ìˆ˜ ê¸°ëŠ¥ì´ë‹¤. ì•ì„œ íšŒì› ê°€ì… ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìœ¼ë¯€ë¡œ ì´ì œ ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

---

## ë¡œê·¸ì¸ êµ¬í˜„í•˜ê¸°

íšŒì› ê°€ì… ë‹¨ê³„ì—ì„œ `SITE_USER` í…Œì´ë¸”ì— íšŒì› ì •ë³´ë¥¼ ì €ì¥í–ˆë‹¤. `SITE_USER` í…Œì´ë¸”ì— ì €ì¥ëœ ì‚¬ìš©ìëª…(ì‚¬ìš©ì ID)ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ì„ í•˜ë ¤ë©´ ë³µì¡í•œ ë‹¨ê³„ë¥¼ ê±°ì³ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ ë‹¨ê³„ë¥¼ ë³´ë‹¤ ì‰½ê²Œ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.

::: info ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ë°©ëŒ€í•œ í”„ë ˆì„ì›Œí¬ì´ë‹¤. 
 
ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ë°©ëŒ€í•œ í”„ë ˆì„ì›Œí¬ì´ë‹¤. ë”°ë¼ì„œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì•Œê¸° ìœ„í•´ì„œëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ëŒ€í•´ì„œ ìì„¸íˆ ê³µë¶€í•´ì•¼ í•œë‹¤. (ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ì±… 1ê¶Œ ë¶„ëŸ‰ìœ¼ë¡œ ë‚˜ì˜¬ë§Œí¼ ë°©ëŒ€í•œ í”„ë ˆì„ì›Œí¬ì´ë‹¤. ì‹¤ì œë¡œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ëŒ€í•œ ì±…ì€ ë§ì´ ì¶œíŒë˜ì—ˆë‹¤.) ì´ ì±…ì€ ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ìì²´ì— ëŒ€í•œ ë‚´ìš©ë³´ë‹¤ëŠ” í™œìš©ì ì¸ ì¸¡ë©´ì— ëŒ€í•´ì„œë§Œ ë‹¤ë£° ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ê°œëµì ì¸ ê°œë… ì„¤ëª…ì„ ì¶”ê°€í–ˆìœ¼ë‹ˆ ì´í•´ì— ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ë€ë‹¤.

:::

ë‹¤ìŒì„ ìˆœì„œëŒ€ë¡œ ë”°ë¼í•´ ë³´ì.

### ë¡œê·¸ì¸ URL ë“±ë¡

ë¨¼ì € ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ë¡œê·¸ì¸ URLì„ ë“±ë¡í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/`<FontIcon icon="iconfont icon-java"/>`SecurityConfig.java`

```java{14-16}
// (... ìƒëµ ...)

@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests((authorizeHttpRequests) -> authorizeHttpRequests
                .requestMatchers(new AntPathRequestMatcher("/**")).permitAll())
            .csrf((csrf) -> csrf
                .ignoringRequestMatchers(new AntPathRequestMatcher("/h2-console/**")))
            .headers((headers) -> headers
                .addHeaderWriter(new XFrameOptionsHeaderWriter(
                    XFrameOptionsHeaderWriter.XFrameOptionsMode.SAMEORIGIN)))
            .formLogin((formLogin) -> formLogin
                .loginPage("/user/login")
                .defaultSuccessUrl("/"))
        ;
        return http.build();
    }

    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

ì¶”ê°€í•œ `.formLogin` ë©”ì„œë“œëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ë¡œê·¸ì¸ ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” ë¶€ë¶„ìœ¼ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ì˜ URLì€ `/user/login`ì´ê³  ë¡œê·¸ì¸ ì„±ê³µì‹œì— ì´ë™í•˜ëŠ” ë””í´íŠ¸ í˜ì´ì§€ëŠ” ë£¨íŠ¸ URL(`/`)ì„ì„ ì˜ë¯¸í•œë‹¤.

### <FontIcon icon="iconfont icon-java"/>`UserController`

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ë¡œê·¸ì¸ URLì„ `/user/login` ìœ¼ë¡œ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ `User` ì»¨íŠ¸ë¡¤ëŸ¬ì— í•´ë‹¹ ë§¤í•‘ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/user/`<FontIcon icon="iconfont icon-java"/>`UserController.java`

```java
// (... ìƒëµ ...)
public class UserController {

    // (... ìƒëµ ...)

    @GetMapping("/login")
    public String login() {
        return "login_form";
    }
}
```

.<FontIcon icon="iconfont icon-page"/>`login_form.html` í…œí”Œë¦¿ì„ ë Œë”ë§í•˜ëŠ” GET ë°©ì‹ì˜ `login` ë©”ì„œë“œë¥¼ ì¶”ê°€í–ˆë‹¤. ì‹¤ì œ ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ëŠ” `@PostMapping` ë°©ì‹ì˜ ë©”ì„œë“œëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ëŒ€ì‹  ì²˜ë¦¬í•˜ë¯€ë¡œ ì§ì ‘ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ë‹¤.

### <FontIcon icon="iconfont icon-page"/>`login_form.html`

ë¡œê·¸ì¸ í…œí”Œë¦¿ì€ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/resources/templates/`<FontIcon icon="iconfont icon-page"/>`login_form.html`

```html
<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <form th:action="@{/user/login}" method="post">
        <div th:if="${param.error}">
            <div class="alert alert-danger">
                ì‚¬ìš©ìID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.
            </div>
        </div>
        <div class="mb-3">
            <label for="username" class="form-label">ì‚¬ìš©ìID</label>
            <input type="text" name="username" id="username" class="form-control">
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" name="password" id="password" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
    </form>
</div>
</html>
```

ì‚¬ìš©ìIDì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ì„ í•  ìˆ˜ ìˆëŠ” ë¡œê·¸ì¸ í…œí”Œë¦¿ì„ ì‘ì„±í–ˆë‹¤. ì‹œíë¦¬í‹°ì˜ ë¡œê·¸ì¸ì´ ì‹¤íŒ¨í•  ê²½ìš°ì—ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë‹¤ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ëœë‹¤. ì´ ë•Œ í˜ì´ì§€ íŒŒë¼ë¯¸í„°ë¡œ errorê°€ í•¨ê»˜ ì „ë‹¬ëœë‹¤. ë”°ë¼ì„œ ë¡œê·¸ì¸ í˜ì´ì§€ì˜ íŒŒë¼ë¯¸í„°ë¡œ errorê°€ ì „ë‹¬ë  ê²½ìš° _"ì‚¬ìš©ìID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”."_ ë¼ëŠ” ì˜¤ë¥˜ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ë„ë¡ í–ˆë‹¤.

> ë¡œê·¸ì¸ ì‹¤íŒ¨ì‹œ íŒŒë¼ë¯¸í„°ë¡œ errorê°€ ì „ë‹¬ë˜ëŠ” ê²ƒì€ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ê·œì¹™ì´ë‹¤.

ì—¬ê¸°ê¹Œì§€ ìˆ˜ì •í•˜ê³  ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8080/user/login`ì„ í˜¸ì¶œí•´ ë³´ì. ê·¸ëŸ¬ë©´ ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì´ ë‚˜íƒ€ë‚œë‹¤.

![07_1](https://wikidocs.net/images/page/162255/O_3-07_1.png)

í•˜ì§€ë§Œ ì•„ì§ ë¡œê·¸ì¸ì„ ìˆ˜í–‰í•  ìˆ˜ëŠ” ì—†ë‹¤. ì™œëƒí•˜ë©´ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ë¬´ì—‡ì„ ê¸°ì¤€ìœ¼ë¡œ ë¡œê·¸ì¸ì„ í•´ì•¼ í•˜ëŠ”ì§€ ì•„ì§ ì„¤ì •í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤. ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ í†µí•´ ë¡œê·¸ì¸ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì—ëŠ” ì—¬ëŸ¬ê°€ì§€ê°€ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê°€ì¥ ê°„ë‹¨í•˜ê²ŒëŠ” ì‹œíë¦¬í‹° ì„¤ì • íŒŒì¼ì— ì§ì ‘ ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ë¥¼ ë“±ë¡í•˜ì—¬ ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ” ë©”ëª¨ë¦¬ ë°©ì‹ì´ ìˆë‹¤. í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ì´ë¯¸ ì´ì „ ì¥ì—ì„œ íšŒì›ê°€ì…ì„ í†µí•´ íšŒì› ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í–ˆìœ¼ë¯€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ íšŒì›ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•´ì•¼ í•  ê²ƒì´ë‹¤.

ì´ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ëŠ” ì„œë¹„ìŠ¤(`UserSecurityService`)ë¥¼ ë§Œë“¤ê³  ê·¸ ì„œë¹„ìŠ¤ë¥¼ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ë“±ë¡í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì. í•˜ì§€ë§Œ `UserSecurityService`ë¥¼ ë§Œë“¤ê³  ë“±ë¡í•˜ê¸° ì „ì— `UserSecurityService`ì—ì„œ í•„ìš”í•œ `UserRepository`, `UserRole` ë“±ì„ ë¨¼ì € ì¤€ë¹„í•´ì•¼ í•œë‹¤.

### <FontIcon icon="iconfont icon-java"/>`UserRepository`

ì•ìœ¼ë¡œ ì‘ì„±í•  `UserSecurityService`ëŠ” ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•˜ë¯€ë¡œ ë‹¤ìŒì²˜ëŸ¼ `findByusername` ë©”ì„œë“œë¥¼ `User` ë¦¬í¬ì§€í„°ë¦¬ì— ì¶”ê°€í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/user/`<FontIcon icon="iconfont icon-java"/>`UserRepository.java`

```java{3,8}
package com.mysite.sbb.user;

import java.util.Optional;

import org.springframework.data.jpa.repository.JpaRepository;

public interface UserRepository extends JpaRepository<SiteUser, Long> {
    Optional<SiteUser> findByusername(String username);
}
```

### <FontIcon icon="iconfont icon-java"/>`UserRole`

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ì¸ì¦ ë¿ë§Œ ì•„ë‹ˆë¼ ê¶Œí•œë„ ê´€ë¦¬í•œë‹¤. ë”°ë¼ì„œ ì¸ì¦í›„ì— ì‚¬ìš©ìì—ê²Œ ë¶€ì—¬í•  ê¶Œí•œì´ í•„ìš”í•˜ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ `ADMIN`, `USER` 2ê°œì˜ ê¶Œí•œì„ ê°–ëŠ” `UserRole`ì„ ì‹ ê·œë¡œ ì‘ì„±í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/user/`<FontIcon icon="iconfont icon-java"/>`UserRole.java`

```java
package com.mysite.sbb.user;

import lombok.Getter;


@Getter
public enum UserRole {
    ADMIN("ROLE_ADMIN"),
    USER("ROLE_USER");

    UserRole(String value) {
        this.value = value;
    }

    private String value;
}
```

`UserRole`ì€ ì—´ê±° ìë£Œí˜•(`enum`)ìœ¼ë¡œ ì‘ì„±í–ˆë‹¤. `ADMIN`ì€ `"ROLE_ADMIN"`, `USER`ëŠ” `"ROLE_USER"` ë¼ëŠ” ê°’ì„ ê°€ì§€ë„ë¡ í–ˆë‹¤. ê·¸ë¦¬ê³  ìƒìˆ˜ ìë£Œí˜•ì´ë¯€ë¡œ `@Setter`ì—†ì´ `@Getter`ë§Œ ì‚¬ìš©ê°€ëŠ¥í•˜ë„ë¡ í–ˆë‹¤.

> ì´ ì±…ì—ì„œ êµ¬í˜„í•  SBBëŠ” ê¶Œí•œìœ¼ë¡œ íŠ¹ì • ê¸°ëŠ¥ì„ ì œì–´í•˜ì§€ ì•ŠëŠ”ë‹¤. í•˜ì§€ë§Œ SBB ì„œë¹„ìŠ¤ë¥¼ ì™„ì„±í•˜ê³  ë‹¤ë¥¸ ì‚¬ëŒì´ ì‘ì„±í•œ ì§ˆë¬¸ì´ë‚˜ ë‹µë³€ì„ ADMIN ê¶Œí•œì„ ì§€ë‹Œ ì‚¬ìš©ìëŠ” ìˆ˜ì •ì´ ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“¤ì–´ë„ ì¢‹ì„ ê²ƒì´ë‹¤.

### <FontIcon icon="iconfont icon-java"/>`UserSecurityService`

ê·¸ë¦¬ê³  ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì„¤ì •ì— ë“±ë¡í•  `UserSecurityService`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‹ ê·œë¡œ ì‘ì„±í•˜ì.

> íŒŒì¼ëª…:<FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/user/`<FontIcon icon="iconfont icon-java"/>`UserSecurityService.java`

```java
package com.mysite.sbb.user;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

import lombok.RequiredArgsConstructor;

@RequiredArgsConstructor
@Service
public class UserSecurityService implements UserDetailsService {

    private final UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        Optional<SiteUser> _siteUser = this.userRepository.findByusername(username);
        if (_siteUser.isEmpty()) {
            throw new UsernameNotFoundException("ì‚¬ìš©ìë¥¼ ì°¾ì„ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        SiteUser siteUser = _siteUser.get();
        List<GrantedAuthority> authorities = new ArrayList<>();
        if ("admin".equals(username)) {
            authorities.add(new SimpleGrantedAuthority(UserRole.ADMIN.getValue()));
        } else {
            authorities.add(new SimpleGrantedAuthority(UserRole.USER.getValue()));
        }
        return new User(siteUser.getUsername(), siteUser.getPassword(), authorities);
    }
}
```

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•  `UserSecurityService`ëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ì œê³µí•˜ëŠ” `UserDetailsService` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„(implements)í•´ì•¼ í•œë‹¤. ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ `UserDetailsService`ëŠ” `loadUserByUsername` ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ë„ë¡ ê°•ì œí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. `loadUserByUsername` ë©”ì„œë“œëŠ” ì‚¬ìš©ìëª…ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¡°íšŒí•˜ì—¬ ë¦¬í„´í•˜ëŠ” ë©”ì„œë“œì´ë‹¤.

> `UserSecurityService`ëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ë¡œê·¸ì¸ ì²˜ë¦¬ì˜ í•µì‹¬ ë¶€ë¶„ì´ë‹¤.

ì¡°ê¸ˆ ë” ìì„¸íˆ ì‚´í´ë³´ë©´, `loadUserByUsername` ë©”ì„œë“œëŠ” ì‚¬ìš©ìëª…ìœ¼ë¡œ `SiteUser` ê°ì²´ë¥¼ ì¡°íšŒí•˜ê³  ë§Œì•½ ì‚¬ìš©ìëª…ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°ì—ëŠ” `UsernameNotFoundException` ì˜¤ë¥˜ë¥¼ ë‚´ê²Œ í–ˆë‹¤. ê·¸ë¦¬ê³  ì‚¬ìš©ìëª…ì´ "admin"ì¸ ê²½ìš°ì—ëŠ” `ADMIN` ê¶Œí•œì„ ë¶€ì—¬í•˜ê³  ê·¸ ì´ì™¸ì˜ ê²½ìš°ì—ëŠ” USER ê¶Œí•œì„ ë¶€ì—¬í–ˆë‹¤. ê·¸ë¦¬ê³  ì‚¬ìš©ìëª…, ë¹„ë°€ë²ˆí˜¸, ê¶Œí•œì„ ì…ë ¥ìœ¼ë¡œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ `User` ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ë¦¬í„´í–ˆë‹¤. ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” `loadUserByUsername` ë©”ì„œë“œì— ì˜í•´ ë¦¬í„´ëœ User ê°ì²´ì˜ ë¹„ë°€ë²ˆí˜¸ê°€ í™”ë©´ìœ¼ë¡œë¶€í„° ì…ë ¥ ë°›ì€ ë¹„ë°€ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ë¥¼ ê²€ì‚¬í•˜ëŠ” ë¡œì§ì„ ë‚´ë¶€ì ìœ¼ë¡œ ê°€ì§€ê³  ìˆë‹¤.

### <FontIcon icon="iconfont icon-java"/>`SecurityConfig`

ê·¸ë¦¬ê³  ë‹¤ìŒì²˜ëŸ¼ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— `AuthenticationManager` ë¹ˆì„ ìƒì„±í•˜ì.

> íŒŒì¼ëª…:<FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/`<FontIcon icon="iconfont icon-java"/>`SecurityConfig.java`

```java{2-3,12-15}
// (... ìƒëµ ...)
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
// (... ìƒëµ ...)

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    // (... ìƒëµ ...)

    @Bean
    AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }
}
```

`AuthenticationManager` ë¹ˆì„ ìƒì„±í–ˆë‹¤. `AuthenticationManager`ëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ì¸ì¦ì„ ë‹´ë‹¹í•œë‹¤. `AuthenticationManager`ëŠ” ì‚¬ìš©ì ì¸ì¦ì‹œ ì•ì—ì„œ ì‘ì„±í•œ `UserSecurityService`ì™€ `PasswordEncoder`ë¥¼ ì‚¬ìš©í•œë‹¤.

### <FontIcon icon="iconfont icon-page"/>`navbar.html`

ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ì— ì§„ì…í• ìˆ˜ ìˆëŠ” ë¡œê·¸ì¸ ë§í¬ë¥¼ ë„¤ë¹„ê²Œì´ì…˜ë°”ì— ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/resources/templates/`<FontIcon icon="iconfont icon-page"/>`navbar.html`

```html{11}
<nav th:fragment="navbarFragment" class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">SBB</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/user/login}">ë¡œê·¸ì¸</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/user/signup}">íšŒì›ê°€ì…</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
```

![ì´ì œ ë‚´ë¹„ê²Œì´ì…˜ ë°”ì˜ "ë¡œê·¸ì¸" ë§í¬ë¥¼ ëˆ„ë¥´ë©´ `/user/login`ìœ¼ë¡œ ì´ë™í•˜ë©°, ë‹¤ìŒê³¼ ê°™ì€ ë¡œê·¸ì¸ í™”ë©´ì´ ë‚˜íƒ€ë‚  ê²ƒì´ë‹¤.](https://wikidocs.net/images/page/162255/O_3-07_2.png)


![ë§Œì•½ ë°ì´í„°ë² ì´ìŠ¤ì— ì—†ëŠ” `username` ë˜ëŠ” ì˜ëª»ëœ `password`ë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ìŒì²˜ëŸ¼ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚œë‹¤.](https://wikidocs.net/images/page/162255/O_3-07_3.png)

`username`ê³¼ `password`ë¥¼ ì œëŒ€ë¡œ ì…ë ¥í•˜ë©´ ë¡œê·¸ì¸ì´ ì •ìƒ ìˆ˜í–‰ë˜ê³  ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•  ê²ƒì´ë‹¤.

ì¶•í•˜í•œë‹¤! ë¡œê·¸ì¸ì— ì„±ê³µí–ˆë‹¤.

### ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ ë§í¬

í•˜ì§€ë§Œ ë¡œê·¸ì¸í•œ í›„ì—ë„ ë‚´ë¹„ê²Œì´ì…˜ ë°”ì—ëŠ” ì—¬ì „íˆ "ë¡œê·¸ì¸" ë§í¬ê°€ ë‚¨ì•„ ìˆë‹¤. ë¡œê·¸ì¸ì„ í•œ ìƒíƒœë¼ë©´ ì´ ë§í¬ëŠ” "ë¡œê·¸ì•„ì›ƒ" ë§í¬ë¡œ ë°”ë€Œì–´ì•¼ í•œë‹¤.

> ë°˜ëŒ€ë¡œ ë¡œê·¸ì•„ì›ƒ ìƒíƒœì—ì„œëŠ” "ë¡œê·¸ì¸" ë§í¬ë¡œ ë°”ë€Œì–´ì•¼ í•œë‹¤.

ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ì—¬ë¶€ëŠ” íƒ€ì„ë¦¬í”„ì˜ `sec:authorize` ì†ì„±ì„ í†µí•´ ì•Œìˆ˜ ìˆë‹¤.

- `sec:authorize="isAnonymous()"`: ì´ ì†ì„±ì€ ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ í•´ë‹¹ ì—˜ë¦¬ë¨¼íŠ¸ê°€ í‘œì‹œë˜ê²Œ í•œë‹¤.
- `sec:authorize="isAuthenticated()"`: ì´ ì†ì„±ì€ ë¡œê·¸ì¸ ëœ ê²½ìš°ì—ë§Œ í•´ë‹¹ ì—˜ë¦¬ë¨¼íŠ¸ê°€ í‘œì‹œë˜ê²Œ í•œë‹¤.

ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë‚´ë¹„ê²Œì´ì…˜ë°”ë¥¼ ìˆ˜ì •í• ìˆ˜ ìˆë‹¤.

> íŒŒì¼ëª…:<FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/resources/templates/`<FontIcon icon="iconfont icon-page"/>`navbar.html`

```html{11-12}
<nav th:fragment="navbarFragment" class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">SBB</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" sec:authorize="isAnonymous()" th:href="@{/user/login}">ë¡œê·¸ì¸</a>
                    <a class="nav-link" sec:authorize="isAuthenticated()" th:href="@{/user/logout}">ë¡œê·¸ì•„ì›ƒ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/user/signup}">íšŒì›ê°€ì…</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
```

ë¡œê·¸ì¸ì„ ì•ˆí•œ ìƒíƒœë¼ë©´ `sec:authorize="isAnonymous()"`ê°€ ì°¸ì´ë˜ì–´ "ë¡œê·¸ì¸" ë§í¬ê°€ í‘œì‹œë˜ê³  ë¡œê·¸ì¸ì„ í•œ ìƒíƒœë¼ë©´ `sec:authorize="isAuthenticated()"`ê°€ ì°¸ì´ë˜ì–´ "ë¡œê·¸ì•„ì›ƒ" ë§í¬ê°€ í‘œì‹œë  ê²ƒì´ë‹¤.

![ì´ì œ ë¡œê·¸ì¸ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•˜ë©´ ë‹¤ìŒì²˜ëŸ¼ "ë¡œê·¸ì•„ì›ƒ" ë§í¬ê°€ í‘œì‹œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.](https://wikidocs.net/images/page/162255/C_3-07_4.png)

ë¡œê·¸ì•„ì›ƒ ë§í¬ëŠ” `/user/logout`ìœ¼ë¡œ ì§€ì •í–ˆë‹¤. í•˜ì§€ë§Œ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„í•˜ì§€ ì•Šì€ ìƒíƒœì´ë‹¤. ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì€ ë°”ë¡œ ì´ì–´ì„œ ì§„í–‰í•œë‹¤.

---

## ë¡œê·¸ì•„ì›ƒ êµ¬í˜„í•˜ê¸°

ë¡œê·¸ì¸ì„ í†µí•´ ë¡œê·¸ì¸ì„ í–ˆë‹¤ë©´ ë‚´ë¹„ê²Œì´ì…˜ ìƒë‹¨ì— "ë¡œê·¸ì•„ì›ƒ" ë§í¬ê°€ ë‚˜íƒ€ë‚  ê²ƒì´ë‹¤. í•˜ì§€ë§Œ "ë¡œê·¸ì•„ì›ƒ" ë§í¬ë¥¼ ëˆ„ë¥´ë©´ ë‹¤ìŒê³¼ ê°™ì´ 404 ì˜¤ë¥˜ í˜ì´ì§€ê°€ í‘œì‹œëœë‹¤.

![ì•„ì§ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.](https://wikidocs.net/images/page/162255/O_3-07_5.png)

ë¡œê·¸ì•„ì›ƒ ì—­ì‹œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ êµ¬í˜„í• ìˆ˜ ìˆë‹¤.

### <FontIcon icon="iconfont icon-java"/>`SecurityConfig`

ë‹¤ìŒê³¼ ê°™ì´ `SecurityConfig` íŒŒì¼ì„ ìˆ˜ì •í•˜ì.

> íŒŒì¼ëª…: <FontIcon icon="iconfont icon-folder"/>`/sbb/src/main/java/com/mysite/sbb/`<FontIcon icon="iconfont icon-java"/>`SecurityConfig.java`

```java{20-23}
// (... ìƒëµ ...)

@Configuration
@EnableWebSecurity
public class SecurityConfig  {

    @Bean
    SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests((authorizeHttpRequests) -> authorizeHttpRequests
                .requestMatchers(new AntPathRequestMatcher("/**")).permitAll())
            .csrf((csrf) -> csrf
                .ignoringRequestMatchers(new AntPathRequestMatcher("/h2-console/**")))
            .headers((headers) -> headers
                .addHeaderWriter(new XFrameOptionsHeaderWriter(
                    XFrameOptionsHeaderWriter.XFrameOptionsMode.SAMEORIGIN)))
            .formLogin((formLogin) -> formLogin
                .loginPage("/user/login")
                .defaultSuccessUrl("/"))
            .logout((logout) -> logout
                .logoutRequestMatcher(new AntPathRequestMatcher("/user/logout"))
                .logoutSuccessUrl("/")
                .invalidateHttpSession(true))
        ;
        return http.build();
    }

    // (... ìƒëµ ...)
}
```

ë¡œê·¸ì•„ì›ƒì„ ìœ„í•œ ì„¤ì •ì„ ì¶”ê°€í–ˆë‹¤. ë¡œê·¸ì•„ì›ƒ URLì„ `/user/logout`ìœ¼ë¡œ ì„¤ì •í•˜ê³  ë¡œê·¸ì•„ì›ƒì´ ì„±ê³µí•˜ë©´ ë£¨íŠ¸(`/`) í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ í–ˆë‹¤. ê·¸ë¦¬ê³  ë¡œê·¸ì•„ì›ƒì‹œ ìƒì„±ëœ ì‚¬ìš©ì ì„¸ì…˜ë„ ì‚­ì œí•˜ë„ë¡ ì²˜ë¦¬í–ˆë‹¤.

ìˆ˜ì •ì„ ì™„ë£Œí•œ í›„ ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì´ ì˜ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì.

> ë¡œê·¸ì•„ì›ƒì„ ëˆ„ë¥´ë©´ ë„¤ë¹„ê²Œì´ì…˜ ë°”ì—ëŠ” ë‹¤ì‹œ "ë¡œê·¸ì¸" ë§í¬ê°€ ë‚˜íƒ€ë‚  ê²ƒì´ë‹¤.

---

<TagLinks />
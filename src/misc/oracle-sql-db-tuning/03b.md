---
lang: ko-KR
title: 03B
description: ğŸ™†â€â™‚ï¸DB Server ì„±ëŠ¥ í–¥ìƒ, ë¶„ì„ ë° íŠœë‹ ì „ë¬¸ê°€ í–¥ìƒê³¼ì • > 03B
category:
  - ğŸ™†â€â™‚ï¸Oracle DB
tag: 
  - crashcourse
  - oracle
  - oracle-db
  - oracle-sql
head:
  - - meta:
    - property: og:title
      content: ğŸ™†â€â™‚ï¸DB Server ì„±ëŠ¥ í–¥ìƒ, ë¶„ì„ ë° íŠœë‹ ì „ë¬¸ê°€ í–¥ìƒê³¼ì • > 03B
    - property: og:description
      content: 03B
    - property: og:url
      content: https://chanhi2000.github.io/crashcourse/misc/oracle-sql-db-tuning/03b.html
---

# {{ $frontmatter.title }} ê´€ë ¨

> {{ $frontmatter.description }}

[[toc]]

---

## trace

### 1. í…ŒìŠ¤íŠ¸ í…Œì´ë¸” ìƒì„±

```sql
CREATE TABLE big_table AS 
SELECT 
  * 
FROM dba_tables, (SELECT level FROM DUAL CONNECT BY level <= 1000)
WHERE 1=1;
```


### 2. ì‹¤ìŠµ sql

```sql
SELECT * FROM big_table WHERE 1=1
AND owner = 'SYSTEM'
AND tablespace_name = 'SYSTEM'
AND table_name LIKE 'REPCAT$%'
ORDER BY table_name DESC;
```

### 3. ì‹¤ì œì‹¤í–‰ê³„íš ë° statistics í™•ì¸

#### 3.1 trace file ë¡œ í™•ì¸


```sql
-- 3.1.1. trace file êµ¬ë¶„ì„ ìœ„í•œ identifier ì ìš©
ALTER session SET tracefile_identifier = 'hnj';
--
--
-- 3.1.2. `trace` ìƒì„±íŒŒì¼ í™•ì¸
SELECT 
  r.value || '/' || LOWER(t.instance_name) || 
  '_ora_' || LTRIM(TO_CHAR(p.spid)) || '_hnj' || 
  '.trc' trace_file
FROM 
  v$process p
  , v$session s
  , v$parameter r
  , v$instance t
WHERE 1=1
AND p.addr = s.paddr
AND r.name = 'user_dump_dest'
AND s.sid = (SELECT sid FROM v$mystat WHERE 1=1 AND rownum = 1)
; 
---
---
--- 3.1.3. ì„¸ì…˜ì— trace ì ìš©
ALTER session SET EVENTS '10046 trace name context forever, level 12' ; -- level 12ë¡œ ìƒì„±
---
---
--- 3.1.4. ì‹¤ìŠµ sql ìˆ˜í–‰
SELECT *
  FROM BIG_TABLE
WHERE OWNER = 'SYSTEM'
  AND TABLESPACE_NAME = 'SYSTEM'
  AND TABLE_NAME LIKE 'REPCAT$%'
ORDER BY TABLE_NAME DESC;
---
--- 3.1.5. ì„¸ì…˜ì— trace off
ALTER SESSION SET EVENTS '10046 trace name context forever, off';
```

6. 3.1.2 ì—ì„œ í™•ì¸í•œ íŒŒì¼ ê²½ë¡œ ë° íŒŒì¼ëª… ìœ„ì¹˜ë¡œ ì´ë™ í›„ `tkprof` ë¡œ `trace` íŒŒì¼ ìƒì„±

```sh
tkprof ~.trc chg_trc.txt sys=no
```

> ì°¸ì¡°: http://blog.hkwon.me/oracle-sql-trace-tkprof/

7. `chg_trc.txt`  íŒŒì¼í™•ì¸

trace íŒŒì¼ í™•ì¸í•˜ì—¬ sql ìˆ˜í–‰ì‹œê°„ ì½ì€ ë¸”ëŸ­ ì‹¤í–‰ê²Œíš ë“± í™•ì¸

```
call     count       cpu    elapsed       disk      query    current        rows
------- ------  -------- ---------- ---------- ---------- ----------  ----------
Parse        1      0.00       0.00          0          0          0           0
Execute      1      0.00       0.00          0          0          0           0
Fetch        1      0.01       0.00          0         86          0           1
------- ------  -------- ---------- ---------- ---------- ----------  ----------
total        3      0.01       0.00          0         86          0           1
```

#### 3.2 `dbms_xplan` í™•ì¸

```sql
-- 3.2.1 ì„¸ì…˜ì— statistics_level  ì„¤ì •
ALTER session SET statistics_level = 'ALL';
--
--
-- 3.2.2 ì‹¤ìŠµsql ìˆ˜í–‰
SELECT * FROM big_table WHERE 1=1
AND owner = 'SYSTEM'
AND tablespace_name = 'SYSTEM'
AND table_name LIKE 'REPCAT$%'
ORDER BY table_name DESC;
--
--
-- 3.2.3 dbms_xplan.display_cursor í™•ì¸
SELECT * FROM TABLE(dbms_xplan.display_cursor(null, null, 'ALLSTATS LAST'));
--
--
```

---

<TagLinks />
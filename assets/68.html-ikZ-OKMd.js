import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,a as n,t as w,b as t,w as c,n as p,g as l,d as e,e as s,r,o as m}from"./app-U_bew1in.js";const f={},g={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},y={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},b={class:"table-of-contents"},v=n("hr",null,null,-1),x=s('<h2 id="project-19-part-two" tabindex="-1"><a class="header-anchor" href="#project-19-part-two"><span>Project 19, part two</span></a></h2><p>Yesterday we did a lot of set up work, but now it‚Äôs time for the pay off: we‚Äôre going to send custom JavaScript code back to Safari and have it executed, giving our (hypothetical!) users the ability to manipulate web pages right on their phone.</p><p>I‚Äôm not going to pretend that Apple‚Äôs actions API is pleasant, and I‚Äôm <em>certainly</em> not going to argue that you need to like using JavaScript. As Jeremy Foster once said, ‚Äúevery developer loves and hates JavaScript a little bit‚Äù ‚Äì it‚Äôs something we all need to be aware of, and perhaps even be able to write to some level, but it‚Äôs by no means required.</p><p>The point of this project isn‚Äôt to teach you JavaScript, but instead to show you what‚Äôs possible with iOS. The overwhelming majority of iPhone owners use Safari, and in just two days you‚Äôll have finished building an app that adds functionality directly to it ‚Äì what common problems can you solve?</p><p>Today you have three topics to work through, and you‚Äôll learn about <code>UITextView</code>, <code>NotificationCenter</code>, and more.</p><h3 id="establishing-communication" tabindex="-1"><a class="header-anchor" href="#establishing-communication"><span>Establishing communication</span></a></h3>',6),_={class:"hint-container details"},S=n("summary",null,"Establishing communication",-1),I=n("p",null,"To begin with, all we're going to do is send some data from Safari to our extension to make sure everything is set up correctly ‚Äì after all, it's been quite a bit of hassle so far with nothing to show for it!",-1),j=n("code",null,"Action.js",-1),T=n("code",null,"Action.js",-1),N=n("code",null,"run()",-1),q=s(`<div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token function-variable function">run</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">parameters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    parameters<span class="token punctuation">.</span><span class="token function">completionFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;URL&quot;</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> document<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JavaScript is quite a murky language, so you might be staring at that blankly. If I were to put it in plain English, what it means is &quot;tell iOS the JavaScript has finished preprocessing, and give this data dictionary to the extension.&quot; The data that is being sent has the keys &quot;URL&quot; and &quot;title&quot;, with the values being the page URL and page title.</p><p>As with the previous JavaScript, don&#39;t worry about the nitty-gritty. There are many volumes of books on learning JavaScript and I don&#39;t intend to repeat them here.</p>`,3),C=n("code",null,"ActionViewController.swift",-1),D=n("code",null,"// do stuff!",-1),R=s(`<div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">guard</span> <span class="token keyword">let</span> itemDictionary <span class="token operator">=</span> dict <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSDictionary</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">guard</span> <span class="token keyword">let</span> javaScriptValues <span class="token operator">=</span> itemDictionary<span class="token punctuation">[</span><span class="token class-name">NSExtensionJavaScriptPreprocessingResultsKey</span><span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSDictionary</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span>javaScriptValues<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),V=n("code",null,"[Run]",-1),U=n("code",null,"[Run]",-1),E=n("figure",null,[n("img",{src:"https://www.hackingwithswift.com/img/books/hws/19-5.png",alt:"Xcode will ask you which app you should run with your extension. Please choose Safari.",tabindex:"0",loading:"lazy"}),n("figcaption",null,"Xcode will ask you which app you should run with your extension. Please choose Safari.")],-1),F=n("code",null,"[More]",-1),J=n("code",null,"[More]",-1),W=s(`<figure><img src="https://www.hackingwithswift.com/img/books/hws/19-2.png" alt="Look for your extension inside Safari&#39;s action menu." tabindex="0" loading="lazy"><figcaption>Look for your extension inside Safari&#39;s action menu.</figcaption></figure><p>When your app runs, you should see messages in the console at the bottom of your Xcode window. If the console isn&#39;t visible, use <kbd>Shift</kbd>+<kbd>Cmd</kbd>+<kbd>C</kbd> to activate it, and you should see something like this:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">{</span>
<span class="line">    URL = &quot;https://www.apple.com/retail/code/&quot;;</span>
<span class="line">    title = &quot;Apple Retail Store - Hour of Code Workshop&quot;;</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you&#39;re seeing that, well done ‚Äì your extension is working! If not, you screwed up somewhere, so check my steps again.</p><p>Let&#39;s take a look at the code. As a reminder, here it is again:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">guard</span> <span class="token keyword">let</span> itemDictionary <span class="token operator">=</span> dict <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSDictionary</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">guard</span> <span class="token keyword">let</span> javaScriptValues <span class="token operator">=</span> itemDictionary<span class="token punctuation">[</span><span class="token class-name">NSExtensionJavaScriptPreprocessingResultsKey</span><span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSDictionary</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token function">print</span><span class="token punctuation">(</span>javaScriptValues<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>NSDictionary</code> is a new data type, and it‚Äôs not really one you have much cause to use in Swift that often because it‚Äôs a bit of a holdover from older iOS code. Put simply, <code>NSDictionary</code> works like a Swift dictionary, except you don&#39;t need to declare or even <em>know</em> what data types it holds. One of the nasty things about <code>NSDictionary</code> is that you don&#39;t need to declare or even know what data types it holds.</p><p>Yes, it&#39;s both an advantage and a disadvantage in one, which is why modern Swift dictionaries are preferred. When working with extensions, however, it&#39;s definitely an advantage because we just don&#39;t care what&#39;s in there ‚Äì we just want to pull out our data.</p><p>When you use <code>loadItem(forTypeIdentifier:)</code>, your closure will be called with the data that was received from the extension along with any error that occurred. Apple could provide other data too, so what we get is a dictionary of data that contains all the information Apple wants us to have, and we put that into <code>itemDictionary</code>.</p><p>Right now, there&#39;s nothing in that dictionary other than the data we sent from JavaScript, and that&#39;s stored in a special key called <code>NSExtensionJavaScriptPreprocessingResultsKey</code>. So, we pull that value out from the dictionary, and put it into a value called <code>javaScriptValues</code>.</p><p>We sent a dictionary of data from JavaScript, so we typecast <code>javaScriptValues</code> as an <code>NSDictionary</code> again so that we can pull out values using keys, but for now we just send the whole lot to the <code>print()</code> function, which dumps the dictionary contents to Xcode&#39;s debug console.</p><p>So, we&#39;ve successfully proved that Safari is sending data to our extension; it&#39;s time to do something interesting with it!</p>`,12),A=n("h3",{id:"editing-multiline-text-with-uitextview",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#editing-multiline-text-with-uitextview"},[n("span",null,"Editing multiline text with UITextView")])],-1),P={class:"hint-container details"},L=n("summary",null,"Editing multiline text with UITextView",-1),O=n("code",null,"MainInterface.storyboard",-1),z=n("code",null,"UIImageView",-1),K=n("strong",null,"Note",-1),B=n("code",null,"[X]",-1),H=n("p",null,[e("We're going to use a new UIKit component called "),n("code",null,"UITextView"),e(". You already met "),n("code",null,"UITextField"),e(" in project 5, and it's useful for letting users enter text into a single-line text box. But if you want multiple lines of text you need "),n("code",null,"UITextView"),e(', so search for "textview" in the object library and drag one into your view so that it takes up all the space. Delete the template "Lorem ipsum" text that is in there.')],-1),G=n("code",null,"[Resolve Layout Issues > Reset To Suggested Constraints]",-1),X=n("code",null,"script",-1),Y=n("code",null,"ActionViewController.swift",-1),M=n("code",null,"UIImageView",-1),Q=n("p",null,"This text view is going to contain code rather than writing, so we don‚Äôt want any of Apple‚Äôs ‚Äúhelpful‚Äù text correction systems in place. To turn them off, select the text view then go to the attributes inspector ‚Äì you want to to set Capitalization to None, then Correction, Smart Dashes, Smart Insert, Smart Quotes, and Spell Checking all to No.",-1),Z=n("code",null,"ActionViewController.swift",-1),$=s(`<div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">var</span> pageTitle <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span>
<span class="line"><span class="token keyword">var</span> pageURL <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>We&#39;re going to store these two because they are being transmitted by Safari. We&#39;ll use the page title to show useful text in the navigation bar, and the URL is there for you to use yourself if you make improvements.</p><p>You already saw that we&#39;re receiving the data dictionary from Safari, because we used the <code>print()</code> function to output its values. Replace the <code>print()</code> call with this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>pageTitle <span class="token operator">=</span> javaScriptValues<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;title&quot;</span></span><span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">String</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span>
<span class="line"><span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>pageURL <span class="token operator">=</span> javaScriptValues<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;URL&quot;</span></span><span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">String</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span>pageTitle</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That sets our two properties from the <code>javaScriptValues</code> dictionary, typecasting them as String. It then uses <code>async()</code> to set the view controller&#39;s <code>title</code> property on the main queue. This is needed because the closure being executed as a result of <code>loadItem(forTypeIdentifier:)</code> could be called on any thread, and we don&#39;t want to change the UI unless we&#39;re on the main thread.</p><p>You might have noticed that I haven&#39;t written <code>[weak self] in</code> for the <code>async()</code> call, and that&#39;s because it&#39;s not needed. The closure will capture the variables it needs, which includes <code>self</code>, but we&#39;re already inside a closure that has declared <code>self</code> to be weak, so this new closure will use that.</p><p>We can immediately make our app useful by modifying the <code>done()</code> method. It&#39;s been there all along, but I&#39;ve been ignoring it because there&#39;s so much other prep to do just to get out of first gear, but it&#39;s now time to turn our eyes towards it and add some functionality.</p><p>The <code>done()</code> method was originally called as an action from the storyboard, but we deleted the navigation bar Apple put in because it&#39;s terrible. Instead, let&#39;s create a UIBarButtonItem in code, and make that call <code>done()</code> instead. Put this in <code>viewDidLoad()</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line">navigationItem<span class="token punctuation">.</span>rightBarButtonItem <span class="token operator">=</span> <span class="token class-name">UIBarButtonItem</span><span class="token punctuation">(</span>barButtonSystemItem<span class="token punctuation">:</span> <span class="token punctuation">.</span>done<span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Right now, <code>done()</code> just has one line of code, which is this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">self</span><span class="token punctuation">.</span>extensionContext<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">completeRequest</span><span class="token punctuation">(</span>returningItems<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>extensionContext<span class="token operator">!</span><span class="token punctuation">.</span>inputItems<span class="token punctuation">,</span> completionHandler<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Calling <code>completeRequest(returningItems:)</code> on our extension context will cause the extension to be closed, returning back to the parent app. However, it will pass back to the parent app any items that we specify, which in the current code is the same items that were sent in.</p>`,12),nn=n("code",null,"finalize()",-1),en=n("code",null,"Action.js",-1),tn=n("code",null,"done()",-1),an=s(`<p>To make this work, we need to:</p><ul><li>Create a new <code>NSExtensionItem</code> object that will host our items.</li><li>Create a dictionary containing the key &quot;customJavaScript&quot; and the value of our script.</li><li>Put that dictionary into <em>another</em> dictionary with the key <code>NSExtensionJavaScriptFinalizeArgumentKey</code>.</li><li>Wrap the big dictionary inside an <code>NSItemProvider</code> object with the type identifier <code>kUTTypePropertyList</code>.</li><li>Place that <code>NSItemProvider</code> into our <code>NSExtensionItem</code> as its attachments.</li><li>Call <code>completeRequest(returningItems:)</code>, returning our <code>NSExtensionItem</code>.</li></ul><p>I realize that seems like far more effort than it ought to be, but it&#39;s really just the reverse of what we are doing inside <code>viewDidLoad()</code>.</p><p>With all that in mind, rewrite your <code>done()</code> method to this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@IBAction</span> <span class="token keyword">func</span> <span class="token function-definition function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token class-name">NSExtensionItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">let</span> argument<span class="token punctuation">:</span> <span class="token class-name">NSDictionary</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;customJavaScript&quot;</span></span><span class="token punctuation">:</span> script<span class="token punctuation">.</span>text<span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">let</span> webDictionary<span class="token punctuation">:</span> <span class="token class-name">NSDictionary</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSExtensionJavaScriptFinalizeArgumentKey</span><span class="token punctuation">:</span> argument<span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">let</span> customJavaScript <span class="token operator">=</span> <span class="token class-name">NSItemProvider</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> webDictionary<span class="token punctuation">,</span> typeIdentifier<span class="token punctuation">:</span> <span class="token constant">kUTTypePropertyList</span> <span class="token keyword">as</span> <span class="token class-name">String</span><span class="token punctuation">)</span></span>
<span class="line">    item<span class="token punctuation">.</span>attachments <span class="token operator">=</span> <span class="token punctuation">[</span>customJavaScript<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    extensionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">completeRequest</span><span class="token punctuation">(</span>returningItems<span class="token punctuation">:</span> <span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),sn=n("code",null,"finalize()",-1),on=n("code",null,"Action.js",-1),cn=n("code",null,"parameters",-1),pn=n("code",null,"eval()",-1),ln=n("code",null,"Action.js",-1),rn=n("code",null,"finalize()",-1),dn=s(`<div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line">finalize<span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> customJavaScript <span class="token operator">=</span> parameters<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;customJavaScript&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">eval</span><span class="token punctuation">(</span>customJavaScript<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That&#39;s it! Our user has written their code in our extension, tapped Done, and it gets executed in Safari using <code>eval()</code>. If you want to give it a try, enter the code <code>alert(document.title);</code> into the extension. When you tap Done, you&#39;ll return to Safari and see the page title in a message box.</p>`,2),un=n("h3",{id:"fixing-the-keyboard-notificationcenter",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#fixing-the-keyboard-notificationcenter"},[n("span",null,"Fixing the keyboard: NotificationCenter")])],-1),hn={class:"hint-container details"},kn=n("summary",null,"Fixing the keyboard: NotificationCenter",-1),wn=s(`<p>Before we&#39;re done, there&#39;s a bug in our extension, and it&#39;s a bad one ‚Äì or at least it&#39;s bad once you spot it. You see, when you tap to edit a text view, the iOS keyboard automatically appears so that user can start typing. But if you try typing lots, you&#39;ll notice that you can actually type underneath the keyboard because the text view hasn&#39;t adjusted its size because the keyboard appeared.</p><p>If you don&#39;t see a keyboard when you tap to edit, it probably means you have the Connect Hardware Keyboard setting turned on. Press <kbd>Shift</kbd>+<kbd>Cmd</kbd>+<kbd>K</kbd> to disable the hardware keyboard and use the on-screen one.</p><p>Having our view adjust to the presence of a keyboard is tricky, because there are a number of situations you need to cope with. For example, various keyboards are different heights, the user can rotate their device at will, they can connect a hardware keyboard when they need to, and there&#39;s even the QuickType bar that can be shown or hidden on demand.</p><p>In all the years I&#39;ve done iOS development, I&#39;ve seen at least a dozen ways of coping with keyboards, and few of them are easy. Even Apple&#39;s example solution requires fiddling around with constraints, which isn&#39;t ideal. I&#39;ve tried to put together a solution that copes with all possibilities and also requires as little code as possible. If you manage to find something even simpler, do let me know!</p><p>We can ask to be told when the keyboard state changes by using a new class called <code>NotificationCenter</code>. Behind the scenes, iOS is constantly sending out notifications when things happen ‚Äì keyboard changing, application moving to the background, as well as any custom events that applications post. We can add ourselves as an observer for certain notifications and a method we name will be called when the notification occurs, and will even be passed any useful information.</p><p>When working with the keyboard, the notifications we care about are <code>keyboardWillHideNotification</code> and <code>keyboardWillChangeFrameNotification</code>. The first will be sent when the keyboard has finished hiding, and the second will be shown when any keyboard state change happens ‚Äì including showing and hiding, but also orientation, QuickType and more.</p><p>It might sound like we don&#39;t need <code>keyboardWillHideNotification</code> if we have <code>keyboardWillChangeFrameNotification</code>, but in my testing just using <code>keyboardWillChangeFrameNotification</code> isn&#39;t enough to catch a hardware keyboard being connected. Now, that&#39;s an extremely rare case, but we might as well be sure!</p><p>To register ourselves as an observer for a notification, we get a reference to the default notification center. We then use the <code>addObserver()</code> method, which takes four parameters: the object that should receive notifications (it&#39;s <code>self</code>), the method that should be called, the notification we want to receive, and the object we want to watch. We&#39;re going to pass <code>nil</code> to the last parameter, meaning &quot;we don&#39;t care who sends the notification.&quot;</p><p>So, add this code to <code>viewDidLoad()</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> notificationCenter <span class="token operator">=</span> <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span></span>
<span class="line">notificationCenter<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> selector<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>adjustForKeyboard<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token class-name">UIResponder</span><span class="token punctuation">.</span>keyboardWillHideNotification<span class="token punctuation">,</span> object<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line">notificationCenter<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> selector<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>adjustForKeyboard<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token class-name">UIResponder</span><span class="token punctuation">.</span>keyboardWillChangeFrameNotification<span class="token punctuation">,</span> object<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>adjustForKeyboard()</code> method is complicated, but that&#39;s because it has quite a bit of work to do. First, it will receive a parameter that is of type <code>Notification</code>. This will include the name of the notification as well as a <code>Dictionary</code> containing notification-specific information called <code>userInfo</code>.</p><p>When working with keyboards, the dictionary will contain a key called <code>UIResponder.keyboardFrameEndUserInfoKey</code> telling us the frame of the keyboard after it has finished animating. This will be of type <code>NSValue</code>, which in turn is of type <code>CGRect</code>. The <code>CGRect</code> struct holds both a <code>CGPoint</code> and a <code>CGSize</code>, so it can be used to describe a rectangle.</p><p>One of the quirks of Objective-C was that arrays and dictionaries couldn&#39;t contain structures like <code>CGRect</code>, so Apple had a special class called <code>NSValue</code> that acted as a wrapper around structures so they could be put into dictionaries and arrays. That&#39;s what&#39;s happening here: we&#39;re getting an <code>NSValue</code> object, but we know it contains a <code>CGRect</code> inside so we use its <code>cgRectValue</code> property to read that value.</p><p>Once we finally pull out the correct frame of the keyboard, we need to convert the rectangle to our view&#39;s co-ordinates. This is because rotation isn&#39;t factored into the frame, so if the user is in landscape we&#39;ll have the width and height flipped ‚Äì using the <code>convert()</code> method will fix that.</p><p>The next thing we need to do in the <code>adjustForKeyboard()</code> method is to adjust the <code>contentInset</code> and <code>scrollIndicatorInsets</code> of our text view. These two essentially indent the edges of our text view so that it appears to occupy less space even though its constraints are still edge to edge in the view.</p><p>Finally, we&#39;re going to make the text view scroll so that the text entry cursor is visible. If the text view has shrunk this will now be off screen, so scrolling to find it again keeps the user experience intact.</p><p>It&#39;s not a lot of code, but it <em>is</em> complicated ‚Äì par for the course on this project, it seems. Anyway, here&#39;s the method:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@objc</span> <span class="token keyword">func</span> <span class="token function-definition function">adjustForKeyboard</span><span class="token punctuation">(</span>notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> keyboardValue <span class="token operator">=</span> notification<span class="token punctuation">.</span>userInfo<span class="token operator">?</span><span class="token punctuation">[</span><span class="token class-name">UIResponder</span><span class="token punctuation">.</span>keyboardFrameEndUserInfoKey<span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSValue</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> keyboardScreenEndFrame <span class="token operator">=</span> keyboardValue<span class="token punctuation">.</span>cgRectValue</span>
<span class="line">    <span class="token keyword">let</span> keyboardViewEndFrame <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>keyboardScreenEndFrame<span class="token punctuation">,</span> from<span class="token punctuation">:</span> view<span class="token punctuation">.</span>window<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> notification<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token class-name">UIResponder</span><span class="token punctuation">.</span>keyboardWillHideNotification <span class="token punctuation">{</span></span>
<span class="line">        script<span class="token punctuation">.</span>contentInset <span class="token operator">=</span> <span class="token punctuation">.</span>zero</span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        script<span class="token punctuation">.</span>contentInset <span class="token operator">=</span> <span class="token class-name">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> keyboardViewEndFrame<span class="token punctuation">.</span>height <span class="token operator">-</span> view<span class="token punctuation">.</span>safeAreaInsets<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    script<span class="token punctuation">.</span>scrollIndicatorInsets <span class="token operator">=</span> script<span class="token punctuation">.</span>contentInset</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> selectedRange <span class="token operator">=</span> script<span class="token punctuation">.</span>selectedRange</span>
<span class="line">    script<span class="token punctuation">.</span><span class="token function">scrollRangeToVisible</span><span class="token punctuation">(</span>selectedRange<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As you can see, setting the inset of a text view is done using the <code>UIEdgeInsets</code> struct, which needs insets for all four edges. I&#39;m using the text view&#39;s content inset for its <code>scrollIndicatorInsets</code> to save time.</p><p>Note there&#39;s a check in there for <code>UIKeyboardWillHide</code>, and that&#39;s the workaround for hardware keyboards being connected by explicitly setting the insets to be zero.</p>`,20),mn=n("div",{class:"hint-container info"},[n("p",{class:"hint-container-title"},"Trivia"),n("p",null,"My first Swift app, written back when Swift was first launched in iOS 8.0, was a Safari action. They had just been introduced, and I wanted to solve a problem I had: I wanted to be able to use View Source in Safari.")],-1),fn=n("hr",null,null,-1);function gn(u,yn){const o=r("router-link"),i=r("VPCard"),d=r("VidStack"),a=r("FontIcon");return m(),k("div",null,[n("h1",g,[n("a",y,[n("span",null,w(u.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),n("nav",b,[n("ul",null,[n("li",null,[t(o,{to:"#project-19-part-two"},{default:c(()=>[e("Project 19, part two")]),_:1}),n("ul",null,[n("li",null,[t(o,{to:"#establishing-communication"},{default:c(()=>[e("Establishing communication")]),_:1})]),n("li",null,[t(o,{to:"#editing-multiline-text-with-uitextview"},{default:c(()=>[e("Editing multiline text with UITextView")]),_:1})]),n("li",null,[t(o,{to:"#fixing-the-keyboard-notificationcenter"},{default:c(()=>[e("Fixing the keyboard: NotificationCenter")]),_:1})])])])])]),v,t(i,p(l({title:"100 Days of Swift - Day 68",desc:"Project 19, part two",link:"https://www.hackingwithswift.com/100/68",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),x,n("details",_,[S,t(i,p(l({title:"100 Days of Swift - Day 68 - Establishing communication",desc:"Establishing communication",link:"https://www.hackingwithswift.com/read/19/5/establishing-communication",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),t(d,{src:"youtube/-i-0CLhHILc"}),I,n("p",null,[e("First, we're going to modify "),t(a,{icon:"fa-brands fa-js"}),j,e(" to send two pieces of data to our extension: the URL the user was visiting, and the title of the page. Go to "),t(a,{icon:"fa-brands fa-js"}),T,e(" and modify the "),N,e(" function to this:")]),q,n("p",null,[e("Now that data is being sent from JavaScript, data will be received in Swift. In "),t(a,{icon:"fa-brands fa-swift"}),C,e(", replace the "),D,e(" comment with this:")]),R,n("p",null,[e("Before I explain what that code does, please run the code. I'm saying this because if you're like me then you're probably desperate to see anything working at this point, so let's at least make sure things are working. When you press "),t(a,{icon:"iconfont icon-select"}),V,e(", wait for the list of host applications to finish loading, then select Safari and click "),t(a,{icon:"iconfont icon-select"}),U,e(".")]),E,n("p",null,[e("When Safari loads, go to any web page, then tap the action toolbar button on the bottom ‚Äì it's the box with an arrow coming out. You'll see two rows of icons: swipe to the right on the bottom row. If your extension isn't listed, click "),t(a,{icon:"iconfont icon-select"}),F,e(" and enable it there. Don't be surprised if you see strange messages being printed out in the Xcode debug console while you're doing this, because Apple sometimes likes to spout unhelpful warnings in their own code.")]),n("p",null,[e("In the picture below you can see where your extension's icon should appear inside Safari's action menu. If you don't see it there, tap "),t(a,{icon:"iconfont icon-select"}),J,e(".")]),W]),A,n("details",P,[L,t(i,p(l({title:"100 Days of Swift - Day 68 - Editing multiline text with UITextView",desc:"Editing multiline text with UITextView",link:"https://www.hackingwithswift.com/read/19/6/editing-multiline-text-with-uitextview",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),t(d,{src:"youtube/We4VzqqJTow"}),n("p",null,[e("Our extension is going to let users type in JavaScript, so before we get onto more coding we're going to add a basic user interface. Open "),t(a,{icon:"fas fa-file-lines"}),O,e(", then delete its "),z,e(" and navigation bar. Once that's done, embed the view controller in a navigation controller.")]),n("p",null,[K,e(": When you delete the image view, it‚Äôs possible Xcode might leave its connection intact. This will cause you problems later, so I suggest you double check the image view is really dead: right-click on the yellow view controller circle above your view, and if you see an outlet called ‚ÄúimageView‚Äù click the "),t(a,{icon:"iconfont icon-select"}),B,e(" next to it to clear the connection.")]),H,n("p",null,[e("Go to the Editor menu and use "),t(a,{icon:"iconfont icon-select"}),G,e(" to add automatic Auto Layout constraints. Now use the assistant editor to create an outlet named "),X,e(" for the text view in "),t(a,{icon:"fa-brands fa-swift"}),Y,e(", and while you're there you can delete the "),M,e(" outlet that Xcode made for you.")]),Q,n("p",null,[e("That's everything for Interface Builder, so switch back to the standard editor, open "),t(a,{icon:"fa-brands fa-swift"}),Z,e(" and add these two properties to your class:")]),$,n("p",null,[e("In a Safari extension like ours, the data we return here will be passed in to the "),nn,e(" function in the "),t(a,{icon:"fa-brands fa-js"}),en,e(" JavaScript file, so we're going to modify the "),tn,e(" method so that it passes back the text the user entered into our text view.")]),an,n("p",null,[e("That's all the code required to send data back to Safari, at which point it will appear inside the "),sn,e(" function in "),t(a,{icon:"fa-brands fa-js"}),on,e('. From there we can do what we like with it, but in this project the JavaScript we need to write is remarkably simple: we pull the "customJavaScript" value out of the '),cn,e(" array, then pass it to the JavaScript "),pn,e(" function, which executes any code it finds.")]),n("p",null,[e("Open "),t(a,{icon:"fa-brands fa-js"}),ln,e(", and change the "),rn,e(" function to this:")]),dn]),un,n("details",hn,[kn,t(i,p(l({title:"100 Days of Swift - Day 68 - Fixing the keyboard: NotificationCenter",desc:"Fixing the keyboard: NotificationCenter",link:"https://www.hackingwithswift.com/read/19/7/fixing-the-keyboard-notificationcenter",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),t(d,{src:"youtube/crjzwQ5yCAE"}),wn]),mn,fn])}const xn=h(f,[["render",gn],["__file","68.html.vue"]]),_n=JSON.parse('{"path":"/swift/100-days-of-swift/68.html","title":"Day 68","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Day 68","description":"100 Days of Swift > Day 68","category":["Swift"],"tag":["crashcourse","paul-hudson","swift","hacking-with-swift","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"100 Days of Swift > Day 68"},{"property":"og:description","content":"Day 68"},{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/swift/100-days-of-swift/68.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/crashcourse/swift/100-days-of-swift/68.html"}],["meta",{"property":"og:site_name","content":"ü•ÅCrashcourse"}],["meta",{"property":"og:title","content":"Day 68"}],["meta",{"property":"og:description","content":"100 Days of Swift > Day 68"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://www.hackingwithswift.com/img/books/hws/19-5.png"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2024-10-03T01:20:13.000Z"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"paul-hudson"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"hacking-with-swift"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:modified_time","content":"2024-10-03T01:20:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Day 68\\",\\"image\\":[\\"https://www.hackingwithswift.com/img/books/hws/19-5.png\\",\\"https://www.hackingwithswift.com/img/books/hws/19-2.png\\"],\\"dateModified\\":\\"2024-10-03T01:20:13.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Project 19, part two","slug":"project-19-part-two","link":"#project-19-part-two","children":[{"level":3,"title":"Establishing communication","slug":"establishing-communication","link":"#establishing-communication","children":[]},{"level":3,"title":"Editing multiline text with UITextView","slug":"editing-multiline-text-with-uitextview","link":"#editing-multiline-text-with-uitextview","children":[]},{"level":3,"title":"Fixing the keyboard: NotificationCenter","slug":"fixing-the-keyboard-notificationcenter","link":"#fixing-the-keyboard-notificationcenter","children":[]}]}],"git":{"createdTime":1703642364000,"updatedTime":1727918413000,"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":13}]},"readingTime":{"minutes":11.5,"words":3449},"filePathRelative":"swift/100-days-of-swift/68.md","localizedDate":"2023ÎÖÑ 12Ïõî 27Ïùº","excerpt":"\\n\\n<hr>\\n"}');export{xn as comp,_n as data};

import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,a as n,t as k,b as s,w as o,n as i,g as c,e as l,d as a,r,o as m}from"./app-U_bew1in.js";const w={},f={id:"frontmatter-title-관련",tabindex:"-1"},g={class:"header-anchor",href:"#frontmatter-title-관련"},y={class:"table-of-contents"},b=n("hr",null,null,-1),v=l('<h2 id="project-9-part-one" tabindex="-1"><a class="header-anchor" href="#project-9-part-one"><span>Project 9, part one</span></a></h2><p>Joss Whedon, the creator of Firefly, once said that “the secret to multitasking is that it isn&#39;t actually multitasking – it’s just extreme focus and organization.” (If you weren’t aware, Firefly played a big part in the development of Swift – the internal code name (“Shiny”) was from there, the original documentation mentioned the series a lot, and you’ll even find references to Firefly in my work!)</p><p>Of course, computers operate very different from people: an iPhone XS has six CPU cores inside, and each of those six things can work independently of the others. If you use just one of them – as we have been doing all this time – then your app will never come close to using the full power of the device.</p><p>So, to make the most of those cores we need to do <em>real</em> multitasking: not just extreme focus and organization, but dividing up work that can happen simultaneously across as many cores as we need.</p><p>This is traditionally A Very Hard Problem, but Apple has a framework called Grand Central Dispatch that makes it remarkably easy. It does, however, use <em>closures</em>, so brace yourself!</p><p><strong>Today you have five topics to work through, and you’ll learn about Grand Central Dispatch, quality of service queues, <code>performSelector()</code>, and more.</strong></p><h3 id="setting-up" tabindex="-1"><a class="header-anchor" href="#setting-up"><span>Setting up</span></a></h3>',7),D={class:"hint-container details"},_=n("summary",null,"Setting up",-1),S=n("p",null,"In this technique project we're going to return to project 7 to solve a critical problem using one of the most important Apple frameworks available: Grand Central Dispatch, or GCD. I already mentioned the problem to you, but here's a recap from project 7:",-1),x=n("p",null,[n("em",null,[a("By downloading data from the internet in "),n("code",null,"viewDidLoad()"),a(" our app will lock up until all the data has been transferred. There are solutions to this, but to avoid complexity they won't be covered until project 9.")])],-1),q=n("p",null,"We're going to solve this problem by using GCD, which will allow us to fetch the data without locking up the user interface. But be warned: even though GCD might seem easy at first, it opens up a new raft of problems, so be careful!",-1),j=n("p",null,"If you want to keep your previous work for reference, take a copy of project 7 now and call it project 9. Otherwise, just modify it in place.",-1),I=n("h3",{id:"why-is-locking-the-ui-bad",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#why-is-locking-the-ui-bad"},[n("span",null,"Why is locking the UI bad?")])],-1),T={class:"hint-container details"},C=n("summary",null,"Why is locking the UI bad?",-1),U=l("<p>The answer is two-fold. First, we used Data&#39;s contentsOf to download data from the internet, which is what&#39;s known as a <em>blocking</em> call. That is, it blocks execution of any further code in the method until it has connected to the server and fully downloaded all the data.</p><p>Second, behind the scenes your app actually executes multiple sets of instructions at the same time, which allows it to take advantage of having multiple CPU cores. Each CPU can be doing something independently of the others, which hugely boosts your performance. These code execution processes are called <em>threads</em>, and come with a number of important provisos:</p><ol><li>Threads execute the code you give them, they don&#39;t just randomly execute a few lines from <code>viewDidLoad()</code> each. This means by default your own code executes on only one CPU, because you haven&#39;t created threads for other CPUs to work on.</li><li>All user interface work must occur on the main thread, which is the initial thread your program is created on. If you try to execute code on a different thread, it might work, it might fail to work, it might cause unexpected results, or it might just crash.</li><li>You don&#39;t get to control when threads execute, or in what order. You create them and give them to the system to run, and the system handles executing them as best it can.</li><li>Because you don&#39;t control the execution order, you need to be extra vigilant in your code to ensure only one thread modifies your data at one time.</li></ol><p>Points 1 and 2 explain why our call is bad: if all user interface code must run on the main thread, and we just blocked the main thread by using <code>Data</code>&#39;s <code>contentsOf</code>, it causes the entire program to freeze – the user can touch the screen all they want, but nothing will happen. When the data finally downloads (or just fails), the program will unfreeze. This is a terrible experience, particularly when you consider that iPhones are frequently on poor-quality data connections.</p><p>Broadly speaking, if you’re accessing any remote resource, you should be doing it on a <em>background thread</em> – i.e., any thread that is not the main thread. If you&#39;re executing any slow code, you should be doing it on a background thread. If you&#39;re executing any code that can be run in parallel – e.g. adding a filter to 100 photos – you should be doing it on multiple background threads.</p><p>The power of GCD is that it takes away a lot of the hassle of creating and working with multiple threads, known as <em>multithreading</em>. You don&#39;t have to worry about creating and destroying threads, and you don&#39;t have to worry about ensuring you have created the optimal number of threads for the current device. GCD automatically creates threads for you, and executes your code on them in the most efficient way it can.</p><p>To fix our project, you need to learn three new GCD functions, but the most important one is called <code>async()</code> – it means &quot;run the following code asynchronously,&quot; i.e. don&#39;t block (stop what I&#39;m doing right now) while it&#39;s executing. Yes, that seems simple, but there&#39;s a sting in the tail: you need to use closures. Remember those? They are your best friend. No, really.</p>",7),B=n("h3",{id:"gcd-101-async",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#gcd-101-async"},[n("span",null,[a("GCD 101: "),n("code",null,"async()")])])],-1),G={class:"hint-container details"},O=n("summary",null,"GCD 101: async()",-1),E=l(`<p>We&#39;re going to use <code>async()</code> twice: once to push some code to a background thread, then once more to push code back to the main thread. This allows us to do any heavy lifting away from the user interface where we don&#39;t block things, but then update the user interface safely on the main thread – which is the only place it can be safely updated.</p><p>How you call <code>async()</code> informs the system where you want the code to run. GCD works with a system of queues, which are much like a real-world queue: they are First In, First Out (FIFO) blocks of code. What this means is that your GCD calls don&#39;t create threads to run in, they just get assigned to one of the existing threads for GCD to manage.</p><p>GCD creates for you a number of queues, and places tasks in those queues depending on how important you say they are. All are FIFO, meaning that each block of code will be taken off the queue in the order they were put in, but more than one code block can be executed at the same time so the finish order isn&#39;t guaranteed.</p><p>“How important” some code is depends on something called “quality of service”, or QoS, which decides what level of service this code should be given. Obviously at the top of this is the main queue, which runs on your main thread, and should be used to schedule any work that must update the user interface immediately even when that means blocking your program from doing anything else. But there are four background queues that you can use, each of which has their own QoS level set:</p><ol><li>User Interactive: this is the highest priority background thread, and should be used when you want a background thread to do work that is important to keep your user interface working. This priority will ask the system to dedicate nearly all available CPU time to you to get the job done as quickly as possible.</li><li>User Initiated: this should be used to execute tasks requested by the user that they are now waiting for in order to continue using your app. It&#39;s not as important as user interactive work – i.e., if the user taps on buttons to do other stuff, that should be executed first – but it is important because you&#39;re keeping the user waiting.</li><li>The Utility queue: this should be used for long-running tasks that the user is aware of, but not necessarily desperate for now. If the user has requested something and can happily leave it running while they do something else with your app, you should use Utility.</li><li>The Background queue: this is for long-running tasks that the user isn&#39;t actively aware of, or at least doesn&#39;t care about its progress or when it completes.</li></ol><p>Those QoS queues affect the way the system prioritizes your work: User Interactive and User Initiated tasks will be executed as quickly as possible regardless of their effect on battery life, Utility tasks will be executed with a view to keeping power efficiency as high as possible without sacrificing too much performance, whereas Background tasks will be executed with power efficiency as its priority.</p><p>GCD automatically balances work so that higher priority queues are given more time than lower priority ones, even if that means temporarily delaying a background task because a user interactive task just came in.</p><p>There’s also one more option, which is the default queue. This is prioritized between user-initiated and utility, and is a good general-purpose choice while you’re learning.</p><p>Enough talking, time for some action: we&#39;re going to use <code>async()</code> to make all our loading code run in the background queue with default quality of service. It&#39;s actually only two lines of code different:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>…before the code you want to run in the background, then a closing brace at the end. If you wanted to specify the user-initiated quality of service rather than use the default queue – which is a good choice for this scenario – you would write this instead:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span>qos<span class="token punctuation">:</span> <span class="token punctuation">.</span>userInitiated<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The <code>async()</code> method takes one parameter, which is a closure to execute asynchronously. We’re using trailing closure syntax, which removes an unneeded set of parentheses.</p><p>Because <code>async()</code> uses closures, you might think to start with <code>[weak self] in</code> to make sure there aren’t any accident strong reference cycles, but it isn’t necessary here because GCD runs the code once then throws it away – it won’t retain things used inside.</p><p>To help you place it correctly, here&#39;s how the loading code should look:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span>qos<span class="token punctuation">:</span> <span class="token punctuation">.</span>userInitiated<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> urlString<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">:</span> data<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">showError</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note that because our code is now inside a closure, we need to prefix our method calls with <code>self.</code> otherwise Swift complains.</p><p>If you want to try the other QoS queues, you could also use <code>.userInteractive</code>, <code>.utility</code> or <code>.background</code>.</p>`,18),P=n("h3",{id:"back-to-the-main-thread-dispatchqueue-main",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#back-to-the-main-thread-dispatchqueue-main"},[n("span",null,[a("Back to the main thread: "),n("code",null,"DispatchQueue.main")])])],-1),N={class:"hint-container details"},Q=n("summary",null,"Back to the main thread: DispatchQueue.main",-1),A=l(`<p>With this change, our code is both better and worse. It&#39;s better because it no longer blocks the main thread while the JSON downloads from Whitehouse.gov. It&#39;s worse because we&#39;re pushing work to the background thread, <em>and any further code called in that work will also be on the background thread</em>.</p><p>This change also introduced some confusion: the <code>showError()</code> call will get called regardless of what the loading does. Yes, there’s still a call to <code>return</code> in the code, but it now effectively does nothing – it’s returning from the closure that was being executed asynchronously, not from the whole method.</p><p>The combination of these problems means that regardless of whether the download succeeds or fails, <code>showError()</code> will be called. And if the download succeeds, the JSON will be parsed on the background thread and the table view&#39;s <code>reloadData()</code> will be called on the background thread – and the error will be shown regardless.</p><p>Let’s fix those problems, starting with the user interface background work. It&#39;s OK to parse the JSON on a background thread, but <em>it&#39;s never OK to do user interface work there</em>.</p><p>That&#39;s so important it bears repeating twice: <strong>it&#39;s never OK to do user interface work on the background thread.</strong></p><p>If you&#39;re on a background thread and want to execute code on the main thread, you need to call <code>async()</code> again. This time, however, you do it on <code>DispatchQueue.main</code>, which is the main thread, rather than one of the global quality of service queues.</p><p>We <em>could</em> modify our code to have <code>async()</code> before every call to <code>showError()</code> and <code>parse()</code>, but that&#39;s both ugly and inefficient. Instead, it&#39;s better to place the <code>async()</code> call inside <code>showError(),</code> wrapping up the whole <code>UIAlertController</code> code, and also inside <code>parse()</code>, but only where the table view is being reloaded. The actual JSON parsing can happily stay on the background thread.</p><p>So, inside the <code>parse()</code> method find this code:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line">tableView<span class="token punctuation">.</span><span class="token function">reloadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>…and replace it with this new code, bearing in mind again the need for <code>self.</code> to make our capturing clear:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span><span class="token function">reloadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To stop <code>showError()</code> being called regardless of the result of our fetch call, we need to move it inside the call to <code>DispatchQueue.global()</code> in <code>viewDidLoad()</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span>qos<span class="token punctuation">:</span> <span class="token punctuation">.</span>userInitiated<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> urlString<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">:</span> data<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Remember, we need to add <code>self.</code> to the <code>showError()</code> call because it’s inside a closure now.</p><p>But this has created a second problem: <code>showError()</code> creates and shows a <code>UIAlertController</code> – we now have user interface work happening on a background thread, which is always a bad idea.</p><p>So, we need to modify <code>showError()</code> to push that work back to the main thread, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">showError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Loading error&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;There was a problem loading the feed; please check your connection and try again.&quot;</span></span><span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>alert<span class="token punctuation">)</span></span>
<span class="line">        ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;OK&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At this point, this code is in a better place: we do all the slow work off the main thread, then push work back to the main thread when we want to do user interface work. This background/foreground bounce is common, and you&#39;ll see it again in later projects.</p>`,18),W=n("h3",{id:"easy-gcd-using-performselector-inbackground",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#easy-gcd-using-performselector-inbackground"},[n("span",null,[a("Easy GCD using "),n("code",null,"performSelector(inBackground:)")])])],-1),V={class:"hint-container details"},J=n("summary",null,"Easy GCD using performSelector(inBackground:)",-1),F=l(`<p>There’s another way of using GCD, and it’s worth covering because it’s a great deal easier in some specific circumstances. It’s called <code>performSelector()</code>, and it has two interesting variants: <code>performSelector(inBackground:)</code> and <code>performSelector(onMainThread:)</code>.</p><p>Both of them work the same way: you pass it the name of a method to run, and <code>inBackground</code> will run it on a background thread, and <code>onMainThread</code> will run it on a foreground thread. You don’t have to care about how it’s organized; GCD takes care of the whole thing for you. If you intend to run a whole method on either a background thread or the main thread, these two are easiest.</p><p>For project 7, we can use this method to clear up the confusion with our <code>showError()</code> method. For example, we could refactor the fetching code into a <code>fetchJSON()</code> method that can then run in the background like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">performSelector</span><span class="token punctuation">(</span>inBackground<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>fetchJSON<span class="token punctuation">)</span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute atrule">@objc</span> <span class="token keyword">func</span> <span class="token function-definition function">fetchJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> urlString<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> navigationController<span class="token operator">?</span><span class="token punctuation">.</span>tabBarItem<span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span></span>
<span class="line">        urlString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;https://api.whitehouse.gov/v1/petitions.json?limit=100&quot;</span></span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        urlString <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;https://api.whitehouse.gov/v1/petitions.json?signatureCountFloor=10000&amp;limit=100&quot;</span></span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> urlString<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">:</span> data<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">performSelector</span><span class="token punctuation">(</span>onMainThread<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>showError<span class="token punctuation">)</span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> waitUntilDone<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">func</span> <span class="token function-definition function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">:</span> <span class="token class-name">Data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> decoder <span class="token operator">=</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> jsonPetitions <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">Petitions</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> json<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        petitions <span class="token operator">=</span> jsonPetitions<span class="token punctuation">.</span>results</span>
<span class="line">        tableView<span class="token punctuation">.</span><span class="token function">performSelector</span><span class="token punctuation">(</span>onMainThread<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span><span class="token class-name">UITableView</span><span class="token punctuation">.</span>reloadData<span class="token punctuation">)</span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> waitUntilDone<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token attribute atrule">@objc</span> <span class="token keyword">func</span> <span class="token function-definition function">showError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Loading error&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;There was a problem loading the feed; please check your connection and try again.&quot;</span></span><span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>alert<span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;OK&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As you can see, it makes your code easier because you don’t need to worry about closure capturing, so we’ll come back to this again in the future. Note: because <code>performSelector()</code> uses <code>#selector</code>, we need to mark both <code>fetchJSON()</code> and <code>showError()</code> with the <code>@objc</code> attribute.</p><p>Because the code is now much simpler, we can add an <code>else</code> block to our JSON decoding, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">if</span> <span class="token keyword">let</span> jsonPetitions <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">Petitions</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> json<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    petitions <span class="token operator">=</span> jsonPetitions<span class="token punctuation">.</span>results</span>
<span class="line">    tableView<span class="token punctuation">.</span><span class="token function">performSelector</span><span class="token punctuation">(</span>onMainThread<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span><span class="token class-name">UITableView</span><span class="token punctuation">.</span>reloadData<span class="token punctuation">)</span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> waitUntilDone<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">performSelector</span><span class="token punctuation">(</span>onMainThread<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>showError<span class="token punctuation">)</span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> waitUntilDone<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This refactored code also makes the <code>return</code> call inside <code>fetchJSON()</code> work as intended: the <code>showError()</code> method is never called when things go well, because the whole method is exited. What you choose depends on your project’s needs, but I think it’s much easier to understand the program flow using this final approach.</p>`,8),L=n("hr",null,null,-1);function R(u,z){const e=r("router-link"),t=r("VPCard"),p=r("VidStack");return m(),h("div",null,[n("h1",f,[n("a",g,[n("span",null,k(u.$frontmatter.title)+" 관련",1)])]),n("nav",y,[n("ul",null,[n("li",null,[s(e,{to:"#project-9-part-one"},{default:o(()=>[a("Project 9, part one")]),_:1}),n("ul",null,[n("li",null,[s(e,{to:"#setting-up"},{default:o(()=>[a("Setting up")]),_:1})]),n("li",null,[s(e,{to:"#why-is-locking-the-ui-bad"},{default:o(()=>[a("Why is locking the UI bad?")]),_:1})]),n("li",null,[s(e,{to:"#gcd-101-async"},{default:o(()=>[a("GCD 101: async()")]),_:1})]),n("li",null,[s(e,{to:"#back-to-the-main-thread-dispatchqueue-main"},{default:o(()=>[a("Back to the main thread: DispatchQueue.main")]),_:1})]),n("li",null,[s(e,{to:"#easy-gcd-using-performselector-inbackground"},{default:o(()=>[a("Easy GCD using performSelector(inBackground:)")]),_:1})])])])])]),b,s(t,i(c({title:"100 Days of Swift - Day 39",desc:"Project 9, part one",link:"https://www.hackingwithswift.com/100/39",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),v,n("details",D,[_,s(t,i(c({title:"100 Days of Swift - Day 39 - Setting up",desc:"Setting up",link:"https://hackingwithswift.com/read/9/1/setting-up",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),s(p,{src:"youtube/u7ovZkewpHc"}),S,x,q,j]),I,n("details",T,[C,s(t,i(c({title:"100 Days of Swift - Day 39 - Why is locking the UI bad?",desc:"Why is locking the UI bad?",link:"https://hackingwithswift.com/read/9/2/why-is-locking-the-ui-bad",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),s(p,{src:"youtube/tMsa3b9stCY"}),U]),B,n("details",G,[O,s(t,i(c({title:"100 Days of Swift - Day 39 - GCD 101: async()",desc:"GCD 101: async()",link:"https://hackingwithswift.com/read/9/3/gcd-101-async",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),s(p,{src:"youtube/SrWWLx5wOEU"}),E]),P,n("details",N,[Q,s(t,i(c({title:"100 Days of Swift - Day 39 - Back to the main thread: DispatchQueue.main",desc:"Back to the main thread: DispatchQueue.main",link:"https://hackingwithswift.com/read/9/4/back-to-the-main-thread-dispatchqueuemain",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),s(p,{src:"youtube/8Q7JNnPBvXw"}),A]),W,n("details",V,[J,s(t,i(c({title:"100 Days of Swift - Day 39 - Easy GCD using performSelector(inBackground:)",desc:"Easy GCD using performSelector(inBackground:)",link:"https://hackingwithswift.com/read/9/5/easy-gcd-using-performselectorinbackground",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),s(p,{src:"youtube/T5_QS7Y7TuI"}),F]),L])}const Y=d(w,[["render",R],["__file","39.html.vue"]]),H=JSON.parse('{"path":"/swift/100-days-of-swift/39.html","title":"Day 39","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Day 39","description":"100 Days of Swift > Day 39","category":["Swift"],"tag":["crashcourse","paul-hudson","swift","hacking-with-swift","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"100 Days of Swift > Day 39"},{"property":"og:description","content":"Day 39"},{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/swift/100-days-of-swift/39.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/crashcourse/swift/100-days-of-swift/39.html"}],["meta",{"property":"og:site_name","content":"🥁Crashcourse"}],["meta",{"property":"og:title","content":"Day 39"}],["meta",{"property":"og:description","content":"100 Days of Swift > Day 39"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2024-10-03T01:20:13.000Z"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"paul-hudson"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"hacking-with-swift"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:modified_time","content":"2024-10-03T01:20:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Day 39\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-03T01:20:13.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Project 9, part one","slug":"project-9-part-one","link":"#project-9-part-one","children":[{"level":3,"title":"Setting up","slug":"setting-up","link":"#setting-up","children":[]},{"level":3,"title":"Why is locking the UI bad?","slug":"why-is-locking-the-ui-bad","link":"#why-is-locking-the-ui-bad","children":[]},{"level":3,"title":"GCD 101: async()","slug":"gcd-101-async","link":"#gcd-101-async","children":[]},{"level":3,"title":"Back to the main thread: DispatchQueue.main","slug":"back-to-the-main-thread-dispatchqueue-main","link":"#back-to-the-main-thread-dispatchqueue-main","children":[]},{"level":3,"title":"Easy GCD using performSelector(inBackground:)","slug":"easy-gcd-using-performselector-inbackground","link":"#easy-gcd-using-performselector-inbackground","children":[]}]}],"git":{"createdTime":1703642364000,"updatedTime":1727918413000,"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":9}]},"readingTime":{"minutes":10.28,"words":3085},"filePathRelative":"swift/100-days-of-swift/39.md","localizedDate":"2023년 12월 27일","excerpt":"\\n\\n<hr>\\n"}');export{Y as comp,H as data};

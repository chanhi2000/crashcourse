import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,a as n,t as w,b as a,w as l,n as c,g as p,d as s,e as r,r as e,o as m}from"./app-U_bew1in.js";const v={},f={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},g={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},y={class:"table-of-contents"},b=n("hr",null,null,-1),I=r('<h2 id="project-14-part-5" tabindex="-1"><a class="header-anchor" href="#project-14-part-5"><span>Project 14, part 5</span></a></h2><p>Today is the last day of coding for this project, and I‚Äôm sure you‚Äôre looking forward to the challenges and review tomorrow ‚Äì it should make a nice change from such a long tutorial.</p><p>First, though, we need to cover off two tricky topics, one of which will really challenge you because we‚Äôll remodel our code to use the MVVM design pattern. As you‚Äôll see, this helps separate logic from layout in our projects, but it takes a bit of thinking too ‚Äì not least because you need to understand the concept of the main actor.</p><p>While you‚Äôre working through today, chances are you‚Äôre really starting to feel the difficulty curve ramp up, because our projects are growing and size and complexity. I want to take this opportunity to remind you of a few things:</p><ol><li>You‚Äôre not alone; everyone is having to go through this same learning curve.</li><li>It‚Äôs a marathon, not a sprint; take your time and it will come.</li><li>It‚Äôs OK to take a break and come at a topic again later; having fresh eyes will help.</li><li>There is no learning without struggle; if you‚Äôre fighting to learn something, it will stick way better at the end.</li></ol><p>There‚Äôs a quote widely attributed to Confucius that you would do well to remember: ‚Äúit doesn‚Äôt matter how slowly you go, as long as you don‚Äôt stop.‚Äù</p><p><strong>Today you have two topics to work through, in which you‚Äôll learn how to write data to disk securely, and how to enable biometric authentication.</strong></p><h3 id="introducing-mvvm-into-your-swiftui-project" tabindex="-1"><a class="header-anchor" href="#introducing-mvvm-into-your-swiftui-project"><span>Introducing MVVM into your SwiftUI project</span></a></h3>',8),_={class:"hint-container details"},j=n("summary",null,"Introducing MVVM into your SwiftUI project",-1),x=n("p",null,[s("So far I‚Äôve introduced you to a range of concepts across Swift and SwiftUI, and I‚Äôve also dropped a few tips on ways to organize your code better. Well, here I want to explore that latter part a bit further: we‚Äôre going to look at what is commonly called a "),n("strong",null,"software architecture"),s(", or the more grandiose name an "),n("strong",null,"architectural design pattern"),s(" ‚Äì really it‚Äôs just a particular way of structuring your code.")],-1),V=n("p",null,"The pattern we‚Äôre going to look at is called MVVM, which is an acronym standing for Model View View-Model. This is a terrifically bad name, and thoroughly confuses people, but I‚Äôm afraid we‚Äôre rather stuck with it at this point. There is no single definition of what is MVVM, and you‚Äôll find all sorts of people arguing about it online, but that‚Äôs okay ‚Äì here we‚Äôre going to keep it simple, and use MVVM as a way of getting some of our program state and logic out of our view structs. We are, in effect, separating logic from layout.",-1),S=n("code",null,"ContentView-ViewModel.swift",-1),M=n("code",null,"ContentView",-1),D=r(`<p>We‚Äôre going to start with two trivial things, then build our way up from there. First, create a new class that uses the <code>Observable</code> macro, so we‚Äôre able to report changes back to any SwiftUI view that‚Äôs watching:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@Observable</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ViewModel</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Second, I want you to place that new class <em>inside</em> an extension on <code>ContentView</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">extension</span> <span class="token class-name">ContentView</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute atrule">@Observable</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">ViewModel</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now we‚Äôre saying this isn‚Äôt just <em>any</em> view model, it‚Äôs the view model for <code>ContentView</code>. Later on it will be your job to add a second view model to handle <code>EditView</code>, so you can try seeing how the concepts map elsewhere.</p><p><strong>Tip</strong>: I get lots of questions about why I place my view models into view extensions, so I&#39;d like to take a moment to explain why. This is a small app, but think about how this would look when you have 10 views, or 50 views, or even 500 views. If you use extensions like this, the view model for your current view is always just called <code>ViewModel</code>, and not <code>EditMapLocationViewModel</code> or similar ‚Äì it&#39;s much shorter, and avoids cluttering up your code with lots of different class names!</p><p>Now that we have our class in place, we get to choose which pieces of state from our view should be moved into the view model. Some people will tell you to move all of it, others will be more selective, and that‚Äôs okay ‚Äì again, there is no single definition of what MVVM looks like, so I‚Äôm going to provide you with the tools and knowledge to experiment yourself.</p><p>Let‚Äôs start with the easy stuff: move both <code>@State</code> properties in <code>ContentView</code> over to its view model, removing the <code>@State private</code> parts because they aren&#39;t needed any more:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">extension</span> <span class="token class-name">ContentView</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute atrule">@Observable</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">ViewModel</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">var</span> locations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">Location</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">var</span> selectedPlace<span class="token punctuation">:</span> <span class="token class-name">Location</span><span class="token operator">?</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And now we can replace all those properties in <code>ContentView</code> with a single one:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> viewModel <span class="token operator">=</span> <span class="token class-name">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Tip</strong>: This is a good example of why placing view models inside extensions is helpful ‚Äì we just say <code>ViewModel</code> and we automatically get the correct view model type for the current view.</p><p>That will of course break a lot of code, but the fixes are easy ‚Äì just add <code>viewModel</code> in various places. So, <code>locations</code> becomes <code>$viewModel.locations</code>, and <code>selectedPlace</code> becomes <code>viewModel.selectedPlace</code>.</p><p>Once you‚Äôve added that everywhere your code will compile again, but you might wonder how this has helped ‚Äì haven‚Äôt we just moved our code from one place to another? Well, yes, but there is an important distinction that will become clearer as your skills grow: having all this functionality in a separate class makes it much easier to write tests for your code.</p><p>Views work best when they handle presentation of data, meaning that <em>manipulation</em> of data is a great candidate for code to move into a view model. With that in mind, if you have a look through your <code>ContentView</code> code you might notice two places our view does more work than it ought to: adding a new location and updating an existing location, both of which root around inside the internal data of our view model.</p><p><em>Reading</em> data from a view model‚Äôs properties is usually fine, but <em>writing</em> it isn‚Äôt because the whole point of this exercise is to separate logic from layout. You can find these two places immediately if we clamp down on writing view model data ‚Äì modify the <code>locations</code> property in your view model to this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">private</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span> <span class="token keyword">var</span> locations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">Location</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Now we‚Äôve said that reading locations is fine, but only the class itself can <em>write</em> locations. Immediately Xcode will point out the two places where we need to get code out of the view: adding a new location, and updating an existing one.</p><p>So, we can start by adding a new method to the view model to handle adding a new location. First, add an import for <code>CoreLocation</code> to the top, then add this method to the class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">addLocation</span><span class="token punctuation">(</span>at point<span class="token punctuation">:</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> newLocation <span class="token operator">=</span> <span class="token class-name">Location</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;New location&quot;</span></span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span> latitude<span class="token punctuation">:</span> point<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">:</span> point<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span></span>
<span class="line">    locations<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>newLocation<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That can then be used from the tap gesture in <code>ContentView</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token punctuation">.</span>onTapGesture <span class="token punctuation">{</span> position <span class="token keyword">in</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> coordinate <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> from<span class="token punctuation">:</span> <span class="token punctuation">.</span>local<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        viewModel<span class="token punctuation">.</span><span class="token function">addLocation</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> coordinate<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The second problematic place is updating a location, so I want you to cut that whole <code>if let index</code> check to your clipboard, then paste it into a new method in the view model, adding in a check that we have a selected place to work with:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span>location<span class="token punctuation">:</span> <span class="token class-name">Location</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> selectedPlace <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> index <span class="token operator">=</span> locations<span class="token punctuation">.</span><span class="token function">firstIndex</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> selectedPlace<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        locations<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> location</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You&#39;ll need to adjust the code just a little, including making sure to remove the two <code>viewModel</code> references from there ‚Äì they aren‚Äôt needed any more.</p><p>Now the <code>EditView</code> sheet in <code>ContentView</code> can just pass its data onto the view model:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">EditView</span><span class="token punctuation">(</span>location<span class="token punctuation">:</span> place<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    viewModel<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>location<span class="token punctuation">:</span> <span class="token short-argument">$0</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At this point the view model has taken over all aspects of <code>ContentView</code>, which is great: the view is there to present data, and the view model is there to <em>manage</em> data. The split isn‚Äôt always quite as clean as that, despite what you might hear elsewhere online, and again that‚Äôs okay ‚Äì once you move into more advanced projects you‚Äôll find that ‚Äúone size fits all‚Äù approaches usually fit nobody, so we just do our best with what we have.</p><p>Anyway, in this case now that we have our view model all set up, we can upgrade it to support loading and saving of data. This will look in the documents directory for a particular file, then use either <code>JSONEncoder</code> or <code>JSONDecoder</code> to convert it ready for use.</p><p>Previously I showed you how to locate your app&#39;s documents directory and create filenames inside there, but I <em>don‚Äôt</em> want to do that when both loading and saving files because it means if we ever change our save location we need to remember to update both places.</p><p>So, a better idea is to add a new property to our view model to store the location we‚Äôre saving to:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> savePath <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span>documentsDirectory<span class="token punctuation">.</span><span class="token function">appending</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;SavedPlaces&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And with that in place we can create a new initializer and a new <code>save()</code> method that makes sure our data is saved automatically. Start by adding this to the view model:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> savePath<span class="token punctuation">)</span></span>
<span class="line">        locations <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">Location</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> data<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">        locations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As for saving, previously I showed you how to write a string to disk, but the <code>Data</code> version is even better because it lets us do something quite amazing in just one line of code: we can ask iOS to ensure the file is written with encryption so that it can only be read once the user has unlocked their device. This is in <em>addition</em> to requesting atomic writes ‚Äì iOS does almost all the work for us.</p><p>Add this method to the view model now:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">do</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>locations<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">try</span> data<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> savePath<span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>atomic<span class="token punctuation">,</span> <span class="token punctuation">.</span>completeFileProtection<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Unable to save data.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Yes, all it takes to ensure that the file is stored with strong encryption is to add <code>.completeFileProtection</code> to the data writing options.</p><p>Using this approach we can write any amount of data in any number of files ‚Äì it‚Äôs much more flexible than <code>UserDefaults</code>, and also allows us to load and save data as needed rather than immediately when the app launches as with <code>UserDefaults</code>.</p><p>Before we‚Äôre done with this step, we need to make a handful of small changes to our view model so that uses the code we just wrote.</p><p>First, the <code>locations</code> array no longer needs to be initialized to an empty array, because that‚Äôs handled by the initializer. Change it to this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">private</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span> <span class="token keyword">var</span> locations<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Location</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And second, we need to call the <code>save()</code> method after adding a new location or after updating an existing one, so add <code>save()</code> to the end of both those methods.</p><p>Go ahead and run the app now, and you should find that you can add items freely, then relaunch the app to see them restored just as they were.</p><p>That took quite a bit of code in total, but the end result is that we have loading and saving done really well:</p><ul><li>All the logic is handled outside the view, so later on when you learn to write tests you‚Äôll find the view model is much easier to work with.</li><li>When we write data we‚Äôre making iOS encrypt it so the file can‚Äôt be read or written until the user unlocks their device.</li><li>The load and save process is almost transparent ‚Äì our view has no idea it&#39;s even happening.</li></ul><p>Sometimes people ask me why I didn&#39;t introduce MVVM earlier in the course, and there are two primary answers:</p><ol><li>It works really badly with SwiftData, at least right now. This might improve in the future, but right now using SwiftData is basically impossible with MVVM.</li><li>There are lots of ways of structuring projects, with MVVM being just one of many. Spend some time experimenting rather than locking yourself into the first idea that comes along.</li></ol><p>Of course, our app isn‚Äôt truly secure yet: we‚Äôve ensured our data file is saved out using encryption so that it can only be read once the device has been unlocked, but there‚Äôs nothing stopping someone else from reading the data afterwards.</p>`,49),T=n("h3",{id:"locking-our-ui-behind-face-id",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#locking-our-ui-behind-face-id"},[n("span",null,"Locking our UI behind Face ID")])],-1),U={class:"hint-container details"},C=n("summary",null,"Locking our UI behind Face ID",-1),L=r(`<p>To finish off our app, we‚Äôre going to make one last important change: we‚Äôre going to require the user to authenticate themselves using either Touch ID or Face ID in order to see all the places they have marked on the app. After all, this is their private data and we should be respectful of that, and of course it gives me a chance to let you use an important skill in a practical context!</p><p>First we need some new state in our view model that tracks whether the app is unlocked or not. So, start by adding this new property:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">var</span> isUnlocked <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Second, we need to add the Face ID permission request key to our project configuration options, explaining to the user why we want to use Face ID. If you haven‚Äôt added this already, go to your target options now, select the Info tab, then right-click on any existing row and add the ‚ÄúPrivacy - Face ID Usage Description‚Äù key there. You can enter what you like, but ‚ÄúPlease authenticate yourself to unlock your places‚Äù seems like a good choice.</p><p>Third, we need to add <code>import LocalAuthentication</code> to the top of your view model‚Äôs file, so we have access to Apple‚Äôs authentication framework.</p><p>And now for the hard part. If you recall, the code for biometric authentication was a teensy bit unpleasant because of its Objective-C roots, so it‚Äôs always a good idea to get it far away from the neatness of SwiftUI. So, we‚Äôre going to write a dedicated <code>authenticate()</code> method that handles all the biometric work:</p><ol><li>Creating an <code>LAContext</code> so we have something that can check and perform biometric authentication.</li><li>Ask it whether the current device is capable of biometric authentication.</li><li>If it is, start the request and provide a closure to run when it completes.</li><li>When the request finishes, check the result.</li><li>If it was successful, we‚Äôll set <code>isUnlocked</code> to true so we can run our app as normal.</li></ol><p>Add this method to your view model now:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token class-name">LAContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">var</span> error<span class="token punctuation">:</span> <span class="token class-name">NSError</span><span class="token operator">?</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> context<span class="token punctuation">.</span><span class="token function">canEvaluatePolicy</span><span class="token punctuation">(</span><span class="token punctuation">.</span>deviceOwnerAuthenticationWithBiometrics<span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token operator">&amp;</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> reason <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Please authenticate yourself to unlock your places.&quot;</span></span></span>
<span class="line"></span>
<span class="line">        context<span class="token punctuation">.</span><span class="token function">evaluatePolicy</span><span class="token punctuation">(</span><span class="token punctuation">.</span>deviceOwnerAuthenticationWithBiometrics<span class="token punctuation">,</span> localizedReason<span class="token punctuation">:</span> reason<span class="token punctuation">)</span> <span class="token punctuation">{</span> success<span class="token punctuation">,</span> authenticationError <span class="token keyword">in</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">if</span> success <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">self</span><span class="token punctuation">.</span>isUnlocked <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// error</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// no biometrics</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Remember, the string in our code is used for Touch ID, whereas the string in Info.plist is used for Face ID.</p><p>And now we need to make an adjustment that is in reality very small, but can be hard to visualize if you‚Äôre reading this rather than watching the video. Everything inside the <code>body</code> property needs to be indented in by one level, and have this placed before it:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">if</span> viewModel<span class="token punctuation">.</span>isUnlocked <span class="token punctuation">{</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Then at the end of the <code>body</code> property add this to close the condition and leave space for an unlock button:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// button here</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>So now we all we need to do is fill in the <code>// button here</code> comment with an actual button that triggers the <code>authenticate()</code> method. You can design whatever you want, but something like this ought to be enough:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Unlock Places&quot;</span></span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> viewModel<span class="token punctuation">.</span>authenticate<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">foregroundStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">clipShape</span><span class="token punctuation">(</span><span class="token punctuation">.</span>capsule<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16),P=n("code",null,"[Face ID]",-1),F=n("code",null,"[Enrolled]",-1),A=n("code",null,"[Features]",-1),q=n("code",null,"[Face ID]",-1),O=n("code",null,"[Matching Face]",-1),N=n("p",null,"And with that our code is done, and that‚Äôs another app complete ‚Äì good job!",-1),E=n("p",null,"That‚Äôs another app done ‚Äì make sure and share your progress with the world!",-1),W=n("hr",null,null,-1);function z(d,R){const t=e("router-link"),o=e("VPCard"),u=e("VidStack"),i=e("FontIcon");return m(),k("div",null,[n("h1",f,[n("a",g,[n("span",null,w(d.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),n("nav",y,[n("ul",null,[n("li",null,[a(t,{to:"#project-14-part-5"},{default:l(()=>[s("Project 14, part 5")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#introducing-mvvm-into-your-swiftui-project"},{default:l(()=>[s("Introducing MVVM into your SwiftUI project")]),_:1})]),n("li",null,[a(t,{to:"#locking-our-ui-behind-face-id"},{default:l(()=>[s("Locking our UI behind Face ID")]),_:1})])])])])]),b,a(o,c(p({title:"100 Days of SwiftUI - Day 72",desc:"Project 14, part 5",link:"https://www.hackingwithswift.com/100/swiftui/72",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),I,n("details",_,[j,a(o,c(p({title:"100 Days of SwiftUI - Day 72 - Introducing MVVM into your SwiftUI project",desc:"Introducing MVVM into your SwiftUI project",link:"https://www.hackingwithswift.com/books/ios-swiftui/introducing-mvvm-into-your-swiftui-project",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),a(u,{src:"youtube/7S6iEmHICkQ"}),x,V,n("p",null,[s("We‚Äôll explore that definition as we go, but for now let‚Äôs start with the big stuff: make a new Swift file called "),a(i,{icon:"fa-brands fa-swift"}),S,s(", then give it an extra import for MapKit. We‚Äôre going to use this to create a new class that manages our data, and manipulates it on behalf of the "),M,s(" struct so that our view doesn‚Äôt really care how the underlying data system works.")]),D]),T,n("details",U,[C,a(o,c(p({title:"100 Days of SwiftUI - Day 72 - Locking our UI behind Face ID",desc:"Locking our UI behind Face ID",link:"https://www.hackingwithswift.com/books/ios-swiftui/locking-our-ui-behind-face-id",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),a(u,{src:"youtube/k1A0YTkMCxc"}),L,n("p",null,[s("You can now go ahead and run the app again, because our code is almost done. If this is the first time you‚Äôve used Face ID in the simulator you‚Äôll need to go to the Features menu and choose "),a(i,{icon:"iconfont icon-select"}),P,s(" > "),F,s(", but once you relaunch the app you can authenticate using "),a(i,{icon:"iconfont icon-select"}),A,s(" > "),q,s(" > "),O,s(".")]),N]),E,W])}const J=h(v,[["render",z],["__file","72.html.vue"]]),K=JSON.parse('{"path":"/swift/100-days-of-swiftui/72.html","title":"Day 72","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Day 72","description":"100 Days of SwiftUI > Day 72","category":["Swift"],"tag":["crashcourse","paul-hudson","swift","swiftui","hacking-with-swift","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"100 Days of SwiftUI > Day 72"},{"property":"og:description","content":"Day 72"},{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/swift/100-days-of-swiftui/72.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/crashcourse/swift/100-days-of-swiftui/72.html"}],["meta",{"property":"og:site_name","content":"ü•ÅCrashcourse"}],["meta",{"property":"og:title","content":"Day 72"}],["meta",{"property":"og:description","content":"100 Days of SwiftUI > Day 72"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2024-10-03T01:20:13.000Z"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"paul-hudson"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"swiftui"}],["meta",{"property":"article:tag","content":"hacking-with-swift"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:modified_time","content":"2024-10-03T01:20:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Day 72\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-03T01:20:13.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Project 14, part 5","slug":"project-14-part-5","link":"#project-14-part-5","children":[{"level":3,"title":"Introducing MVVM into your SwiftUI project","slug":"introducing-mvvm-into-your-swiftui-project","link":"#introducing-mvvm-into-your-swiftui-project","children":[]},{"level":3,"title":"Locking our UI behind Face ID","slug":"locking-our-ui-behind-face-id","link":"#locking-our-ui-behind-face-id","children":[]}]}],"git":{"createdTime":1704363136000,"updatedTime":1727918413000,"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":8}]},"readingTime":{"minutes":9.91,"words":2972},"filePathRelative":"swift/100-days-of-swiftui/72.md","localizedDate":"2024ÎÖÑ 1Ïõî 4Ïùº","excerpt":"\\n\\n<hr>\\n"}');export{J as comp,K as data};

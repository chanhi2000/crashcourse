import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,a as n,t as m,b as e,w as c,n as p,g as l,d as s,e as t,r as u,o as w}from"./app-U_bew1in.js";const f={},y={id:"frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´",tabindex:"-1"},g={class:"header-anchor",href:"#frontmatter-title-·ÑÄ·Ö™·Ü´·ÑÖ·Öß·Ü´"},v={class:"table-of-contents"},b=n("hr",null,null,-1),_=t('<h2 id="project-28-part-one" tabindex="-1"><a class="header-anchor" href="#project-28-part-one"><span>Project 28, part one</span></a></h2><p>Bruce Schneier ‚Äì a well-known US cryptographer, security analyst, and writer, once said ‚Äúif you think technology can solve your security problems, then you don&#39;t understand the problems and you don&#39;t understand the technology.‚Äù</p><p>You see, although computers are remarkable machines, ultimately they just do what we tell them ‚Äì albeit extraordinarily quickly. Way back in 2004, a Windows compression program called WinZip added AES encryption to their software, to help folks keep their data secure. AES was (and still is) a worldwide standard for quality encryption, but the problem was that WinZip screwed up their implementation so they managed to make it insecure. Back then, Bruce Schneier was already a titan in the security industry, and he said this: ‚Äúcryptography is hard, and simply using AES in a product does not magically make it secure.‚Äù</p><p>Fast forward to today, and you‚Äôve already learned how to store user data using <code>UserDefaults</code>, but there‚Äôs a problem: just putting data into <code>UserDefaults</code> does not magically make it secure. In fact, <code>UserDefaults</code> is anything <em>but</em> secure ‚Äì it‚Äôs possible to get data out of there easily, so it‚Äôs definitively the wrong place to store sensitive information.</p><p>To fix that ‚Äì to put data somewhere safe ‚Äì you need to learn how to use the iOS keychain, which is automatically encrypted by the system. To make things a little more spicy I‚Äôll also be introducing you to biometric authentication, which is a fancy way of saying you‚Äôll learn how to use Touch ID and Face ID.</p><p><strong>Today you have four topics to work through, and you‚Äôll learn about the LocalAuthentication framework and the iOS keychain, get some practice with <code>UITextView</code>, and more.</strong></p><h3 id="setting-up" tabindex="-1"><a class="header-anchor" href="#setting-up"><span>Setting up</span></a></h3>',7),I={class:"hint-container details"},x=n("summary",null,"Setting up",-1),T=n("p",null,"This project will introduce you to three important iOS technologies together: Touch ID, Face ID and the keychain. The first two are used to identify users biometrically using the fingerprint sensor on iPhones and iPads, or the face scanner on iPhone X or similar; the latter is a secure, encrypted data storage area on every device that you can read and write to.",-1),S=n("p",null,"Of course, there's little point learning about technologies without using them, so this project will have you build a secure text editor. Users can type whatever they want and have it saved, but to read it again they'll need to unlock the app using Touch ID or Face ID.",-1),D=n("p",null,[s("You might remember in project 12 that I said "),n("code",null,"UserDefaults"),s(" is great for its simplicity but isn't good for private data. Well, the keychain is securely encrypted, so we can be assured that data we put there is safe.")],-1),j=n("p",null,[s("This project is modeled on project 19, where you met "),n("code",null,"UITextView"),s(" for the first time. This means we'll need to use the same keyboard detection and adjustment code ‚Äì if you already completed project 19, you might find it easiest to copy and paste your code as needed.")],-1),A=n("p",null,"To get started, make a new Single View App project in Xcode named Project28.",-1),q=n("h3",{id:"the-basic-text-editor",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#the-basic-text-editor"},[n("span",null,"The basic text editor")])],-1),F={class:"hint-container details"},W=n("summary",null,"The basic text editor",-1),O=n("code",null,"Main.storyboard",-1),N=n("em",null,"not",-1),E=n("code",null,"secret",-1),U=n("code",null,"ViewController.swift",-1),C=t(`<p>We need to add the same code we used in project 19 to make the text view adjust its content and scroll insets when the keyboard appears and disappears. This code is identical apart from the outlet is called <code>secret</code> now.</p><p>First, put this into <code>viewDidLoad()</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> notificationCenter <span class="token operator">=</span> <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span></span>
<span class="line">notificationCenter<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> selector<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>adjustForKeyboard<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token class-name">UIResponder</span><span class="token punctuation">.</span>keyboardWillHideNotification<span class="token punctuation">,</span> object<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line">notificationCenter<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> selector<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>adjustForKeyboard<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token class-name">UIResponder</span><span class="token punctuation">.</span>keyboardWillChangeFrameNotification<span class="token punctuation">,</span> object<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As a reminder, that asks iOS to tell us when the keyboard changes or when it hides. As a double reminder: the hide is required because we do a little hack to make the hardware keyboard toggle work correctly ‚Äì see project 19 if you don&#39;t remember why this is needed.</p><p>Here&#39;s the <code>adjustKeyboard()</code> method, which again is identical apart from the outlet name to that seen in project 19:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@objc</span> <span class="token keyword">func</span> <span class="token function-definition function">adjustForKeyboard</span><span class="token punctuation">(</span>notification<span class="token punctuation">:</span> <span class="token class-name">Notification</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> keyboardValue <span class="token operator">=</span> notification<span class="token punctuation">.</span>userInfo<span class="token operator">?</span><span class="token punctuation">[</span><span class="token class-name">UIResponder</span><span class="token punctuation">.</span>keyboardFrameEndUserInfoKey<span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">NSValue</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> keyboardScreenEndFrame <span class="token operator">=</span> keyboardValue<span class="token punctuation">.</span>cgRectValue</span>
<span class="line">    <span class="token keyword">let</span> keyboardViewEndFrame <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>keyboardScreenEndFrame<span class="token punctuation">,</span> from<span class="token punctuation">:</span> view<span class="token punctuation">.</span>window<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> notification<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token class-name">UIResponder</span><span class="token punctuation">.</span>keyboardWillHideNotification <span class="token punctuation">{</span></span>
<span class="line">        secret<span class="token punctuation">.</span>contentInset <span class="token operator">=</span> <span class="token punctuation">.</span>zero</span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        secret<span class="token punctuation">.</span>contentInset <span class="token operator">=</span> <span class="token class-name">UIEdgeInsets</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">left</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> keyboardViewEndFrame<span class="token punctuation">.</span>height <span class="token operator">-</span> view<span class="token punctuation">.</span>safeAreaInsets<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> <span class="token keyword">right</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    secret<span class="token punctuation">.</span>scrollIndicatorInsets <span class="token operator">=</span> secret<span class="token punctuation">.</span>contentInset</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> selectedRange <span class="token operator">=</span> secret<span class="token punctuation">.</span>selectedRange</span>
<span class="line">    secret<span class="token punctuation">.</span><span class="token function">scrollRangeToVisible</span><span class="token punctuation">(</span>selectedRange<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),K=n("code",null,"Main.storyboard",-1),B=n("p",null,'Place a button over the text view, give it the title "Authenticate" and make it 44 points high. For constraints, give it a fixed height constraint, then make it align horizontally and vertically with its superview. Now use the assistant editor to create an action for it called ‚ÄúauthenticateTapped‚Äù.',-1),M=n("p",null,"Before you leave Interface Builder, you need to do something we haven't done yet, which is to move views backwards and forwards relative to each other. When the user has authenticated, we need to show the text box while making sure the button is no longer visible, and the easiest way to do that is to place the button behind the text view so that when the text is visible it covers up the button.",-1),P=n("p",null,[s("To move the text view to the front, select the Authenticate button in the document outline then drag it "),n("em",null,"above"),s(" the text view. When you do this the button will disappear on the canvas, but that's OK ‚Äì it's still there, and we can still use it.")],-1),L=n("p",null,"The last thing to do is ensure the text view starts life hidden, so select it in Interface Builder, choose the attributes inspector, and check the Hidden box ‚Äì it's near the bottom, not far below Tag. That's our layout complete!",-1),R=n("h3",{id:"writing-somewhere-safe-the-ios-keychain",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#writing-somewhere-safe-the-ios-keychain"},[n("span",null,"Writing somewhere safe: the iOS keychain")])],-1),V={class:"hint-container details"},H=n("summary",null,"Writing somewhere safe: the iOS keychain",-1),z=t(`<p>When the app first runs, users should see a totally innocuous screen, with nothing secret visible. But we also don&#39;t want secret information to be visible when the user leaves the app for a moment then comes back, or if they double-tap the home button to multitask ‚Äì doing so might mean that the app is left unlocked, which is the last thing we want.</p><p>To make this work, let&#39;s start by giving the view controller a totally innocuous title that absolutely won&#39;t make anyone wonder what&#39;s going on. Put this into viewDidLoad():</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line">title <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Nothing to see here&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Next we&#39;re going to create two new methods: <code>unlockSecretMessage()</code> to load the message into the text view, and <code>saveSecretMessage()</code>. But before we do that, I want to introduce you to a helpful class called <code>KeychainWrapper</code>, which we&#39;ll be using to read and write keychain values.</p><p>This class was not made by Apple; instead, it&#39;s open source software released under the MIT license, which means we can use it in our own projects as long as the copyright message remains intact. This class is needed because working with the keychain is <em>complicated</em> ‚Äì far harder than anything we have done so far. So instead of using it directly, we&#39;ll be using this wrapper class that makes the keychain work like <code>UserDefaults</code>.</p>`,5),Y={href:"https://github.com/twostraws/HackingWithSwift",target:"_blank",rel:"noopener noreferrer"},Z=n("code",null,"twostraws/HackingWithSwift",-1),X=n("code",null,"KeychainWrapper.swift",-1),J=n("code",null,"KeychainItemAccessibility.swift",-1),Q=t(`<p>The first of our two new methods, <code>unlockSecretMessage()</code>, needs to show the text view, then load the keychain&#39;s text into it. Loading strings from the keychain using <code>KeychainWrapper</code> is as simple as using its <code>string(forKey:)</code> method, but the result is optional so you should unwrap it once you know there&#39;s a value there.</p><p>Here it is:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">unlockSecretMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    secret<span class="token punctuation">.</span>isHidden <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">    title <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Secret stuff!&quot;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token class-name">KeychainWrapper</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;SecretMessage&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        secret<span class="token punctuation">.</span>text <span class="token operator">=</span> text</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you prefer, you can use nil coalescing to provide the default value of an empty string, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">unlockSecretMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    secret<span class="token punctuation">.</span>isHidden <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">    title <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Secret stuff!&quot;</span></span></span>
<span class="line"></span>
<span class="line">    secret<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token class-name">KeychainWrapper</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;SecretMessage&quot;</span></span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Use whichever you prefer!</p><p>The second of our two new methods, <code>saveSecretMessage()</code>, needs to write the text view&#39;s text to the keychain, then make it hidden. This is done using the <code>set()</code> method of <code>KeychainWrapper</code>, so it&#39;s just as easy as reading. Note that we should only execute this code if the text view is visible, otherwise if a save happens before the app is unlocked then it will overwrite the saved text!</p><p>Here&#39;s the code:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@objc</span> <span class="token keyword">func</span> <span class="token function-definition function">saveSecretMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">guard</span> secret<span class="token punctuation">.</span>isHidden <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name">KeychainWrapper</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>secret<span class="token punctuation">.</span>text<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;SecretMessage&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    secret<span class="token punctuation">.</span><span class="token function">resignFirstResponder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    secret<span class="token punctuation">.</span>isHidden <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">    title <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Nothing to see here&quot;</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I slipped a new method in there: <code>resignFirstResponder()</code>. This is used to tell a view that has input focus that it should give up that focus. Or, in Plain English, to tell our text view that we&#39;re finished editing it, so the keyboard can be hidden. This is important because having a keyboard present might arouse suspicion ‚Äì as if our rather obvious navigation bar title hadn&#39;t done enough already‚Ä¶</p><p>Now, there are still two questions remaining: how should users trigger a save when they are ready, and how do we ensure that as soon as the user starts to leave the app we make their data safe? For the first problem, consider this: how often do you see a save button in iOS? Hardly ever, I expect!</p><p>It turns out that one answer solves both problems: if we automatically save when the user leaves the app then the user need never worry about saving because it&#39;s done for them, and our save method above automatically hides the text when it&#39;s called so the app becomes safe as soon as any action is taken to leave it.</p><p>We&#39;re already using <code>NotificationCenter</code> to watch for the keyboard appearing and disappearing, and we can watch for another notification that will tell us when the application will stop being active ‚Äì i.e., when our app has been backgrounded or the user has switched to multitasking mode. This notification is called <code>UIApplication.willResignActiveNotification</code>, and you should make us an observer for it in <code>viewDidLoad()</code> like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line">notificationCenter<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> selector<span class="token punctuation">:</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span>saveSecretMessage<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token class-name">UIApplication</span><span class="token punctuation">.</span>willResignActiveNotification<span class="token punctuation">,</span> object<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>That calls our <code>saveSecretMessage()</code> directly when the notification comes in, which means the app automatically saves any text and hides it when the app is moving to a background state.</p><p>The last thing to do before the app is actually useful is to make tapping the button call <code>unlockSecretMessage()</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@IBAction</span> <span class="token keyword">func</span> <span class="token function-definition function">authenticateTapped</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> sender<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">unlockSecretMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It&#39;s not actually secure at this point (other than saving its data in the iOS keychain!), but by saving and loading its text it is at least useful.</p>`,18),$=n("h3",{id:"touch-to-activate-touch-id-face-id-and-localauthentication",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#touch-to-activate-touch-id-face-id-and-localauthentication"},[n("span",null,"Touch to activate: Touch ID, Face ID and LocalAuthentication")])],-1),G={class:"hint-container details"},nn=n("summary",null,"Touch to activate: Touch ID, Face ID and LocalAuthentication",-1),sn=n("p",null,"4touch-to-activate-touch-id-face-id-and-localauthentication)",-1),en=n("p",null,"Touch ID and Face ID are part of the Local Authentication framework, and our code needs to do three things:",-1),an=n("li",null,"Check whether the device is capable of supporting biometric authentication ‚Äì that the hardware is available and is configured by the user.",-1),tn=n("code",null,"Info.plist",-1),on=n("li",null,"If we get success back from the authentication request it means this is the device's owner so we can unlock the app, otherwise we show a failure message.",-1),cn=t(`<p>One caveat that you must be careful of: when we&#39;re told whether Touch ID/Face ID was successful or not, it might not be on the main thread. This means we need to use <code>async()</code> to make sure we execute any user interface code on the main thread.</p><p>The job of task 1 is done by the <code>canEvaluatePolicy()</code> method of the <code>LAContext</code> class, requesting the security policy type <code>.deviceOwnerAuthenticationWithBiometrics</code>. The job of task 2 is done by the <code>evaluatePolicy()</code> of that same class, using the same policy type, but it accepts a trailing closure telling us the result of the policy evaluation: was it successful, and if not what was the reason?</p><p>Like I said, all this is provided by the Local Authentication framework, so the first thing we need to do is import that framework. Add this above <code>import UIKit</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token class-name">LocalAuthentication</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And now here&#39;s the new code for the <code>authenticateTapped()</code> method. We already walked through what it does, so this shouldn&#39;t be too surprising:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@IBAction</span> <span class="token keyword">func</span> <span class="token function-definition function">authenticateTapped</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> sender<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token class-name">LAContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">var</span> error<span class="token punctuation">:</span> <span class="token class-name">NSError</span><span class="token operator">?</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> context<span class="token punctuation">.</span><span class="token function">canEvaluatePolicy</span><span class="token punctuation">(</span><span class="token punctuation">.</span>deviceOwnerAuthenticationWithBiometrics<span class="token punctuation">,</span> error<span class="token punctuation">:</span> <span class="token operator">&amp;</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> reason <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Identify yourself!&quot;</span></span></span>
<span class="line"></span>
<span class="line">        context<span class="token punctuation">.</span><span class="token function">evaluatePolicy</span><span class="token punctuation">(</span><span class="token punctuation">.</span>deviceOwnerAuthenticationWithBiometrics<span class="token punctuation">,</span> localizedReason<span class="token punctuation">:</span> reason<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> success<span class="token punctuation">,</span> authenticationError <span class="token keyword">in</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> success <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">self</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unlockSecretMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">// error</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// no biometry</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There is one important new piece of syntax in there that we haven‚Äôt used before, which is <code>&amp;error</code>. The LocalAuthentication framework uses the Objective-C approach to reporting errors back to us, which is where the <code>NSError</code> type comes from ‚Äì where Swift likes to have an enum that conforms to the <code>Error</code> protocol, Objective-C had a dedicated <code>NSError</code> type for handling errors.</p><p>Here, though, we want LocalAuthentication to tell <em>us</em> what went wrong, and it can‚Äôt do that by returning a value from the <code>canEvaluatePolicy()</code> method ‚Äì that already returns a Boolean telling us whether biometric authentication is available or not. So, instead what we use is the Objective-C equivalent of Swift‚Äôs <code>inout</code> parameters: we pass an empty <code>NSError</code> variable into our call to <code>canEvaluatePolicy()</code>, and if an error occurs that error will get filled with a real <code>NSError</code> instance telling us what went wrong.</p><p>Objective-C‚Äôs equivalent to <code>inout</code> is what‚Äôs called a <em>pointer</em>, so named because it effectively points to a place in memory where something exists rather us passing around the actual value instead. If we had passed <code>error</code> into the method, it would mean ‚Äúhere‚Äôs the error you should use.‚Äù By passing in <code>&amp;error</code> ‚Äì Objective-C‚Äôs equivalent of <code>inout</code> ‚Äì it means ‚Äúif you hit an error, here‚Äôs the place in memory where you should store that error so I can read it.‚Äù</p><p>I hope you can now see this is another example of why Swift was such a leap forward compared to Objective-C ‚Äì having to pass around pointers to things wasn‚Äôt terribly pleasant!</p><p>Apart from that, there are a couple of reminders: we need <code>[weak self]</code> inside the first closure but not the second because it&#39;s already weak by that point. You also need to use <code>self?.</code> inside the closure to make capturing clear. Finally, you must provide a reason why you want Touch ID/Face ID to be used, so you might want to replace mine (&quot;Identify yourself!&quot;) with something a little more descriptive.</p>`,11),pn=n("code",null,"Info.plist",-1),ln=n("code",null,"Privacy - Face ID Usage Description",-1),rn=t(`<p>That&#39;s enough to get basic biometric authentication working, but there are error cases you need to catch. For example, you‚Äôll hit problems if the device does not have biometric capability or it isn‚Äôt configured. Similarly, you‚Äôll get an error if the user failed authentication, which might be because their fingerprint or face wasn&#39;t scanning for whatever reason, but also if the system has to cancel scanning for some reason.</p><p>To catch authentication failure errors, replace the <code>// error</code> comment with this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Authentication failed&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;You could not be verified; please try again.&quot;</span></span><span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>alert<span class="token punctuation">)</span></span>
<span class="line">ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;OK&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We also need to show an error if biometry just isn&#39;t available, so replace the <code>// no Touch ID</code> comment with this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Biometry unavailable&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Your device is not configured for biometric authentication.&quot;</span></span><span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>alert<span class="token punctuation">)</span></span>
<span class="line">ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;OK&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),un=n("code",null,"[Hardware]",-1),dn=n("code",null,"[Touch ID/Face ID]",-1),hn=n("code",null,"[Toggle Enrolled State]",-1),kn=n("code",null,"[Hardware]",-1),mn=n("code",null,"[Touch ID/Face ID]",-1),wn=n("code",null,"[Matching Touch/Face]",-1),fn=n("hr",null,null,-1);function yn(d,gn){const o=u("router-link"),i=u("VPCard"),r=u("VidStack"),a=u("FontIcon");return w(),k("div",null,[n("h1",y,[n("a",g,[n("span",null,m(d.$frontmatter.title)+" Í¥ÄÎ†®",1)])]),n("nav",v,[n("ul",null,[n("li",null,[e(o,{to:"#project-28-part-one"},{default:c(()=>[s("Project 28, part one")]),_:1}),n("ul",null,[n("li",null,[e(o,{to:"#setting-up"},{default:c(()=>[s("Setting up")]),_:1})]),n("li",null,[e(o,{to:"#the-basic-text-editor"},{default:c(()=>[s("The basic text editor")]),_:1})]),n("li",null,[e(o,{to:"#writing-somewhere-safe-the-ios-keychain"},{default:c(()=>[s("Writing somewhere safe: the iOS keychain")]),_:1})]),n("li",null,[e(o,{to:"#touch-to-activate-touch-id-face-id-and-localauthentication"},{default:c(()=>[s("Touch to activate: Touch ID, Face ID and LocalAuthentication")]),_:1})])])])])]),b,e(i,p(l({title:"100 Days of Swift - Day 92",desc:"Project 28, part one",link:"https://www.hackingwithswift.com/100/92",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),_,n("details",I,[x,e(i,p(l({title:"100 Days of Swift - Day 92 - Setting up",desc:"Setting up",link:"https://hackingwithswift.com/read/28/1/setting-up",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),e(r,{src:"youtube/E5F5vaoeYU0"}),T,S,D,j,A]),q,n("details",F,[W,e(i,p(l({title:"100 Days of Swift - Day 92 - The basic text editor",desc:"The basic text editor",link:"https://hackingwithswift.com/read/28/2/the-basic-text-editor",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),e(r,{src:"youtube/0lEWz4fBzoA"}),n("p",null,[s("Open "),e(a,{icon:"fas fa-file-lines"}),O,s(" in Interface Builder, and embed the default view controller inside a navigation controller. Now place a text view inside ("),N,s(" a text field!) so that it fills up most of the space: it should touch the left and right edges of our view, go up to the bottom of the navigation bar, then go down to the bottom of the safe area ‚Äì that‚Äôs where IB will snap to when you drag near the virtual home indicator at the bottom of the view controller. We don‚Äôt need anything special for our Auto Layout constraints, so just go to Editor > Resolve Auto Layout Issues > Add Missing Constraints to place them automatically.")]),n("p",null,[s('Delete the "Lorem ipsum" text in the text view, then use the assistant editor to make an outlet for it called '),E,s(". That's us done with the storyboard for now; switch back to the standard editor and open "),e(a,{icon:"fa-brands fa-swift"}),U,s(".")]),C,n("p",null,[s("None of that is new, so you're probably bored by now. Not to worry: we're going to fix up our storyboard in preparation for authentication, so re-open "),e(a,{icon:"fas fa-file-lines"}),K,s(".")]),B,M,P,L]),R,n("details",V,[H,e(i,p(l({title:"100 Days of Swift - Day 92 - Writing somewhere safe (the iOS keychain) ",desc:"Writing somewhere safe (the iOS keychain)",link:"https://hackingwithswift.com/read/28/3/writing-somewhere-safe-the-ios-keychain",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),e(r,{src:"youtube/h9RVeeUVhf8"}),z,n("p",null,[s("If you haven't already downloaded this project's files from "),n("a",Y,[e(a,{icon:"iconfont icon-github"}),Z]),s(", please do so now. In there you'll find the files "),e(a,{icon:"fa-brands fa-swift"}),X,s(" and "),e(a,{icon:"fa-brands fa-swift"}),J,s("; please copy them into your Xcode project to make the class available.")]),Q]),$,n("details",G,[nn,e(i,p(l({title:"100 Days of Swift - Day 92 - Touch to activate (Touch ID, Face ID and LocalAuthentication)",desc:"Touch to activate (Touch ID, Face ID and LocalAuthentication)",link:"https://www.hackingwithswift.com/read/28/5/wrap-up",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),sn,e(r,{src:"youtube/RMst1BtMTcE"}),en,n("ol",null,[an,n("li",null,[s("If so, request that the biometry system begin a check now, giving it a string containing the reason why we're asking. For Touch ID the string is written in code; for Face ID the string is written into our "),e(a,{icon:"fas fa-file-lines"}),tn,s(" file.")]),on]),cn,n("p",null,[s("You can see the ‚ÄúIdentify yourself!‚Äù string in our code, which will be shown to Touch ID users. Face ID is handled slightly differently ‚Äì open "),e(a,{icon:"fas fa-file-lines"}),pn,s(", then add a new key called "),ln,s(". This should contain similar text to what you use with Touch ID, so give it the value ‚ÄúIdentify yourself!‚Äù.")]),rn,n("p",null,[s("That completes the authentication code, so go ahead and try running the app now. If you‚Äôre using a physical device your regular Touch ID / Face ID should work just fine, but if you‚Äôre using the Simulator there are useful options under the Hardware menu ‚Äì go to "),e(a,{icon:"iconfont icon-select"}),un,s(" > "),dn,s(" > "),hn,s(" to opt in to biometric authentication, then use "),e(a,{icon:"iconfont icon-select"}),kn,s(" > "),mn,s(" > "),wn,s(" when you‚Äôre asked for a fingerprint/face.")])]),fn])}const _n=h(f,[["render",yn],["__file","92.html.vue"]]),In=JSON.parse('{"path":"/swift/100-days-of-swift/92.html","title":"Day 92","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Day 92","description":"100 Days of Swift > Day 92","category":["Swift"],"tag":["crashcourse","paul-hudson","swift","hacking-with-swift","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"100 Days of Swift > Day 92"},{"property":"og:description","content":"Day 92"},{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/swift/100-days-of-swift/92.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/crashcourse/swift/100-days-of-swift/92.html"}],["meta",{"property":"og:site_name","content":"ü•ÅCrashcourse"}],["meta",{"property":"og:title","content":"Day 92"}],["meta",{"property":"og:description","content":"100 Days of Swift > Day 92"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2024-10-03T01:20:13.000Z"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"paul-hudson"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"hacking-with-swift"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:modified_time","content":"2024-10-03T01:20:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Day 92\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-03T01:20:13.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Project 28, part one","slug":"project-28-part-one","link":"#project-28-part-one","children":[{"level":3,"title":"Setting up","slug":"setting-up","link":"#setting-up","children":[]},{"level":3,"title":"The basic text editor","slug":"the-basic-text-editor","link":"#the-basic-text-editor","children":[]},{"level":3,"title":"Writing somewhere safe: the iOS keychain","slug":"writing-somewhere-safe-the-ios-keychain","link":"#writing-somewhere-safe-the-ios-keychain","children":[]},{"level":3,"title":"Touch to activate: Touch ID, Face ID and LocalAuthentication","slug":"touch-to-activate-touch-id-face-id-and-localauthentication","link":"#touch-to-activate-touch-id-face-id-and-localauthentication","children":[]}]}],"git":{"createdTime":1707820500000,"updatedTime":1727918413000,"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":12}]},"readingTime":{"minutes":10.83,"words":3248},"filePathRelative":"swift/100-days-of-swift/92.md","localizedDate":"2024ÎÖÑ 2Ïõî 13Ïùº","excerpt":"\\n\\n<hr>\\n"}');export{_n as comp,In as data};

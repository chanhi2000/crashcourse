import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,a as n,t as h,b as s,w as e,n as o,g as p,e as l,r as i,o as m,d as c}from"./app-U_bew1in.js";const g={},f={id:"frontmatter-title-관련",tabindex:"-1"},w={class:"header-anchor",href:"#frontmatter-title-관련"},y={class:"table-of-contents"},v=n("hr",null,null,-1),b=l('<h2 id="project-13-part-two" tabindex="-1"><a class="header-anchor" href="#project-13-part-two"><span>Project 13, part two</span></a></h2><p>Pictures bring any user interface to life, but as app designers it’s our job to frame those pictures with a smart user interface to really bring them to life. As Ben Shneiderman, a professor for Computer Science at the University of Maryland, once said, “a picture is worth a thousand words; an interface is worth a thousand pictures” – for me that really underscores the importance of getting both right!</p><p>Today you’re going to be trying Core Image for the first time. Its API has never really been updated for Swift, so you’ll see a few quirks here and there. It also has precious little margin for error, so you’ll see we add various checks to make sure our code is safe at runtime – it’s better to be safe than sorry.</p><p>I said it before, but it bears repeating here: Core Image is extraordinarily fast on real iOS devices, but extraordinarily slow in Xcode’s simulator. So, don’t worry if you find the blur effect appears to lock up your Mac while it works – it will happen in the blink of an eye on a real device.</p><p><strong>Today you have three topics to work through, and you’ll learn about <code>CIContext</code>, <code>CIFilter</code>, and more.</strong></p><h3 id="applying-filters-cicontext-cifilter" tabindex="-1"><a class="header-anchor" href="#applying-filters-cicontext-cifilter"><span>Applying filters: <code>CIContext</code>, <code>CIFilter</code></span></a></h3>',6),I={class:"hint-container details"},C=n("summary",null,"Applying filters: CIContext, CIFilter",-1),x=l(`<p>You&#39;re probably getting tired of hearing me saying this, but Core Image is yet another super-fast and super-powerful framework from Apple. It does only one thing, which is to apply filters to images that manipulate them in various ways.</p><p>One downside to Core Image is it&#39;s not very <em>guessable</em>, so you need to know what you&#39;re doing otherwise you&#39;ll waste a lot of time. It&#39;s also not able to rely on large parts of Swift&#39;s type safety, so you need to be careful when using it because the compiler won&#39;t help you as much as you&#39;re used to.</p><p>To get started, import CoreImage by adding this line near the top of ViewController.swift:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token class-name">CoreImage</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>We need to add two more properties to our class, so put these underneath the <code>currentImage</code> property:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">var</span> context<span class="token punctuation">:</span> <span class="token class-name">CIContext</span><span class="token operator">!</span></span>
<span class="line"><span class="token keyword">var</span> currentFilter<span class="token punctuation">:</span> <span class="token class-name">CIFilter</span><span class="token operator">!</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The first is a Core Image context, which is the Core Image component that handles rendering. We create it here and use it throughout our app, because creating a context is computationally expensive so we don&#39;t want to keep doing it.</p><p>The second is a Core Image filter, and will store whatever filter the user has activated. This filter will be given various input settings before we ask it to output a result for us to show in the image view.</p><p>We want to create both of these in <code>viewDidLoad()</code>, so put this just before the end of the method:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line">context <span class="token operator">=</span> <span class="token class-name">CIContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">currentFilter <span class="token operator">=</span> <span class="token class-name">CIFilter</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CISepiaTone&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>That creates a default Core Image context, then creates an example filter that will apply a sepia tone effect to images. It&#39;s just for now; we&#39;ll let users change it soon enough.</p><p>To begin with, we&#39;re going to let users drag the slider up and down to add varying amounts of sepia effect to the image they select.</p><p>To do that, we need to set our <code>currentImage</code> property as the input image for the <code>currentFilter</code> Core Image filter. We&#39;re then going to call a method (as yet unwritten) called <code>applyProcessing()</code>, which will do the actual Core Image manipulation.</p><p>So, add this to the end of the <code>didFinishPickingMediaWithInfo</code> method:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">let</span> beginImage <span class="token operator">=</span> <span class="token class-name">CIImage</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> currentImage<span class="token punctuation">)</span></span>
<span class="line">currentFilter<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>beginImage<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">kCIInputImageKey</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token function">applyProcessing</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You’ll get an error for <code>applyProcessing()</code> because we haven’t written it yet, but we’ll get there soon.</p><p>The <code>CIImage</code> data type is, for the sake of this project, just the Core Image equivalent of <code>UIImage</code>. Behind the scenes it&#39;s a bit more complicated than that, but really it doesn&#39;t matter.</p><p>As you can see, we can create a <code>CIImage</code> from a <code>UIImage</code>, and we send the result into the current Core Image Filter using the <code>kCIInputImageKey</code>. There are lots of Core Image key constants like this; at least this one is somewhat self-explanatory!</p><p>We also need to call the (still unwritten!) <code>applyProcessing()</code> method when the slider is dragged around, so modify the <code>intensityChanged()</code> method to this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@IBAction</span> <span class="token keyword">func</span> <span class="token function-definition function">intensityChanged</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> sender<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">applyProcessing</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>With these changes, <code>applyProcessing()</code> is called as soon as the image is first imported, then whenever the slider is moved. Now it&#39;s time to write the initial version of the <code>applyProcessing()</code> method, so put this just before the end of your class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">applyProcessing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> image <span class="token operator">=</span> currentFilter<span class="token punctuation">.</span>outputImage <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line">    currentFilter<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>intensity<span class="token punctuation">.</span>value<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">kCIInputIntensityKey</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> cgimg <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createCGImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> from<span class="token punctuation">:</span> image<span class="token punctuation">.</span>extent<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> processedImage <span class="token operator">=</span> <span class="token class-name">UIImage</span><span class="token punctuation">(</span>cgImage<span class="token punctuation">:</span> cgimg<span class="token punctuation">)</span></span>
<span class="line">        imageView<span class="token punctuation">.</span>image <span class="token operator">=</span> processedImage</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That&#39;s only five lines, none of which are terribly taxing.</p><p>The first line safely reads the output image from our current filter. This should always exist, but there’s no harm being safe.</p><p>The second line uses the value of our <code>intensity</code> slider to set the <code>kCIInputIntensityKey</code> value of our current Core Image filter. For sepia toning a value of 0 means &quot;no effect&quot; and 1 means &quot;fully sepia.&quot;</p><p>The third line is where the hard work happens: it creates a new data type called <code>CGImage</code> from the output image of the current filter. We need to specify which part of the image we want to render, but using <code>image.extent</code> means &quot;all of it.&quot; Until this method is called, no actual processing is done, so this is the one that does the real work. This returns an optional <code>CGImage</code> so we need to check and unwrap with <code>if let</code>.</p><p>The fourth line creates a new <code>UIImage</code> from the <code>CGImage</code>, and line five assigns that <code>UIImage</code> to our image view. Yes, I know that <code>UIImage</code>, <code>CGImage</code> and <code>CIImage</code> all sound the same, but they are different under the hood and we have no choice but to use them here.</p><p>You can now press <kbd>Cmd</kbd>+<kbd>R</kbd> to run the project as-is, then import a picture and make it sepia toned. It might be a little slow in the simulator, but I can promise you it runs brilliantly on devices - Core Image is extraordinarily fast.</p><p>Adding a sepia effect isn&#39;t very interesting, and I want to help you explore some of the other options presented by Core Image. So, we&#39;re going to make the &quot;Change Filter&quot; button work: it will show a <code>UIAlertController</code> with a selection of filters, and when the user selects one it will update the image.</p><p>First, here&#39;s the new <code>changeFilter()</code> method:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@IBAction</span> <span class="token keyword">func</span> <span class="token function-definition function">changeFilter</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> sender<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Choose filter&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>actionSheet<span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CIBumpDistortion&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> handler<span class="token punctuation">:</span> setFilter<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CIGaussianBlur&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> handler<span class="token punctuation">:</span> setFilter<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CIPixellate&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> handler<span class="token punctuation">:</span> setFilter<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CISepiaTone&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> handler<span class="token punctuation">:</span> setFilter<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CITwirlDistortion&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> handler<span class="token punctuation">:</span> setFilter<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CIUnsharpMask&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> handler<span class="token punctuation">:</span> setFilter<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CIVignette&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> handler<span class="token punctuation">:</span> setFilter<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Cancel&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span>cancel<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That&#39;s seven different Core Image filters plus one cancel button, but no new code. When tapped, each of the filter buttons will call the <code>setFilter()</code> method, which we need to make. This method should update our <code>currentFilter</code> property with the filter that was chosen, set the <code>kCIInputImageKey</code> key again (because we just changed the filter), then call <code>applyProcessing()</code>.</p><p>Each <code>UIAlertAction</code> has its title set to a different Core Image filter, and because our <code>setFilter()</code> method must accept as its only parameter the action that was tapped, we can use the action&#39;s title to create our new Core Image filter. Here&#39;s the <code>setFilter()</code> method:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">setFilter</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token class-name">UIAlertAction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  </span>
<span class="line">    <span class="token comment">// make sure we have a valid image before continuing!</span></span>
<span class="line">    <span class="token keyword">guard</span> currentImage <span class="token operator">!=</span> <span class="token nil constant">nil</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// safely read the alert action&#39;s title</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> actionTitle <span class="token operator">=</span> action<span class="token punctuation">.</span>title <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    currentFilter <span class="token operator">=</span> <span class="token class-name">CIFilter</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> actionTitle<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> beginImage <span class="token operator">=</span> <span class="token class-name">CIImage</span><span class="token punctuation">(</span>image<span class="token punctuation">:</span> currentImage<span class="token punctuation">)</span></span>
<span class="line">    currentFilter<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>beginImage<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">kCIInputImageKey</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">applyProcessing</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>But don&#39;t run the project yet! Our current code has a problem, and it&#39;s this line:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line">currentFilter<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>intensity<span class="token punctuation">.</span>value<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">kCIInputIntensityKey</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>That sets the intensity of the current filter. But the problem is that not all filters have an intensity setting. If you try this using the <code>CIBumpDistortion</code> filter, the app will crash because it doesn&#39;t know what to do with a setting for the key <code>kCIInputIntensityKey</code>.</p><p>All the filters and the keys they use are described fully in Apple&#39;s documentation, but for this project we&#39;re going to take a shortcut. There are four input keys we&#39;re going to manipulate across seven different filters. Sometimes the keys mean different things, and sometimes the keys don&#39;t exist, so we&#39;re going to apply only the keys that do exist with some cunning code.</p><p>Each filter has an <code>inputKeys</code> property that returns an array of all the keys it can support. We&#39;re going to use this array in conjunction with the <code>contains()</code> method to see if each of our input keys exist, and, if it does, use it. Not all of them expect a value between 0 and 1, so I sometimes multiply the slider&#39;s value to make the effect more pronounced.</p><p>Change your <code>applyProcessing()</code> method to be this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">applyProcessing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> inputKeys <span class="token operator">=</span> currentFilter<span class="token punctuation">.</span>inputKeys</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> inputKeys<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token constant">kCIInputIntensityKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> currentFilter<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>intensity<span class="token punctuation">.</span>value<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">kCIInputIntensityKey</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> inputKeys<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token constant">kCIInputRadiusKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> currentFilter<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>intensity<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">200</span><span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">kCIInputRadiusKey</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> inputKeys<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token constant">kCIInputScaleKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> currentFilter<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>intensity<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">kCIInputScaleKey</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> inputKeys<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token constant">kCIInputCenterKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> currentFilter<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">CIVector</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> currentImage<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> currentImage<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token constant">kCIInputCenterKey</span><span class="token punctuation">)</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> cgimg <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createCGImage</span><span class="token punctuation">(</span>currentFilter<span class="token punctuation">.</span>outputImage<span class="token operator">!</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> currentFilter<span class="token punctuation">.</span>outputImage<span class="token operator">!</span><span class="token punctuation">.</span>extent<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> processedImage <span class="token operator">=</span> <span class="token class-name">UIImage</span><span class="token punctuation">(</span>cgImage<span class="token punctuation">:</span> cgimg<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">self</span><span class="token punctuation">.</span>imageView<span class="token punctuation">.</span>image <span class="token operator">=</span> processedImage</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Using this method, we check each of our four keys to see whether the current filter supports it, and, if so, we set the value. The first three all use the value from our <code>intensity</code> slider in some way, which will produce some interesting results. If you wanted to improve this app later, you could perhaps add three sliders.</p><p>If you run your app now, you should be able to choose from various filters then watch them distort your image in weird and wonderful ways. Note that some of them – such as the Gaussian blur – will run very slowly in the simulator, but quickly on devices. If we wanted to do more complex processing (not least chaining filters together!) you can add configuration options to the <code>CIContext</code> to make it run even faster; another time, perhaps.</p>`,43),A=n("h3",{id:"saving-to-the-ios-photo-library",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#saving-to-the-ios-photo-library"},[n("span",null,"Saving to the iOS photo library")])],-1),_={class:"hint-container details"},F=n("summary",null,"Saving to the iOS photo library",-1),S=l(`<p>I know it&#39;s fun to play around with Core Image filters (and you&#39;ve only seen some of them!), but we have a project to finish so I want to introduce you to a new function: <code>UIImageWriteToSavedPhotosAlbum()</code>. This method does exactly what its name says: give it a <code>UIImage</code> and it will write the image to the photo album.</p><p>This method takes four parameters: the image to write, who to tell when writing has finished, what method to call, and any context. The context is just like the context value you can use with KVO, as seen in project 4, and again we&#39;re not going to use it here. The first two parameters are quite simple: we know what image we want to save (the processed one in the image view), and we also know that we want <code>self</code> (the current view controller) to be notified when writing has finished.</p><p>The third parameter can be provided in two ways: vague and clean, or specific and ugly. It needs to be a selector that lists the method in our view controller that will be called, and it&#39;s specified using <code>#selector</code>. The method it will call will look like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">image</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> image<span class="token punctuation">:</span> <span class="token class-name">UIImage</span><span class="token punctuation">,</span> didFinishSavingWithError error<span class="token punctuation">:</span> <span class="token class-name">Error</span><span class="token operator">?</span><span class="token punctuation">,</span> contextInfo<span class="token punctuation">:</span> <span class="token class-name">UnsafeRawPointer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Previously we&#39;ve had very simple selectors, like <code>#selector(shareTapped)</code>. And we can use that approach here – Swift allows us to be really vague about the selector we intend to call, and this works just fine:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token other-directive property">#selector</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Yes, that approach is nice and easy to read, but it&#39;s also very vague: it doesn&#39;t say what is actually going to happen. The alternative is to be very specific about the method we want called, so you can write this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token other-directive property">#selector</span><span class="token punctuation">(</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token omit keyword">_</span><span class="token punctuation">:</span>didFinishSavingWithError<span class="token punctuation">:</span>contextInfo<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This second option is longer, but provides much more information both to Xcode and to other people reading your code, so it&#39;s generally preferred. To be honest, this particular callback is a bit of a wart in iOS, but the fact that it stands out so much is testament to the fact that there are so few warts around!</p><p>Putting it all together, here&#39;s the finished <code>save()</code> method:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@IBAction</span> <span class="token keyword">func</span> <span class="token function-definition function">save</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> sender<span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">guard</span> <span class="token keyword">let</span> image <span class="token operator">=</span> imageView<span class="token punctuation">.</span>image <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name">UIImageWriteToSavedPhotosAlbum</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token other-directive property">#selector</span><span class="token punctuation">(</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token omit keyword">_</span><span class="token punctuation">:</span>didFinishSavingWithError<span class="token punctuation">:</span>contextInfo<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>From here on it&#39;s easy, because we just need to write the <code>didFinishSavingWithError</code> method. This must show one of two messages depending on whether we get an error sent to us. The error might be, for example, that the user denied us permission to write to the photo album. This will be sent as an <code>Error?</code> object, so if it&#39;s <code>nil</code> we know there was no error.</p><p>This parameter is important because if an error has occurred (<em>i.e.</em>, the error parameter is not nil) then we need to unwrap the <code>Error</code> object and use its <code>localizedDescription</code> property – this will tell users what the error message was in their own language.</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@objc</span> <span class="token keyword">func</span> <span class="token function-definition function">image</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> image<span class="token punctuation">:</span> <span class="token class-name">UIImage</span><span class="token punctuation">,</span> didFinishSavingWithError error<span class="token punctuation">:</span> <span class="token class-name">Error</span><span class="token operator">?</span><span class="token punctuation">,</span> contextInfo<span class="token punctuation">:</span> <span class="token class-name">UnsafeRawPointer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> error <span class="token operator">=</span> error <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// we got back an error!</span></span>
<span class="line">        <span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Save error&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> error<span class="token punctuation">.</span>localizedDescription<span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>alert<span class="token punctuation">)</span></span>
<span class="line">        ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;OK&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> ac <span class="token operator">=</span> <span class="token class-name">UIAlertController</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Saved!&quot;</span></span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Your altered image has been saved to your photos.&quot;</span></span><span class="token punctuation">,</span> preferredStyle<span class="token punctuation">:</span> <span class="token punctuation">.</span>alert<span class="token punctuation">)</span></span>
<span class="line">        ac<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">UIAlertAction</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;OK&quot;</span></span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">present</span><span class="token punctuation">(</span>ac<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And that&#39;s it: your app now imports pictures, manipulates them with a Core Image filter and a <code>UISlider</code>, then saves the result back to the photo library. Easy!</p>`,15),T=n("hr",null,null,-1);function j(u,q){const a=i("router-link"),t=i("VPCard"),r=i("VidStack");return m(),k("div",null,[n("h1",f,[n("a",w,[n("span",null,h(u.$frontmatter.title)+" 관련",1)])]),n("nav",y,[n("ul",null,[n("li",null,[s(a,{to:"#project-13-part-two"},{default:e(()=>[c("Project 13, part two")]),_:1}),n("ul",null,[n("li",null,[s(a,{to:"#applying-filters-cicontext-cifilter"},{default:e(()=>[c("Applying filters: CIContext, CIFilter")]),_:1})]),n("li",null,[s(a,{to:"#saving-to-the-ios-photo-library"},{default:e(()=>[c("Saving to the iOS photo library")]),_:1})])])])])]),v,s(t,o(p({title:"100 Days of Swift - Day 53",desc:"Project 13, part two",link:"https://www.hackingwithswift.com/100/53",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),b,n("details",I,[C,s(t,o(p({title:"100 Days of Swift - Day 53 - Applying filters: CIContext, CIFilter",desc:"Applying filters: CIContext, CIFilter",link:"https://hackingwithswift.com/read/13/4/applying-filters-cicontext-cifilter",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),s(r,{src:"youtube/9Qm6M7qlOOQ"}),x]),A,n("details",_,[F,s(t,o(p({title:"100 Days of Swift - Day 53 - Saving to the iOS photo library",desc:"Saving to the iOS photo library",link:"https://hackingwithswift.com/read/13/5/saving-to-the-ios-photo-library",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(213,52,58,0.2)"})),null,16),s(r,{src:"youtube/F0clMFqiOys"}),S]),T])}const P=d(g,[["render",j],["__file","53.html.vue"]]),D=JSON.parse('{"path":"/swift/100-days-of-swift/53.html","title":"Day 53","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Day 53","description":"100 Days of Swift > Day 53","category":["Swift"],"tag":["crashcourse","paul-hudson","swift","hacking-with-swift","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"100 Days of Swift > Day 53"},{"property":"og:description","content":"Day 53"},{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/swift/100-days-of-swift/53.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/crashcourse/swift/100-days-of-swift/53.html"}],["meta",{"property":"og:site_name","content":"🥁Crashcourse"}],["meta",{"property":"og:title","content":"Day 53"}],["meta",{"property":"og:description","content":"100 Days of Swift > Day 53"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2024-10-03T01:20:13.000Z"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"paul-hudson"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"hacking-with-swift"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:modified_time","content":"2024-10-03T01:20:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Day 53\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-03T01:20:13.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Project 13, part two","slug":"project-13-part-two","link":"#project-13-part-two","children":[{"level":3,"title":"Applying filters: CIContext, CIFilter","slug":"applying-filters-cicontext-cifilter","link":"#applying-filters-cicontext-cifilter","children":[]},{"level":3,"title":"Saving to the iOS photo library","slug":"saving-to-the-ios-photo-library","link":"#saving-to-the-ios-photo-library","children":[]}]}],"git":{"createdTime":1703642364000,"updatedTime":1727918413000,"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":10}]},"readingTime":{"minutes":8.48,"words":2545},"filePathRelative":"swift/100-days-of-swift/53.md","localizedDate":"2023년 12월 27일","excerpt":"\\n\\n<hr>\\n"}');export{P as comp,D as data};

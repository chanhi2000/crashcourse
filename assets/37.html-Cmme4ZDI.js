import{_ as h}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as m,a as s,t as k,b as e,w as o,n as p,g as l,d as n,e as a,r as u,o as w}from"./app-U_bew1in.js";const v={},b={id:"frontmatter-title-관련",tabindex:"-1"},g={class:"header-anchor",href:"#frontmatter-title-관련"},f={class:"table-of-contents"},y=s("hr",null,null,-1),x=a('<h2 id="project-7-part-2" tabindex="-1"><a class="header-anchor" href="#project-7-part-2"><span>Project 7, part 2</span></a></h2><p>Today you’re going to build a complete app using <code>@ObservedObject</code>, <code>@Published</code>, <code>sheet()</code>, <code>Codable</code>, <code>UserDefaults</code>, and more. I realize that seems like a lot, but I want you to try to think about all the things that are happening in the background:</p><ul><li><code>@Published</code> publishes change announcements automatically.</li><li><code>@StateObject</code> watches for those announcements and refreshes any views using the object.</li><li><code>sheet()</code> watches a condition we specify and shows or hides a view automatically.</li><li><code>Codable</code> can convert Swift objects into JSON and back with almost no code from us.</li><li><code>UserDefaults</code> can read and write data so that we can save settings and more instantly.</li></ul><p>Yes, we need to write the code to put those things in place, but so much boilerplate code has been removed that what remains is quite remarkable. As French writer and poet Antoine de Saint-Exupery once said, “perfection is achieved not when there is nothing more to add, but rather when there is nothing more to take away.”</p><p><strong>Today you have five topics to work through, in which you’ll put into practice everything you learned about <code>@StateObject</code>, <code>sheet()</code>, <code>onDelete()</code>, and more.</strong></p><h3 id="building-a-list-we-can-delete-from" tabindex="-1"><a class="header-anchor" href="#building-a-list-we-can-delete-from"><span>Building a list we can delete from</span></a></h3>',6),I={class:"hint-container details"},S=s("summary",null,"Building a list we can delete from",-1),_=a("<p>In this project we want a list that can show some expenses, and previously we would have done this using an <code>@State</code> array of objects. Here, though, we’re going to take a different approach: we’re going to create an <code>Expenses</code> class that will be attached to our list using <code>@StateObject</code>.</p><p>This might sound like we’re over-complicating things a little, but it actually makes things much easier because we can make the <code>Expenses</code> class load and save itself seamlessly – it will be almost invisible, as you’ll see.</p><p>First, we need to decide what an expense <em>is</em> – what do we want it to store? In this instance it will be three things: the name of the item, whether it’s business or personal, and its cost as a <code>Double</code>.</p>",3),j=s("code",null,"ExpenseItem",-1),E=s("code",null,"ExpenseItem.swift",-1),T=s("code",null,"ContentView.swift",-1),U=s("em",null,"inside",-1),q=s("code",null,"ContentView",-1),D=a(`<p>Regardless of where you put it, this is the code to use:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">struct</span> <span class="token class-name">ExpenseItem</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> type<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> amount<span class="token punctuation">:</span> <span class="token class-name">Double</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now that we have something that represents a single expense, the next step is to create something to store an array of those expense items inside a single object. This needs to conform to the <code>ObservableObject</code> protocol, and we’re also going to use <code>@Published</code> to make sure change announcements get sent whenever the <code>items</code> array gets modified.</p><p>As with the <code>ExpenseItem</code> struct, this will start off simple and we’ll add to it later, so add this new class now:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">Expenses</span><span class="token punctuation">:</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">ExpenseItem</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That finishes all the data required for our main view: we have a struct to represent a single item of expense, and a class to store an array of all those items.</p><p>Let’s now put that into <em>action</em> with our SwiftUI view, so we can actually see our data on the screen. Most of our view will just be a <code>List</code> showing the items in our expenses, but because we want users to delete items they no longer want we can’t just use a simple <code>List</code> – we need to use a <code>ForEach</code> <em>inside</em> the list, so we get access to the <code>onDelete()</code> modifier.</p><p>First, we need to add an <code>@StateObject</code> property in our view, that will create an instance of our <code>Expenses</code> class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@StateObject</span> <span class="token keyword">var</span> expenses <span class="token operator">=</span> <span class="token class-name">Expenses</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Remember, using <code>@StateObject</code> here asks SwiftUI to watch the object for any change announcements, so any time one of our <code>@Published</code> properties changes the view will refresh its body. It’s only used when <em>creating</em> a class instance – all other times you ‘ll use <code>@ObservedObject</code> instead.</p><p>Second, we can use that <code>Expenses</code> object with a <code>NavigationView</code>, a <code>List</code>, and a <code>ForEach</code>, to create our basic layout:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">NavigationView</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">List</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ForEach</span><span class="token punctuation">(</span>expenses<span class="token punctuation">.</span>items<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\\</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span> item <span class="token keyword">in</span></span>
<span class="line">            <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;iExpense&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That tells the <code>ForEach</code> to identify each expense item uniquely by its name, then prints the name out as the list row.</p><p>We’re going to add two more things to our simple layout before we’re done: the ability to add new items for testing purposes, and the ability to delete items with a swipe.</p><p>We’re going to let users add their own items soon, but it’s important to check that our list actually works well before we continue. So, we’re going to add a toolbar button that adds example <code>ExpenseItem</code> instances for us to work with – add this modifier to the <code>List</code> now:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token punctuation">.</span>toolbar <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Button</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> expense <span class="token operator">=</span> <span class="token class-name">ExpenseItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Test&quot;</span></span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Personal&quot;</span></span><span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">        expenses<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>expense<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> label<span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;plus&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That brings our app to life: you can launch it now, then press the + button repeatedly to add lots of testing expenses.</p><p>Now that we can <em>add</em> expenses, we can also add code to remove them. This means adding a method capable of deleting an <code>IndexSet</code> of list items, then passing that directly on to our <code>expenses</code> array:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">removeItems</span><span class="token punctuation">(</span>at offsets<span class="token punctuation">:</span> <span class="token class-name">IndexSet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    expenses<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>atOffsets<span class="token punctuation">:</span> offsets<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And to attach that to SwiftUI, we add an <code>onDelete()</code> modifier to our <code>ForEach</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">ForEach</span><span class="token punctuation">(</span>expenses<span class="token punctuation">.</span>items<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\\</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span> item <span class="token keyword">in</span></span>
<span class="line">    <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token function">onDelete</span><span class="token punctuation">(</span>perform<span class="token punctuation">:</span> removeItems<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Go ahead and run the app now, press + a few times, then swipe to delete the rows.</p><p>Now, remember: when we say <code>id: \\.name</code> we’re saying we can identify each item uniquely by its name, which isn’t true here – we have the same name multiple times, and we can’t guarantee our expenses will be unique either.</p><p>Often this will Just Work, but sometimes it will cause bizarre, broken animations in your project, so let’s look at a better solution next.</p>`,24),A=s("h3",{id:"working-with-identifiable-items-in-swiftui",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#working-with-identifiable-items-in-swiftui"},[s("span",null,"Working with Identifiable items in SwiftUI")])],-1),V={class:"hint-container details"},F=s("summary",null,"Working with Identifiable items in SwiftUI",-1),N=a(`<p>When we create static views in SwiftUI – when we hard-code a <code>VStack</code>, then a <code>TextField</code>, then a <code>Button</code>, and so on – SwiftUI can see exactly which views we have, and is able to control them, animate them, and more. But when we use <code>List</code> or <code>ForEach</code> to make dynamic views, SwiftUI needs to know how it can identify each item uniquely otherwise it will struggle to compare view hierarchies to figure out what has changed.</p><p>In our current code, we have this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">ForEach</span><span class="token punctuation">(</span>expenses<span class="token punctuation">.</span>items<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\\</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span> item <span class="token keyword">in</span></span>
<span class="line">    <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token function">onDelete</span><span class="token punctuation">(</span>perform<span class="token punctuation">:</span> removeItems<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In English, that means “create a new row for every item in the expense items, identified uniquely by its name, showing that name in the row, and calling the <code>removeItems()</code> method to delete it.”</p><p>Then, later, we have this code:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">Button</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> expense <span class="token operator">=</span> <span class="token class-name">ExpenseItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Test&quot;</span></span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Personal&quot;</span></span><span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">    expenses<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>expense<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> label<span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;plus&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Every time that button is pressed, it adds a test expense to our list, so we can make sure adding and deleting works.</p><p>Can you see the problem?</p><p>Every time we create an example expense item we’re using the name “Test”, but we’ve also told SwiftUI that it can use the expense name as a unique identifier. So, when our code runs and we delete an item, SwiftUI looks at the array beforehand – “Test”, “Test”, “Test”, “Test” – then looks at the array <em>afterwards</em> – “Test”, “Test”, “Test” – and can’t easily tell what changed. <em>Something</em> has changed, because one item has disappeared, but SwiftUI can’t be sure which.</p><p>In this situation we’re lucky, because <code>List</code> knows exactly which row we were swiping on, but in many other places that extra information won’t be available and our app will start to behave strangely.</p><p>This is a logic error on our behalf: our code is fine, and it doesn’t crash at runtime, but we’ve applied the wrong logic to get to that end result – we’ve told SwiftUI that something will be a unique identifier, when it isn’t unique at all.</p><p>To fix this we need to think more about our <code>ExpenseItem</code> struct. Right now it has three properties: <code>name</code>, <code>type</code>, and <code>amount</code>. The name by itself <em>might</em> be unique in practice, but it’s also likely not to be – as soon as the user enters “Lunch” twice we’ll start hitting problems. We could perhaps try to combine the name, type and amount into a new computed property, but even then we’re just delaying the inevitable; it’s still not really unique.</p><p>The smart solution here is to add something to <code>ExpenseItem</code> that <em>is</em> unique, such as an ID number that we assign by hand. That would work, but it does mean tracking the last number we assigned so we don’t use duplicates there either.</p><p>There is in fact an easier solution, and it’s called <code>UUID</code> – short for “universally unique identifier”, and if <em>that</em> doesn’t sound unique I’m not sure what does.</p><p>UUIDs are long hexadecimal strings such as this one: 08B15DB4-2F02-4AB8-A965-67A9C90D8A44. So, that’s eight digits, four digits, four digits, four digits, then twelve digits, of which the only requirement is that there’s a 4 in the first number of the third block. If we subtract the fixed 4, we end up with 31 digits, each of which can be one of 16 values – if we generated 1 UUID every second for a billion years, we might begin to have the slightest chance of generating a duplicate.</p><p>Now, we could update <code>ExpenseItem</code> to have a <code>UUID</code> property like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">struct</span> <span class="token class-name">ExpenseItem</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token constant">UUID</span></span>
<span class="line">    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> type<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> amount<span class="token punctuation">:</span> <span class="token class-name">Int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And that would work. However, it would also mean we need to generate a <code>UUID</code> by hand, then load and save the <code>UUID</code> along with our other data. So, in this instance we’re going to ask Swift to generate a <code>UUID</code> automatically for us like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">struct</span> <span class="token class-name">ExpenseItem</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> type<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> amount<span class="token punctuation">:</span> <span class="token class-name">Int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now we don’t need to worry about the <code>id</code> value of our expense items – Swift will make sure they are always unique.</p><p>With that in place we can now fix our <code>ForEach</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">ForEach</span><span class="token punctuation">(</span>expenses<span class="token punctuation">.</span>items<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\\</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span> item <span class="token keyword">in</span></span>
<span class="line">    <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you run the app now you’ll see our problem is fixed: SwiftUI can now see exactly which expense item got deleted, and will animate everything correctly.</p><p>We’re not done with this step quite yet, though. Instead, I’d like you to modify the <code>ExpenseItem</code> to make it conform to a new protocol called <code>Identifiable</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">struct</span> <span class="token class-name">ExpenseItem</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> type<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> amount<span class="token punctuation">:</span> <span class="token class-name">Int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>All we’ve done is add <code>Identifiable</code> to the list of protocol conformances, nothing more. This is one of the protocols built into Swift, and means “this type can be identified uniquely.” It has only one requirement, which is that there must be a property called id that contains a unique identifier. We just added that, so we don’t need to do any extra work – our type conforms to <code>Identifiable</code> just fine.</p><p>Now, you might wonder why we added that, because our code was working fine before. Well, because our expense items are now guaranteed to be identifiable uniquely, we no longer need to tell <code>ForEach</code> which property to use for the identifier – it knows there will be an <code>id</code> property and that it will be unique, because that’s the point of the <code>Identifiable</code> protocol.</p><p>So, as a result of this change we can modify the <code>ForEach</code> again, to this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">ForEach</span><span class="token punctuation">(</span>expenses<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token punctuation">{</span> item <span class="token keyword">in</span></span>
<span class="line">    <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Much better!</p>`,30),O=s("h3",{id:"sharing-an-observed-object-with-a-new-view",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#sharing-an-observed-object-with-a-new-view"},[s("span",null,"Sharing an observed object with a new view")])],-1),P={class:"hint-container details"},W=s("summary",null,"Sharing an observed object with a new view",-1),C=s("p",null,[n("Classes that conform to "),s("code",null,"ObservableObject"),n(" can be used in more than one SwiftUI view, and all of those views will be updated when the published properties of the class change.")],-1),B=s("p",null,[n("In this app, we’re going to design a view specially for adding new expense items. When the user is ready, we’ll add that to our "),s("code",null,"Expenses"),n(" class, which will automatically cause the original view to refresh its data so the expense item can be shown.")],-1),J=s("kbd",null,"Cmd",-1),L=s("kbd",null,"N",-1),M=s("code",null,"AddView.swift",-1),R=a(`<p>As with our other views, our first pass at <code>AddView</code> will be simple and we’ll add to it. That means we’re going to add text fields for the expense name and amount, plus a picker for the type, all wrapped up in a form and a navigation view.</p><p>This should all be old news to you by now, so let’s get into the code:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">struct</span> <span class="token class-name">AddView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;</span></span></span>
<span class="line">    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> type <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;Personal&quot;</span></span></span>
<span class="line">    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> amount <span class="token operator">=</span> <span class="token number">0.0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> types <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;Business&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;Personal&quot;</span></span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">NavigationView</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Form</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Name&quot;</span></span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> $name<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">                <span class="token class-name">Picker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Type&quot;</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">ForEach</span><span class="token punctuation">(</span>types<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Amount&quot;</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> $amount<span class="token punctuation">,</span> format<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">currency</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;USD&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">keyboardType</span><span class="token punctuation">(</span><span class="token punctuation">.</span>decimalPad<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Add new expense&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Yes, that always uses US dollars for the currency type – you’ll need to make that smarter in the challenges for this project.</p><p>We’ll come back to the rest of that code in a moment, but first let’s add some code to <code>ContentView</code> so we can show <code>AddView</code> when the + button is tapped.</p><p>In order to present <code>AddView</code> as a new view, we need to make three changes to <code>ContentView</code>. First, we need some state to track whether or not <code>AddView</code> is being shown, so add this as a property now:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> showingAddExpense <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Next, we need to tell SwiftUI to use that Boolean as a condition for showing a sheet – a pop-up window. This is done by attaching the <code>sheet()</code> modifier somewhere to our view hierarchy. You can use the <code>List</code> if you want, but the <code>NavigationView</code> works just as well. Either way, add this code as a modifier to one of the views in <code>ContentView</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $showingAddExpense<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// show an AddView here</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The third step is to put something inside the sheet. Often that will just be an instance of the view type you want to show, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $showingAddExpense<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">AddView</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, though, we need something more. You see, we already have the <code>expenses</code> property in our content view, and inside <code>AddView</code> we’re going to be writing code to add expense items. We don’t want to create a <em>second</em> instance of the <code>Expenses</code> class in <code>AddView</code>, but instead want it to share the existing instance from <code>ContentView</code>.</p><p>So, what we’re going to do is add a property to <code>AddView</code> to store an <code>Expenses</code> object. It won’t create the object there, which means we need to use <code>@ObservedObject</code> rather than <code>@StateObject</code>.</p><p>Please add this property to <code>AddView</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@ObservedObject</span> <span class="token keyword">var</span> expenses<span class="token punctuation">:</span> <span class="token class-name">Expenses</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>And now we can pass our existing <code>Expenses</code> object from one view to another – they will both share the same object, and will both monitor it for changes. Modify your <code>sheet()</code> modifier in <code>ContentView</code> to this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $showingAddExpense<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">AddView</span><span class="token punctuation">(</span>expenses<span class="token punctuation">:</span> expenses<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We’re not quite done with this step yet, for two reasons: our code won’t compile, and even if it <em>did</em> compile it wouldn’t work because our button doesn’t trigger the sheet.</p>`,18),z=s("code",null,"AddView.swift",-1),H=s("code",null,"AddView",-1),$=s("code",null,"expenses",-1),K=a(`<p>That isn’t allowed any more, but we can just pass in a dummy value instead, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">struct</span> <span class="token class-name">AddView_Previews</span><span class="token punctuation">:</span> <span class="token class-name">PreviewProvider</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">AddView</span><span class="token punctuation">(</span>expenses<span class="token punctuation">:</span> <span class="token class-name">Expenses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The second problem is that we don’t actually have any code to <em>show</em> the sheet, because right now the + button in <code>ContentView</code> adds test expenses. Fortunately, the fix is trivial – just replace the existing action with code to toggle our <code>showingAddExpense</code> Boolean, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">Button</span> <span class="token punctuation">{</span></span>
<span class="line">    showingAddExpense <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span> label<span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;plus&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you run the app now the whole sheet should be working as intended – you start with <code>ContentView</code>, tap the + button to bring up an <code>AddView</code> where you can type in the various fields, then can swipe to dismiss.</p>`,5),Y=s("h3",{id:"making-changes-permanent-with-userdefaults",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#making-changes-permanent-with-userdefaults"},[s("span",null,[n("Making changes permanent with "),s("code",null,"UserDefaults")])])],-1),X={class:"hint-container details"},Z=s("summary",null,"Making changes permanent with UserDefaults",-1),G=a(`<p>At this point, our app’s user interface is functional: you’ve seen we can add and delete items, and now we have a sheet showing a user interface to create new expenses. However, the app is far from working: any data placed into <code>AddView</code> is completely ignored, and even if it <em>weren’t</em> ignored then it still wouldn’t be saved for future times the app is run.</p><p>We’ll tackle those problems in order, starting with actually <em>doing</em> something with the data from <code>AddView</code>. We already have properties that store the values from our form, and previously we added a property to store an <code>Expenses</code> object passed in from the <code>ContentView</code>.</p><p>We need to put those two things together: we need a button that, when tapped, creates an <code>ExpenseItem</code> out of our properties and adds it to the <code>expenses</code> items.</p><p>Add this modifier below <code>navigationTitle()</code> in <code>AddView</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token punctuation">.</span>toolbar <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Save&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token class-name">ExpenseItem</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> type<span class="token punctuation">:</span> type<span class="token punctuation">,</span> amount<span class="token punctuation">:</span> amount<span class="token punctuation">)</span></span>
<span class="line">        expenses<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Although we have more work to do, I encourage you to run the app now because it’s actually coming together – you can now show the add view, enter some details, press “Save”, then swipe to dismiss, and you’ll see your new item in the list. That means our data synchronization is working perfectly: both the SwiftUI views are reading from the same list of expense items.</p><p>Now try launching the app again, and you’ll immediately hit our second problem: any data you add isn’t stored, meaning that everything starts blank every time you relaunch the app.</p><p>This is obviously a pretty terrible user experience, but thanks to the way we have <code>Expense</code> as a separate class it’s actually not that hard to fix.</p><p>We’re going to leverage four important technologies to help us save and load data in a clean way:</p><ul><li>The <code>Codable</code> protocol, which will allow us to archive all the existing expense items ready to be stored.</li><li><code>UserDefaults</code>, which will let us save and load that archived data.</li><li>A custom initializer for the <code>Expenses</code> class, so that when we make an instance of it we load any saved data from <code>UserDefaults</code></li><li>A <code>didSet</code> property observer on the <code>items</code> property of <code>Expenses</code>, so that whenever an item gets added or removed we’ll write out changes.</li></ul><p>Let’s tackle <em>writing</em> the data first. We already have this property in the <code>Expenses</code> class:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">ExpenseItem</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>That’s where we store all the expense item structs that have been created, and that’s also where we’re going to attach our property observer to write out changes as they happen.</p><p>This takes four steps in total: we need to create an instance of <code>JSONEncoder</code> that will do the work of converting our data to JSON, we ask that to try encoding our <code>items</code> array, and then we can write that to <code>UserDefaults</code> using the key “Items”.</p><p>Modify the <code>items</code> property to this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">ExpenseItem</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">didSet</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">let</span> encoded <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">JSONEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Items&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tip: Using <code>JSONEncoder().encode()</code> means “create an encoder and use it to encode something,” all in one step, rather than creating the encoder first then using it later.</p><p>Now, if you’re following along you’ll notice that code doesn’t actually compile. And if you’re following along <em>closely</em> you’ll have noticed that I said this process takes four steps while only listing three.</p><p>The problem is that the <code>encode()</code> method can only archive objects that conform to the <code>Codable</code> protocol. Remember, conforming to <code>Codable</code> is what asks the compiler to generate code for us able to handle archiving and unarchiving objects, and if we don’t add a conformance for that then our code won’t build.</p><p>Helpfully, we don’t need to do any work other than add <code>Codable</code> to <code>ExpenseItem</code>, like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">struct</span> <span class="token class-name">ExpenseItem</span><span class="token punctuation">:</span> <span class="token class-name">Identifiable</span><span class="token punctuation">,</span> <span class="token class-name">Codable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> type<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line">    <span class="token keyword">let</span> amount<span class="token punctuation">:</span> <span class="token class-name">Int</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Swift already includes <code>Codable</code> conformances for the <code>UUID</code>, <code>String</code>, and <code>Int</code> properties of <code>ExpenseItem</code>, and so it’s able to make <code>ExpenseItem</code> conform automatically as soon as we ask for it.</p><p>However, you <em>will</em> see a warning that <code>id</code> will not be decoded because we made it a constant and assigned a default value. This is actually the behavior we want, but Swift is trying to be helpful because it’s possible you <em>did</em> plan to decode this value from JSON. To make the warning go away, make the property variable like this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>With that change, we’ve written all the code needed to make sure our items are saved when the user adds them. However, it’s not effective by itself: the data might be saved, but it isn’t loaded again when the app relaunches.</p><p>To solve that – and also to make our code compile again – we need to implement a custom initializer. That will:</p><ol><li>Attempt to read the “Items” key from <code>UserDefaults</code>.</li><li>Create an instance of <code>JSONDecoder</code>, which is the counterpart of <code>JSONEncoder</code> that lets us go from JSON data to Swift objects.</li><li>Ask the decoder to convert the data we received from <code>UserDefaults</code> into an array of <code>ExpenseItem</code> objects.</li><li>If that worked, assign the resulting array to <code>items</code> and exit.</li><li>Otherwise, set <code>items</code> to be an empty array. Add this initializer to the <code>Expenses</code> class now:</li></ol><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">let</span> savedItems <span class="token operator">=</span> <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Items&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">let</span> decodedItems <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">ExpenseItem</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> savedItems<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            items <span class="token operator">=</span> decodedItems</span>
<span class="line">            <span class="token keyword">return</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The two key parts of that code are the <code>data(forKey: &quot;Items&quot;)</code> line, which attempts to read whatever is in “Items” as a <code>Data</code> object, and <code>try? JSONDecoder().decode([ExpenseItem].self, from: savedItems)</code>, which does the actual job of unarchiving the <code>Data</code> object into an array of <code>ExpenseItem</code> objects.</p><p>It’s common to do a bit of a double take when you first see <code>[ExpenseItem].self</code> – what does the <code>.self</code> mean? Well, if we had just used <code>[ExpenseItem]</code>, Swift would want to know what we meant – are we trying to make a copy of the class? Were we planning to reference a static property or method? Did we perhaps mean to create an instance of the class? To avoid confusion – to say that we mean we’re referring to the type itself, known as the <em>type object</em> – we write <code>.self</code> after it.</p><p>Now that we have both loading and saving in place, you should be able to use the app. It’s not finished quite yet, though – let’s add some final polish!</p>`,31),Q=s("h3",{id:"final-polish",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#final-polish"},[s("span",null,"Final polish")])],-1),ss={class:"hint-container details"},ns=s("summary",null,"Final polish",-1),es=a(`<p>If you try using the app, you’ll soon see it has two problems:</p><ol><li>Adding an expense doesn’t dismiss <code>AddView</code>; it just stays there.</li><li>When you add an expense, you can’t actually see any details about it.</li></ol><p>Before we wrap up this project, let’s fix those to make the whole thing feel a little more polished.</p><p>First, dismissing <code>AddView</code> is done by calling <code>dismiss()</code> on the environment when the time is right. This is controlled by the view’s environment, and links to the <code>isPresented</code> parameter for our sheet – that Boolean gets set to true by us to show <code>AddView</code>, but will be flipped back to false by the environment when we call <code>dismiss()</code>.</p><p>Start by adding this property to <code>AddView</code>:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\\</span><span class="token punctuation">.</span>dismiss<span class="token punctuation">)</span> <span class="token keyword">var</span> dismiss</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You’ll notice we don’t specify a type for that – Swift can figure it out thanks to the <code>@Environment</code> property wrapper.</p><p>Next, we need to call <code>dismiss()</code> when we want the view to dismiss itself. This causes the <code>showingAddExpense</code> Boolean in <code>ContentView</code> to go back to false, and hides the <code>AddView</code>. We already have a Save button in <code>AddView</code> that creates a new expense item and appends it to our existing expenses, so add this on the line directly after:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token function">dismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>That solves the first problem, which just leaves the second: we show the name of each expense item but nothing more. This is because the <code>ForEach</code> for our list is trivial:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">ForEach</span><span class="token punctuation">(</span>expenses<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token punctuation">{</span> item <span class="token keyword">in</span></span>
<span class="line">    <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We’re going to replace that with a stack within another stack, to make sure all the information looks good on screen. The inner stack will be a <code>VStack</code> showing the expense name and type, then around that will be a <code>HStack</code> with the <code>VStack</code> on the left, then a spacer, then the expense amount. This kind of layout is common on iOS: title and subtitle on the left, and more information on the right.</p><p>Replace the existing <code>ForEach</code> in <code>ContentView</code> with this:</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift" data-title="swift"><pre><code><span class="line"><span class="token class-name">ForEach</span><span class="token punctuation">(</span>expenses<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token punctuation">{</span> item <span class="token keyword">in</span></span>
<span class="line">    <span class="token class-name">HStack</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span></span>
<span class="line">            <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>type<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token class-name">Text</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>amount<span class="token punctuation">,</span> format<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">currency</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;USD&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now run the program one last time and try it out – we’re done!</p>`,15),as=s("p",null,"That’s another app built, and lots more techniques used in context too – great job!",-1),ts=s("hr",null,null,-1);function is(r,os){const t=u("router-link"),i=u("VPCard"),c=u("VidStack"),d=u("FontIcon");return w(),m("div",null,[s("h1",b,[s("a",g,[s("span",null,k(r.$frontmatter.title)+" 관련",1)])]),s("nav",f,[s("ul",null,[s("li",null,[e(t,{to:"#project-7-part-2"},{default:o(()=>[n("Project 7, part 2")]),_:1}),s("ul",null,[s("li",null,[e(t,{to:"#building-a-list-we-can-delete-from"},{default:o(()=>[n("Building a list we can delete from")]),_:1})]),s("li",null,[e(t,{to:"#working-with-identifiable-items-in-swiftui"},{default:o(()=>[n("Working with Identifiable items in SwiftUI")]),_:1})]),s("li",null,[e(t,{to:"#sharing-an-observed-object-with-a-new-view"},{default:o(()=>[n("Sharing an observed object with a new view")]),_:1})]),s("li",null,[e(t,{to:"#making-changes-permanent-with-userdefaults"},{default:o(()=>[n("Making changes permanent with UserDefaults")]),_:1})]),s("li",null,[e(t,{to:"#final-polish"},{default:o(()=>[n("Final polish")]),_:1})])])])])]),y,e(i,p(l({title:"100 Days of SwiftUI - Day 37",desc:"Project 7, part 2",link:"https://www.hackingwithswift.com/100/swiftui/37",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),x,s("details",I,[S,e(i,p(l({title:"100 Days of SwiftUI - Day 37 - Building a list we can delete from",desc:"Building a list we can delete from",link:"https://hackingwithswift.com/books/ios-swiftui/building-a-list-we-can-delete-from",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),e(c,{src:"youtube/2g1t15bwX44"}),_,s("p",null,[n("We’ll add more to this later, but for now we can represent all that using a single "),j,n(" struct. You can put this into a new Swift file called "),e(d,{icon:"fa-brands fa-swift"}),E,n(", but you don’t need to – you can just put this into "),e(d,{icon:"fa-brands fa-swift"}),T,n(" if you like, as long as you don’t put it "),U,n(" the "),q,n(" struct itself.")]),D]),A,s("details",V,[F,e(i,p(l({title:"100 Days of SwiftUI - Day 37 - Working with Identifiable items in SwiftUI",desc:"Working with Identifiable items in SwiftUI",link:"https://hackingwithswift.com/books/ios-swiftui/working-with-identifiable-items-in-swiftui",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),e(c,{src:"youtube/zrJG7EyMPLI"}),N]),O,s("details",P,[W,e(i,p(l({title:"100 Days of SwiftUI - Day 37 - Sharing an observed object with a new view",desc:"Sharing an observed object with a new view",link:"https://hackingwithswift.com/books/ios-swiftui/sharing-an-observed-object-with-a-new-view",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),e(c,{src:"youtube/VoMLpwmPct0"}),C,B,s("p",null,[n("To make a new SwiftUI view you can either press "),J,n("+"),L,n(" or go to the File menu and choose New > File. Either way, you should select “SwiftUI View” under the User Interface category, then name the file "),e(d,{icon:"fa-brands fa-swift"}),M,n(". Xcode will ask you where to save the file, so make sure you see a folder icon next to “iExpense”, then click Create to have Xcode show you the new view, ready to edit.")]),R,s("p",null,[n("The compilation failure happens because when we made the new SwiftUI view, Xcode also added a preview provider so we can look at the design of the view while we were coding. If you find that down at the bottom of "),e(d,{icon:"fa-brands fa-swift"}),z,n(", you’ll see that it tries to create an "),H,n(" instance without providing a value for the "),$,n(" property.")]),K]),Y,s("details",X,[Z,e(i,p(l({title:"100 Days of SwiftUI - Day 37 - Making changes permanent with UserDefaults",desc:"Making changes permanent with UserDefaults",link:"https://hackingwithswift.com/books/ios-swiftui/making-changes-permanent-with-userdefaults",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),e(c,{src:"youtube/QyASq6sgTmo"}),G]),Q,s("details",ss,[ns,e(i,p(l({title:"100 Days of SwiftUI - Day 37 - Final polish",desc:"Final polish",link:"https://hackingwithswift.com/books/ios-swiftui/final-polish",logo:"https://www.hackingwithswift.com/favicon.svg",background:"rgba(54,94,226,0.2)"})),null,16),e(c,{src:"youtube/_WUcdLgbt6U"}),es]),as,ts])}const cs=h(v,[["render",is],["__file","37.html.vue"]]),ds=JSON.parse('{"path":"/swift/100-days-of-swiftui/37.html","title":"Day 37","lang":"ko-KR","frontmatter":{"lang":"ko-KR","title":"Day 37","description":"100 Days of SwiftUI > Day 37","category":["Swift"],"tag":["crashcourse","paul-hudson","swift","swiftui","hacking-with-swift","xcode","appstore"],"head":[[{"meta":null},{"property":"og:title","content":"100 Days of SwiftUI > Day 37"},{"property":"og:description","content":"Day 37"},{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/swift/100-days-of-swiftui/37.html"}],["meta",{"property":"og:url","content":"https://chanhi2000.github.io/crashcourse/crashcourse/swift/100-days-of-swiftui/37.html"}],["meta",{"property":"og:site_name","content":"🥁Crashcourse"}],["meta",{"property":"og:title","content":"Day 37"}],["meta",{"property":"og:description","content":"100 Days of SwiftUI > Day 37"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2024-10-03T01:20:13.000Z"}],["meta",{"property":"article:tag","content":"crashcourse"}],["meta",{"property":"article:tag","content":"paul-hudson"}],["meta",{"property":"article:tag","content":"swift"}],["meta",{"property":"article:tag","content":"swiftui"}],["meta",{"property":"article:tag","content":"hacking-with-swift"}],["meta",{"property":"article:tag","content":"xcode"}],["meta",{"property":"article:tag","content":"appstore"}],["meta",{"property":"article:modified_time","content":"2024-10-03T01:20:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Day 37\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-03T01:20:13.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Project 7, part 2","slug":"project-7-part-2","link":"#project-7-part-2","children":[{"level":3,"title":"Building a list we can delete from","slug":"building-a-list-we-can-delete-from","link":"#building-a-list-we-can-delete-from","children":[]},{"level":3,"title":"Working with Identifiable items in SwiftUI","slug":"working-with-identifiable-items-in-swiftui","link":"#working-with-identifiable-items-in-swiftui","children":[]},{"level":3,"title":"Sharing an observed object with a new view","slug":"sharing-an-observed-object-with-a-new-view","link":"#sharing-an-observed-object-with-a-new-view","children":[]},{"level":3,"title":"Making changes permanent with UserDefaults","slug":"making-changes-permanent-with-userdefaults","link":"#making-changes-permanent-with-userdefaults","children":[]},{"level":3,"title":"Final polish","slug":"final-polish","link":"#final-polish","children":[]}]}],"git":{"createdTime":1703642364000,"updatedTime":1727918413000,"contributors":[{"name":"chanhi2000","email":"chanhi2000@gmail.com","commits":9}]},"readingTime":{"minutes":15.67,"words":4701},"filePathRelative":"swift/100-days-of-swiftui/37.md","localizedDate":"2023년 12월 27일","excerpt":"\\n\\n<hr>\\n"}');export{cs as comp,ds as data};
